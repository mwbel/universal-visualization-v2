<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰©å±•åˆ†å¸ƒç±»å‹æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .distribution-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .distribution-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .distribution-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .card-normal {
            border-left-color: #667eea;
        }

        .card-binomial {
            border-left-color: #f093fb;
        }

        .card-poisson {
            border-left-color: #4facfe;
        }

        .card-uniform {
            border-left-color: #FF6B6B;
        }

        .card-exponential {
            border-left-color: #FF8C42;
        }

        .card-chisquare {
            border-left-color: #9B59B6;
        }

        .card-t {
            border-left-color: #2ECC71;
        }

        .distribution-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .distribution-desc {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .params-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            color: #666;
            margin-top: 10px;
        }

        .params-info strong {
            color: #333;
        }

        .new-badge {
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status {
            background: #e8f5e8;
            color: #2d5a2d;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .iframe-container {
            margin-top: 20px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            display: none;
        }

        .iframe-container h4 {
            margin-top: 0;
            color: #666;
        }

        .preview-frame {
            width: 100%;
            height: 600px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ² æ‰©å±•åˆ†å¸ƒç±»å‹æµ‹è¯•</h1>
            <p>æµ‹è¯•æ–°å¢çš„4ç§æ¦‚ç‡åˆ†å¸ƒå¯è§†åŒ–ï¼šå‡åŒ€åˆ†å¸ƒã€æŒ‡æ•°åˆ†å¸ƒã€å¡æ–¹åˆ†å¸ƒã€tåˆ†å¸ƒ</p>
        </div>

        <div class="status">
            <strong>ğŸ”§ åç«¯æœåŠ¡çŠ¶æ€ï¼š</strong>
            <span id="backendStatus">æ£€æŸ¥ä¸­...</span>
        </div>

        <div class="distribution-grid">
            <!-- åŸæœ‰åˆ†å¸ƒ -->
            <div class="distribution-card card-normal">
                <div class="distribution-title">æ­£æ€åˆ†å¸ƒ</div>
                <div class="distribution-desc">é«˜æ–¯åˆ†å¸ƒï¼Œå¯¹ç§°çš„é’Ÿå½¢æ›²çº¿</div>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDistribution('æ­£æ€åˆ†å¸ƒ å‡å€¼0 æ ‡å‡†å·®1')">æ ‡å‡†æ­£æ€ N(0,1)</button>
                    <button class="test-btn" onclick="testDistribution('æ­£æ€åˆ†å¸ƒ å‡å€¼3 æ ‡å‡†å·®2')">N(3,2Â²)</button>
                </div>
                <div class="params-info">
                    <strong>å‚æ•°ï¼š</strong> å‡å€¼ Î¼ âˆˆ [-10,10]ï¼Œæ ‡å‡†å·® Ïƒ âˆˆ [0.1,5]
                </div>
            </div>

            <div class="distribution-card card-binomial">
                <div class="distribution-title">äºŒé¡¹åˆ†å¸ƒ</div>
                <div class="distribution-desc">næ¬¡ä¼¯åŠªåˆ©è¯•éªŒä¸­æˆåŠŸæ¬¡æ•°çš„åˆ†å¸ƒ</div>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDistribution('äºŒé¡¹åˆ†å¸ƒ n=20 p=0.5')">B(20,0.5)</button>
                    <button class="test-btn" onclick="testDistribution('äºŒé¡¹åˆ†å¸ƒ n=30 p=0.7')">B(30,0.7)</button>
                </div>
                <div class="params-info">
                    <strong>å‚æ•°ï¼š</strong> è¯•éªŒæ¬¡æ•° n âˆˆ [1,100]ï¼ŒæˆåŠŸæ¦‚ç‡ p âˆˆ [0,1]
                </div>
            </div>

            <div class="distribution-card card-poisson">
                <div class="distribution-title">æ³Šæ¾åˆ†å¸ƒ</div>
                <div class="distribution-desc">å•ä½æ—¶é—´å†…äº‹ä»¶å‘ç”Ÿæ¬¡æ•°çš„åˆ†å¸ƒ</div>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDistribution('æ³Šæ¾åˆ†å¸ƒ Î»=3')">P(3)</button>
                    <button class="test-btn" onclick="testDistribution('æ³Šæ¾åˆ†å¸ƒ Î»=10')">P(10)</button>
                </div>
                <div class="params-info">
                    <strong>å‚æ•°ï¼š</strong> å¼ºåº¦å‚æ•° Î» âˆˆ [0.1,20]
                </div>
            </div>

            <!-- æ–°å¢åˆ†å¸ƒ -->
            <div class="distribution-card card-uniform">
                <div class="distribution-title">
                    å‡åŒ€åˆ†å¸ƒ
                    <span class="new-badge">æ–°å¢</span>
                </div>
                <div class="distribution-desc">åŒºé—´å†…ç­‰æ¦‚ç‡çš„è¿ç»­åˆ†å¸ƒï¼ŒçŸ©å½¢åˆ†å¸ƒ</div>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDistribution('å‡åŒ€åˆ†å¸ƒ 0åˆ°1')">U(0,1)</button>
                    <button class="test-btn" onclick="testDistribution('å‡åŒ€åˆ†å¸ƒ -2åˆ°3')">U(-2,3)</button>
                </div>
                <div class="params-info">
                    <strong>å‚æ•°ï¼š</strong> ä¸‹ç•Œ a âˆˆ [-10,0]ï¼Œä¸Šç•Œ b âˆˆ [0,10]
                </div>
            </div>

            <div class="distribution-card card-exponential">
                <div class="distribution-title">
                    æŒ‡æ•°åˆ†å¸ƒ
                    <span class="new-badge">æ–°å¢</span>
                </div>
                <div class="distribution-desc">æè¿°ç­‰å¾…æ—¶é—´æˆ–å¯¿å‘½çš„æ— è®°å¿†æ€§åˆ†å¸ƒ</div>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDistribution('æŒ‡æ•°åˆ†å¸ƒ Î»=0.5')">Exp(0.5)</button>
                    <button class="test-btn" onclick="testDistribution('æŒ‡æ•°åˆ†å¸ƒ Î»=2')">Exp(2)</button>
                </div>
                <div class="params-info">
                    <strong>å‚æ•°ï¼š</strong> ç‡å‚æ•° Î» âˆˆ [0.1,5]
                </div>
            </div>

            <div class="distribution-card card-chisquare">
                <div class="distribution-title">
                    å¡æ–¹åˆ†å¸ƒ
                    <span class="new-badge">æ–°å¢</span>
                </div>
                <div class="distribution-desc">ç”¨äºæ‹Ÿåˆä¼˜åº¦æ£€éªŒå’Œç‹¬ç«‹æ€§æ£€éªŒ</div>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDistribution('å¡æ–¹åˆ†å¸ƒ è‡ªç”±åº¦5')">Ï‡Â²(5)</button>
                    <button class="test-btn" onclick="testDistribution('å¡æ–¹åˆ†å¸ƒ k=10')">Ï‡Â²(10)</button>
                </div>
                <div class="params-info">
                    <strong>å‚æ•°ï¼š</strong> è‡ªç”±åº¦ k âˆˆ [1,20]
                </div>
            </div>

            <div class="distribution-card card-t">
                <div class="distribution-title">
                    tåˆ†å¸ƒ
                    <span class="new-badge">æ–°å¢</span>
                </div>
                <div class="distribution-desc">å°æ ·æœ¬å‡å€¼ä¼°è®¡ï¼ŒåŒ…å«æ­£æ€åˆ†å¸ƒå¯¹æ¯”</div>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDistribution('tåˆ†å¸ƒ è‡ªç”±åº¦5')">t(5)</button>
                    <button class="test-btn" onclick="testDistribution('tåˆ†å¸ƒ df=15')">t(15)</button>
                </div>
                <div class="params-info">
                    <strong>å‚æ•°ï¼š</strong> è‡ªç”±åº¦ df âˆˆ [1,30]ï¼Œä¸æ­£æ€åˆ†å¸ƒå¯¹æ¯”
                </div>
            </div>
        </div>

        <div id="resultContainer" class="iframe-container">
            <h4>ğŸ‘ï¸ å¯è§†åŒ–é¢„è§ˆ</h4>
            <iframe id="previewFrame" class="preview-frame"></iframe>
        </div>
    </div>

    <script>
        async function testDistribution(prompt) {
            console.log('æµ‹è¯•åˆ†å¸ƒ:', prompt);

            try {
                const response = await fetch('http://localhost:8000/resolve_or_generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        vizType: 'auto',
                        complexity: 'ä¸­ç­‰',
                        params: {}
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('ç”Ÿæˆç»“æœ:', result);

                if (result.success && result.htmlContent) {
                    // åœ¨iframeä¸­æ˜¾ç¤º
                    const iframe = document.getElementById('previewFrame');
                    iframe.srcdoc = result.htmlContent;
                    document.getElementById('resultContainer').style.display = 'block';

                    // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                    document.getElementById('resultContainer').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                } else {
                    alert('ç”Ÿæˆå¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                alert('æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        // æ£€æŸ¥åç«¯è¿æ¥
        async function checkBackend() {
            const statusElement = document.getElementById('backendStatus');

            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();

                if (data.status === 'healthy') {
                    statusElement.textContent = 'âœ… è¿æ¥æ­£å¸¸';
                    statusElement.style.color = '#27ae60';
                } else {
                    statusElement.textContent = 'âš ï¸ çŠ¶æ€å¼‚å¸¸';
                    statusElement.style.color = '#f39c12';
                }
            } catch (error) {
                console.error('åç«¯è¿æ¥å¤±è´¥:', error);
                statusElement.textContent = 'âŒ è¿æ¥å¤±è´¥ï¼Œè¯·ç¡®ä¿åç«¯è¿è¡Œåœ¨ http://localhost:8000';
                statusElement.style.color = '#e74c3c';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥åç«¯è¿æ¥
        document.addEventListener('DOMContentLoaded', checkBackend);

        // å®šæœŸæ£€æŸ¥åç«¯çŠ¶æ€
        setInterval(checkBackend, 30000); // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    </script>
</body>
</html>