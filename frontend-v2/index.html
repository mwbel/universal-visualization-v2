<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>万物可视化 - 智能生成</title>
    <meta name="description" content="AI驱动的可视化生成平台，支持数学、天文、物理等多学科智能可视化">

    <!-- 预连接优化 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <!-- MathJax for mathematical formula rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- 样式文件 -->
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- 主应用容器 -->
    <div class="unified-visualization-app">
        <!-- 应用头部 -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-title">
                    <span class="title-icon">🌌</span>
                    <h1>万物可视化</h1>
                    <span class="subtitle">智能生成平台</span>
                    <span class="version">v2.0</span>
                </div>

                <div class="header-actions">
                    <button class="header-btn" id="templateLibraryBtn" title="模板库">
                        <span>📚</span>
                        模板库
                    </button>
                    <button class="header-btn" id="historyBtn" title="历史记录">
                        <span>📜</span>
                        历史
                    </button>
                    <button class="header-btn" id="helpBtn" title="帮助">
                        <span>❓</span>
                        帮助
                    </button>
                </div>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main class="app-main">
            <div class="main-container">
                <!-- 输入区域 -->
                <section class="input-section">
                    <div class="input-container">
                        <div class="input-header">
                            <h2>🎯 创建您的可视化</h2>
                            <p>用自然语言描述您想要的可视化，AI将自动识别学科并生成</p>
                        </div>

                        <!-- 快速模板选择 -->
                        <div class="quick-templates">
                            <div class="template-chip" data-template="normal_distribution">
                                <span class="chip-icon">📊</span>
                                正态分布
                            </div>
                            <div class="template-chip" data-template="planetary_orbits">
                                <span class="chip-icon">🪐</span>
                                行星轨道
                            </div>
                            <div class="template-chip" data-template="projectile_motion">
                                <span class="chip-icon">⚡</span>
                                抛体运动
                            </div>
                            <div class="template-chip" data-template="harmonic_oscillation">
                                <span class="chip-icon">🌊</span>
                                简谐振动
                            </div>
                            <div class="template-chip" data-template="constellation">
                                <span class="chip-icon">✨</span>
                                星座图
                            </div>
                            <div class="template-chip" data-template="matrix_transformation">
                                <span class="chip-icon">🔄</span>
                                矩阵变换
                            </div>
                        </div>

                        <!-- 主输入框 -->
                        <div class="input-panel">
                            <textarea
                                id="visualizationInput"
                                class="main-input"
                                placeholder="请描述您想要创建的可视化，例如：&#10;• 正态分布 均值0 标准差1&#10;• 太阳系行星轨道运动&#10;• 45度角抛体运动 初速度20m/s&#10;• 简谐振动 振幅2 频率1Hz&#10;• 大熊座星座图"
                                rows="4"
                                maxlength="5000"
                            ></textarea>

                            <div class="input-footer">
                                <div class="input-info">
                                    <span class="char-count">0 / 5000</span>
                                    <span class="input-tips">💡 支持自然语言描述，Ctrl+Enter 快速生成</span>
                                </div>

                                <div class="input-actions">
                                    <button class="btn btn-secondary" id="clearBtn">
                                        <span>🗑️</span>
                                        清空
                                    </button>
                                    <button class="btn btn-primary" id="generateBtn" disabled>
                                        <span class="btn-icon">✨</span>
                                        开始生成
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 智能建议区域 -->
                        <div class="suggestions-container" id="suggestionsContainer" style="display: none;">
                            <div class="suggestions-header">
                                <span class="suggestions-title">💡 智能建议</span>
                                <button class="close-suggestions" id="closeSuggestions">×</button>
                            </div>
                            <div class="suggestions-list" id="suggestionsList">
                                <!-- 动态生成建议内容 -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 可视化结果区域 -->
                <section class="result-section" id="resultSection" style="display: none;">
                    <div class="result-container">
                        <div class="result-header">
                            <h3>🎨 可视化结果</h3>
                            <div class="result-actions">
                                <button class="result-btn" id="downloadBtn" title="下载">
                                    <span>💾</span>
                                    下载
                                </button>
                                <button class="result-btn" id="shareBtn" title="分享">
                                    <span>🔗</span>
                                    分享
                                </button>
                                <button class="result-btn" id="fullscreenBtn" title="全屏">
                                    <span>⛶</span>
                                    全屏
                                </button>
                                <button class="result-btn" id="newBtn" title="新建">
                                    <span>➕</span>
                                    新建
                                </button>
                            </div>
                        </div>

                        <div class="visualization-container">
                            <div id="visualizationFrame" class="visualization-frame">
                                <!-- 动态加载的可视化内容 -->
                            </div>
                        </div>

                        <!-- 可视化信息面板 -->
                        <div class="info-panel" id="infoPanel" style="display: none;">
                            <h4>📊 可视化信息</h4>
                            <div class="info-content">
                                <div class="info-item">
                                    <span class="info-label">学科:</span>
                                    <span class="info-value" id="subjectInfo">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">概念:</span>
                                    <span class="info-value" id="conceptInfo">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">模板:</span>
                                    <span class="info-value" id="templateInfo">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">生成时间:</span>
                                    <span class="info-value" id="timeInfo">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 加载动画 -->
                <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                    <div class="loading-content">
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                        </div>
                        <h3>正在生成可视化...</h3>
                        <p id="loadingStatus">AI正在分析您的需求...</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>
                </div>

                <!-- 提示消息 -->
                <div class="message-container" id="messageContainer"></div>
            </div>
        </main>

        <!-- 模板库模态框 -->
        <div class="modal" id="templateModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📚 模板库</h3>
                    <button class="modal-close" id="closeTemplateModal">×</button>
                </div>
                <div class="modal-body">
                    <div class="template-categories">
                        <div class="category-tabs">
                            <button class="tab-btn active" data-category="all">全部</button>
                            <button class="tab-btn" data-category="mathematics">数学</button>
                            <button class="tab-btn" data-category="astronomy">天文</button>
                            <button class="tab-btn" data-category="physics">物理</button>
                        </div>

                        <div class="template-grid" id="templateGrid">
                            <!-- 动态加载模板内容 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 帮助模态框 -->
        <div class="modal" id="helpModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>❓ 使用帮助</h3>
                    <button class="modal-close" id="closeHelpModal">×</button>
                </div>
                <div class="modal-body">
                    <div class="help-content">
                        <div class="help-section">
                            <h4>🎯 如何使用</h4>
                            <ol>
                                <li>在输入框中描述您想要的可视化内容</li>
                                <li>可以点击快速模板选择常用类型</li>
                                <li>点击"开始生成"按钮，AI将自动处理</li>
                                <li>查看生成的可视化结果，可以下载或分享</li>
                            </ol>
                        </div>

                        <div class="help-section">
                            <h4>💡 示例输入</h4>
                            <ul>
                                <li><code>正态分布 均值0 标准差1</code></li>
                                <li><code>太阳系内行星轨道运动</code></li>
                                <li><code>45度角抛体运动 初速度20m/s</code></li>
                                <li><code>二阶行列式计算可视化</code></li>
                                <li><code>月球相位变化 一个月周期</code></li>
                            </ul>
                        </div>

                        <div class="help-section">
                            <h4>🔧 快捷键</h4>
                            <ul>
                                <li><code>Ctrl + Enter</code> - 快速生成可视化</li>
                                <li><code>Ctrl + K</code> - 打开模板库</li>
                                <li><code>Ctrl + H</code> - 查看历史记录</li>
                                <li><code>Esc</code> - 关闭模态框</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/app.js"></script>
    <script src="js/api-service.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/template-manager.js"></script>
</body>
</html>