# 🎯 可视化日常测试指南

## 📖 小白友好版详细解读

### 🤔 **先理解：这是什么？**

想象一下，您家的"万物可视化"系统就像一个餐厅：
- **前端** (网页) = 餐厅的前台，负责接收订单
- **后端** (API服务器) = 餐厅的厨房，负责制作可视化
- **测试** = 检查餐厅是否正常工作

### 🎯 **第一步：检查"餐厅"是否开门**

```bash
./check-servers.sh
```

**这是在做什么？**
检查4个"服务窗口"是否都开着：
- 端口8000：主网站
- 端口8001：现代化网站
- 端口8002：传统网站
- 端口9999：厨房(后端)

**小白提示：** 如果看到错误，说明某个窗口没开，需要修复

### 🔧 **第二步：测试"厨房"是否能正常工作**

厨房(后端)有几个重要功能：

```bash
# 1. 问厨房："你们还营业吗？"
curl -s http://localhost:9999/api/v2/health
```

**期望结果：** 厨房回答："是的，我们正常营业！(status: healthy)"

```bash
# 2. 点餐测试："我想吃太阳系轨道运动这道菜"
curl -X POST http://localhost:9999/api/v2/classify \
  -H "Content-Type: application/json" \
  -d '{"prompt": "太阳系内行星轨道运动 地球 火星 木星"}'
```

**期望结果：** 厨房回答："好的，这是天文类菜品！(subject: astronomy)"

### 🖥️ **第三步：测试"前台"是否能正常接单**

我们有3个测试前台：

#### 前台1：**详细诊断版** (debug-frontend-v2.html)
```
http://localhost:8000/debug-frontend-v2.html
```
**特点：** 像医生看病一样，每个步骤都详细检查

#### 前台2：**简化版** (test-frontend-direct.html)
```
http://localhost:8000/test-frontend-direct.html
```
**特点：** 直接点餐，不啰嗦

#### 前台3：**逐步测试版** (simple-debug-test.html)
```
http://localhost:8000/simple-debug-test.html
```
**特点：** 像说明书一样，一步一步教你操作

### 🔍 **第四步：使用"放大镜"查看问题**

打开"开发者工具" (按F12键)，里面有3个重要标签：

#### **Console标签页**
```
📋 这就像系统的"聊天记录"
✅ 绿色消息 = 好消息
❌ 红色消息 = 错误消息
⚠️ 黄色消息 = 警告消息
```

#### **Network标签页**
```
📡 这就像系统的"快递追踪"
▫️ 每一行都是一个快递请求
✅ 200 = 快递成功送达
❌ 404/500 = 快递丢失了
```

### 🚨 **常见问题快速诊断**

#### 问题1：点餐没反应
**症状：** 点击"开始生成"按钮没反应
**可能原因：**
- 厨房关门了 (后端没启动)
- 前台和厨房联系不上 (网络问题)

**解决方法：**
```bash
# 检查厨房是否开门
lsof -i :9999

# 如果没开门，重启厨房
cd backend-v2 && python main.py
```

#### 问题2：厨房接单但不出菜
**症状：** 显示"生成中"但没有结果
**可能原因：**
- 厨房正在做菜 (需要等待)
- 厨房做菜时出错 (程序错误)

**解决方法：**
1. 打开开发者工具的Console标签看错误信息
2. 等待更长时间 (复杂菜品需要更多时间)
3. 重新点单

#### 问题3：菜做好了但端不上来
**症状：** 显示"生成完成"但看不到可视化
**可能原因：**
- 前台不会展示菜品 (JavaScript错误)
- 菜品格式不对 (HTML内容有问题)

**解决方法：**
1. 在Console中查找JavaScript错误
2. 检查HTML内容是否完整
3. 尝试刷新页面重新点单

### 🎮 **小白友好的测试流程**

#### 最简单的测试：
1. **访问测试页面：**
   ```
   http://localhost:8000/simple-debug-test.html
   ```

2. **按顺序点击6个按钮：**
   - 点击"测试API连接" → 应该显示"✅ API连接成功"
   - 点击"测试分类" → 应该显示"✅ 分类成功"
   - 点击"发起生成" → 应该显示"✅ 生成请求成功"
   - 点击"开始轮询" → 应该显示"✅ 生成完成"
   - 点击"获取可视化" → 应该显示"✅ 获取成功"
   - 点击"显示在iframe中" → 应该看到可视化图表

3. **看颜色判断问题：**
   - 🟢 绿色边框 = 这一步成功了
   - 🔴 红色边框 = 这一步失败了
   - 🟡 黄色边框 = 这一步有警告

### 📝 **记录测试结果**

准备一个笔记本，记录：
```
日期：2025-12-01
测试结果：
✅ API连接：正常
✅ 分类功能：正常
❌ 生成功能：失败 (错误：超时)
❌ 可视化显示：失败 (错误：JavaScript错误)
```

### 🆘 **遇到问题时的求助方法**

#### 如果你是技术小白：
1. **截图** - 把错误信息截图
2. **记录步骤** - 写下你点击了什么
3. **重启大法** - 关闭所有程序，重新启动

#### 重启步骤：
```bash
# 1. 关闭所有服务
./stop-http-servers.sh

# 2. 重新启动服务
./start-http-servers.sh

# 3. 重新测试
open http://localhost:8000/simple-debug-test.html
```

### 🎯 **总结：测试的目的是什么？**

测试就像体检，确保系统健康：
- ✅ **前台能接单** (网页正常)
- ✅ **厨房能做菜** (后端正常)
- ✅ **前后能沟通** (网络正常)
- ✅ **菜品能上桌** (显示正常)

这样每次用户点餐(输入可视化需求)，都能成功上菜(看到可视化结果)！

---

**小白记住：**
- 不着急，一步步来
- 看颜色，绿是好，红是坏
- 出问题就重启
- 不懂就问，截图说明问题

---

# 🎯 技术详细测试指南

## 🎯 自己动手测试的完整步骤

### 1. 首先验证基础环境

```bash
# 检查所有服务器是否在运行
./check-servers.sh

# 或者手动检查
lsof -i :8000,8001,8002,9999
```

### 2. 测试后端API（最重要的步骤）

```bash
# 步骤1：测试API健康状态
curl -s http://localhost:9999/api/v2/health

# 步骤2：测试分类功能
curl -X POST http://localhost:9999/api/v2/classify \
  -H "Content-Type: application/json" \
  -d '{"prompt": "太阳系内行星轨道运动 地球 火星 木星"}'

# 步骤3：发起生成请求（复制返回的generation_id）
curl -X POST http://localhost:9999/api/v2/generate \
  -H "Content-Type: application/json" \
  -d '{"prompt": "太阳系内行星轨道运动 地球 火星 木星"}'

# 步骤4：用返回的generation_id查询状态
curl http://localhost:9999/api/v2/status/YOUR_GENERATION_ID

# 步骤5：获取可视化内容
curl http://localhost:9999/api/v2/visualizations/YOUR_VIS_ID
```

### 3. 测试前端页面

```bash
# 访问测试页面
open http://localhost:8000/test-frontend-direct.html
# 或者
open http://localhost:8000/debug-frontend-v2.html
# 或者使用新的简化测试页面
open http://localhost:8000/simple-debug-test.html
```

### 4. 浏览器开发者工具调试

**步骤A：打开开发者工具**
- 按 `F12` 或右键 → "检查"
- 查看 `Console` 标签页
- 查看 `Network` 标签页

**步骤B：观察网络请求**
1. 点击"开始生成"按钮
2. 在Network标签页查看是否有API请求
3. 检查请求状态码（应该是200）
4. 查看响应内容是否正确

**步骤C：检查JavaScript错误**
1. 查看Console标签页是否有红色错误信息
2. 记录具体的错误消息
3. 查看错误发生的文件和行号

### 5. 逐步调试脚本

#### 可用的测试页面：

1. **调试页面**: `http://localhost:8000/debug-frontend-v2.html`
   - 详细的API连接测试
   - 分类功能测试
   - 生成流程调试
   - 实时日志显示

2. **直接测试页面**: `http://localhost:8000/test-frontend-direct.html`
   - 简化的生成流程
   - 独立的状态轮询
   - 直接的可视化内容显示
   - 完整的错误处理

3. **简化测试页面**: `http://localhost:8000/simple-debug-test.html`
   - 最精简的步骤测试
   - 逐步验证每个功能环节
   - 详细的错误诊断

#### 逐步测试每个功能

使用简化测试页面的步骤：

1. **点击"测试API连接"** - 检查后端是否正常
2. **点击"测试分类"** - 检查分类功能
3. **点击"发起生成"** - 检查生成请求
4. **点击"开始轮询"** - 检查状态查询
5. **点击"获取可视化"** - 检查内容获取
6. **点击"显示在iframe中"** - 检查最终显示

#### 查看每一步的输出
- 每个步骤都会显示详细的结果
- 成功的步骤会有绿色边框
- 失败的步骤会有红色边框
- 所有错误信息都会显示

### 6. 手动测试API命令

您可以在终端中运行这些命令来验证后端：

```bash
# 测试健康状态
curl -s http://localhost:9999/api/v2/health | jq .

# 测试生成
curl -X POST http://localhost:9999/api/v2/generate \
  -H "Content-Type: application/json" \
  -d '{"prompt":"太阳系内行星轨道运动 地球 火星 木星"}' \
  | jq .
```

### 7. 常见问题和解决方案

#### 如果API连接失败：
- 检查后端服务是否运行：`lsof -i :9999`
- 重启后端：`cd backend-v2 && python main.py`
- 检查端口是否被占用：`netstat -an | grep 9999`

#### 如果生成请求失败：
- 检查请求格式是否正确
- 查看后端日志输出
- 验证JSON格式是否有效

#### 如果可视化不显示：
- 检查HTML内容是否正确获取
- 验证JavaScript是否正确执行
- 检查iframe安全策略
- 确认MIME类型正确

#### 如果控制台有错误：
- 查看具体错误消息
- 检查CORS策略
- 验证内容类型
- 确认依赖库正确加载

### 8. 完整的测试检查清单

#### 后端检查清单：
- [ ] API服务器在端口9999运行
- [ ] 健康检查端点返回200状态
- [ ] 分类API正常工作
- [ ] 生成API正常工作
- [ ] 状态查询API正常工作
- [ ] 可视化内容获取API正常工作

#### 前端检查清单：
- [ ] HTTP服务器在端口8000-8002运行
- [ ] JavaScript文件正确加载
- [ ] API请求正确发送
- [ ] 响应正确接收和处理
- [ ] 可视化内容正确显示
- [ ] 错误处理正常工作

#### 集成检查清单：
- [ ] 前端能成功连接后端
- [ ] 分类结果正确显示
- [ ] 生成流程完整执行
- [ ] 状态轮询正常工作
- [ ] 最终可视化内容正确渲染

### 9. 测试用例示例

#### 基础测试用例：
```
输入：太阳系内行星轨道运动 地球 火星 木星
期望：3D行星轨道可视化

输入：正态分布 均值0 标准差1
期望：正态分布曲线图

输入：抛体运动 初速度20m/s 发射角度45度
期望：抛物线轨迹图
```

#### 边界测试用例：
```
输入：空字符串
期望：显示错误提示

输入：超过5000字符的长文本
期望：显示长度限制错误

输入：不支持的内容
期望：显示不支持提示
```

### 10. 性能监控

#### 响应时间监控：
```javascript
// 在浏览器控制台中运行
let startTime = performance.now();
fetch('http://localhost:9999/api/v2/health')
  .then(response => response.json())
  .then(data => {
    let endTime = performance.now();
    console.log(`API响应时间: ${endTime - startTime}ms`);
  });
```

#### 内存使用监控：
```bash
# 查看Node.js进程内存使用
ps aux | grep "python.*main.py"
```

### 11. 日志分析

#### 查看后端日志：
```bash
cd backend-v2
tail -f logs/app.log  # 如果有日志文件
# 或者
python main.py 2>&1 | tee backend.log
```

#### 查看前端日志：
- 打开浏览器开发者工具
- 查看Console标签页
- 使用 `console.log()` 进行调试

### 12. 自动化测试脚本

```bash
#!/bin/bash
# 创建自动化测试脚本
echo "🚀 开始自动化测试..."

# 1. 检查服务器状态
echo "📡 检查服务器状态..."
if curl -s http://localhost:9999/api/v2/health > /dev/null; then
    echo "✅ 后端API正常"
else
    echo "❌ 后端API异常"
    exit 1
fi

# 2. 测试生成功能
echo "🔄 测试生成功能..."
RESPONSE=$(curl -X POST http://localhost:9999/api/v2/generate \
  -H "Content-Type: application/json" \
  -d '{"prompt":"测试可视化生成"}')

GEN_ID=$(echo $RESPONSE | grep -o '"generation_id":"[^"]*' | cut -d'"' -f4)
echo "📝 生成ID: $GEN_ID"

# 3. 轮询生成状态
echo "⏱️  轮询生成状态..."
for i in {1..10}; do
    STATUS=$(curl -s http://localhost:9999/api/v2/status/$GEN_ID | grep -o '"status":"[^"]*' | cut -d'"' -f4)
    echo "📊 状态 $i: $STATUS"

    if [ "$STATUS" = "completed" ]; then
        echo "🎉 生成完成！"
        break
    fi

    sleep 2
done

echo "✅ 自动化测试完成"
```

现在您有了完整的测试工具和方法，可以自己一步步调试和验证每个功能环节！🔧

---

**提示：**
- 每次修改代码后都应该运行完整的测试
- 保存测试结果以便跟踪问题
- 定期运行自动化测试确保系统稳定