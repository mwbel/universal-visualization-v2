<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯è§†åŒ–ç±»å‹æ‰©å±•æµ‹è¯•</title>
    <link rel="stylesheet" href="../styles/design-system.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .test-section {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }
        .type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .type-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .type-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        .type-card.selected {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(59, 130, 246, 0.2));
            border-color: rgba(34, 197, 94, 0.5);
        }
        .type-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        .type-description {
            color: var(--muted-foreground);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .type-subtypes {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .subtype-tag {
            background: rgba(59, 130, 246, 0.2);
            color: var(--primary);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        .test-input {
            width: 100%;
            min-height: 100px;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--background);
            color: var(--foreground);
            font-family: inherit;
            resize: vertical;
            margin: 1rem 0;
        }
        .test-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            transition: all 0.2s ease;
        }
        .test-button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        .test-button:disabled {
            background: var(--muted);
            cursor: not-allowed;
            transform: none;
        }
        .result-section {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
        .detection-result {
            background: var(--surface);
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }
        .confidence-bar {
            width: 100%;
            height: 8px;
            background: var(--muted);
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.3s ease;
        }
        .test-cases {
            display: grid;
            gap: 1rem;
        }
        .test-case {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
        }
        .test-case-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .test-case-input {
            color: var(--muted-foreground);
            font-style: italic;
            margin-bottom: 0.5rem;
        }
        .test-case-result {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .status-badge.pass {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        .status-badge.fail {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        .status-badge.warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        .complexity-indicator {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .complexity-low {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        .complexity-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        .complexity-high {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        .complexity-very_high {
            background: rgba(147, 51, 234, 0.2);
            color: #9333ea;
        }
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .metric {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        .metric-label {
            font-size: 0.8rem;
            color: var(--muted-foreground);
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header class="test-section">
            <h1>ğŸ¨ å¯è§†åŒ–ç±»å‹æ‰©å±•æµ‹è¯•</h1>
            <p>æµ‹è¯•æ–°çš„å¯è§†åŒ–ç±»å‹æ£€æµ‹ã€é…ç½®ç”Ÿæˆå’Œæ‰©å±•åŠŸèƒ½</p>
            <div>
                <button id="runAllTests" class="test-button">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
                <button id="testDetection" class="test-button">æµ‹è¯•ç±»å‹æ£€æµ‹</button>
                <button id="testConfig" class="test-button">æµ‹è¯•é…ç½®ç”Ÿæˆ</button>
                <button id="clearResults" class="test-button">æ¸…é™¤ç»“æœ</button>
            </div>
        </header>

        <section class="test-section">
            <h2>ğŸ” æ”¯æŒçš„å¯è§†åŒ–ç±»å‹</h2>
            <div id="supportedTypes" class="type-grid">
                <!-- åŠ¨æ€ç”Ÿæˆç±»å‹å¡ç‰‡ -->
            </div>
        </section>

        <section class="test-section">
            <h2>ğŸ§ª ç±»å‹æ£€æµ‹æµ‹è¯•</h2>
            <textarea id="testInput" class="test-input" placeholder="è¾“å…¥å¯è§†åŒ–éœ€æ±‚æè¿°ï¼Œä¾‹å¦‚ï¼šæˆ‘æƒ³çœ‹ä¸€ä¸ªé‡å­çº ç¼ çš„åŠ¨ç”»æ¼”ç¤ºï¼Œæˆ–è€…ç»˜åˆ¶ä¸€ä¸ªçŸ©é˜µå˜æ¢çš„3Dæ•ˆæœ..."></textarea>
            <div>
                <button class="test-button" onclick="testTypeDetection()">æ£€æµ‹ç±»å‹</button>
                <button class="test-button" onclick="loadSampleInputs()">åŠ è½½ç¤ºä¾‹</button>
            </div>
            <div id="detectionResult" class="result-section" style="display: none;">
                <!-- æ£€æµ‹ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
        </section>

        <section class="test-section">
            <h2>âš™ï¸ é…ç½®ç”Ÿæˆæµ‹è¯•</h2>
            <div id="configResult" class="result-section" style="display: none;">
                <!-- é…ç½®ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
        </section>

        <section class="test-section">
            <h2>ğŸ“Š æµ‹è¯•ç”¨ä¾‹</h2>
            <div id="testCases" class="test-cases">
                <!-- æµ‹è¯•ç”¨ä¾‹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
            </div>
        </section>

        <section class="test-section">
            <h2>ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡</h2>
            <div class="performance-metrics">
                <div class="metric">
                    <div id="detectionAccuracy" class="metric-value">-</div>
                    <div class="metric-label">æ£€æµ‹å‡†ç¡®ç‡</div>
                </div>
                <div class="metric">
                    <div id="avgDetectionTime" class="metric-value">-</div>
                    <div class="metric-label">å¹³å‡æ£€æµ‹æ—¶é—´(ms)</div>
                </div>
                <div class="metric">
                    <div id="supportedTypeCount" class="metric-value">-</div>
                    <div class="metric-label">æ”¯æŒç±»å‹æ•°</div>
                </div>
                <div class="metric">
                    <div id="testPassRate" class="metric-value">-</div>
                    <div class="metric-label">æµ‹è¯•é€šè¿‡ç‡</div>
                </div>
            </div>
        </section>
    </div>

    <script src="../components/VisualizationExtensions.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let vizExtensions;
        let testResults = {
            detection: [],
            config: [],
            performance: {
                totalTests: 0,
                passedTests: 0,
                detectionTimes: []
            }
        };

        // ç¤ºä¾‹è¾“å…¥
        const sampleInputs = [
            "ç»˜åˆ¶ä¸€ä¸ªäºŒæ¬¡å‡½æ•°çš„å¯¼æ•°å›¾åƒï¼Œæ˜¾ç¤ºåˆ‡çº¿å˜åŒ–",
            "åˆ›å»ºä¸€ä¸ª3DçŸ©é˜µå˜æ¢åŠ¨ç”»ï¼Œå±•ç¤ºæ—‹è½¬å’Œç¼©æ”¾æ•ˆæœ",
            "æ¼”ç¤ºé‡å­çº ç¼ ç°è±¡ï¼Œæ˜¾ç¤ºä¸¤ä¸ªé‡å­æ€çš„å…³è”æ€§",
            "å¯è§†åŒ–æ’æ˜Ÿæ¼”åŒ–è¿‡ç¨‹ï¼Œä»ä¸»åºæ˜Ÿåˆ°çº¢å·¨æ˜Ÿ",
            "å±•ç¤ºDNAåŒèºæ—‹ç»“æ„å’Œè›‹ç™½è´¨åˆ†å­æ¨¡å‹",
            "æ¨¡æ‹Ÿç”µç£åœºåˆ†å¸ƒï¼Œæ˜¾ç¤ºç”µåœºçº¿å’Œç£åœºçº¿",
            "ç»˜åˆ¶å®‡å®™è†¨èƒ€çš„æ—¶é—´æ¼”åŒ–å›¾",
            "å±•ç¤ºåŒ–å­¦ååº”çš„åŠ¨åŠ›å­¦è¿‡ç¨‹"
        ];

        // æµ‹è¯•ç”¨ä¾‹
        const testCases = [
            {
                input: "å¯¼æ•°å’Œåˆ‡çº¿çš„å…³ç³»",
                expectedType: "calculus",
                expectedSubtypes: ["derivative"],
                difficulty: "ç®€å•"
            },
            {
                input: "çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡å¯è§†åŒ–",
                expectedType: "linear_algebra",
                expectedSubtypes: ["eigenvalue"],
                difficulty: "ä¸­ç­‰"
            },
            {
                input: "é‡å­çº ç¼ çš„è´å°”æ€æ¼”ç¤º",
                expectedType: "quantum",
                expectedSubtypes: ["entanglement"],
                difficulty: "å›°éš¾"
            },
            {
                input: "åˆ†å­ç»“æ„çš„3Dæ¨¡å‹å’ŒåŒ–å­¦é”®",
                expectedType: "molecular",
                expectedSubtypes: ["structure", "bonds"],
                difficulty: "ä¸­ç­‰"
            },
            {
                input: "å®‡å®™ä»å¤§çˆ†ç‚¸åˆ°ç°åœ¨çš„æ¼”åŒ–",
                expectedType: "cosmology",
                expectedSubtypes: ["universe_evolution"],
                difficulty: "å›°éš¾"
            }
        ];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            vizExtensions = new VisualizationExtensions();
            loadSupportedTypes();
            loadTestCases();
        });

        // åŠ è½½æ”¯æŒçš„å¯è§†åŒ–ç±»å‹
        function loadSupportedTypes() {
            const container = document.getElementById('supportedTypes');
            const types = vizExtensions.getSupportedTypes();

            container.innerHTML = '';

            types.forEach(type => {
                const card = document.createElement('div');
                card.className = 'type-card';
                card.onclick = () => selectType(type.id);

                card.innerHTML = `
                    <div class="type-title">${type.name}</div>
                    <div class="type-description">${type.description}</div>
                    <div class="type-subtypes">
                        ${type.subtypes.map(subtype =>
                            `<span class="subtype-tag">${subtype}</span>`
                        ).join('')}
                    </div>
                    <div style="margin-top: 1rem;">
                        <span class="complexity-indicator complexity-${type.complexity}">
                            ${getComplexityText(type.complexity)}
                        </span>
                    </div>
                `;

                container.appendChild(card);
            });

            // æ›´æ–°æ”¯æŒç±»å‹æ•°é‡
            document.getElementById('supportedTypeCount').textContent = types.length;
        }

        // è·å–å¤æ‚åº¦æ–‡æœ¬
        function getComplexityText(complexity) {
            const complexityMap = {
                'low': 'ä½å¤æ‚åº¦',
                'medium': 'ä¸­ç­‰å¤æ‚åº¦',
                'high': 'é«˜å¤æ‚åº¦',
                'very_high': 'æé«˜å¤æ‚åº¦'
            };
            return complexityMap[complexity] || complexity;
        }

        // é€‰æ‹©ç±»å‹
        function selectType(typeId) {
            const cards = document.querySelectorAll('.type-card');
            cards.forEach(card => card.classList.remove('selected'));

            event.currentTarget.classList.add('selected');

            // è‡ªåŠ¨å¡«å……æµ‹è¯•è¾“å…¥
            const type = vizExtensions.supportedTypes.get(typeId);
            const sampleText = `æˆ‘æƒ³çœ‹ä¸€ä¸ª${type.name}çš„å¯è§†åŒ–ï¼ŒåŒ…å«${type.subtypes.slice(0, 2).join('ã€')}ç­‰å†…å®¹`;
            document.getElementById('testInput').value = sampleText;
        }

        // æµ‹è¯•ç±»å‹æ£€æµ‹
        function testTypeDetection() {
            const input = document.getElementById('testInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥æµ‹è¯•å†…å®¹');
                return;
            }

            const startTime = performance.now();
            const detection = vizExtensions.detectVisualizationType(input);
            const endTime = performance.now();

            const detectionTime = Math.round(endTime - startTime);
            testResults.performance.detectionTimes.push(detectionTime);

            displayDetectionResult(detection, detectionTime);
            testConfigurationGeneration(detection);
        }

        // æ˜¾ç¤ºæ£€æµ‹ç»“æœ
        function displayDetectionResult(detection, detectionTime) {
            const resultDiv = document.getElementById('detectionResult');
            resultDiv.style.display = 'block';

            const typeConfig = vizExtensions.supportedTypes.get(detection.primaryType);

            resultDiv.innerHTML = `
                <h3>æ£€æµ‹ç»“æœ</h3>
                <div class="detection-result">
                    <div><strong>ä¸»è¦ç±»å‹:</strong> ${typeConfig?.name || 'æœªæ£€æµ‹åˆ°'}</div>
                    <div><strong>ç½®ä¿¡åº¦:</strong> ${detection.confidence}</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${Math.min(detection.confidence * 10, 100)}%"></div>
                    </div>
                    <div><strong>å­ç±»å‹:</strong> ${detection.subtypes.join(', ') || 'æ— '}</div>
                    <div><strong>å»ºè®®å¼•æ“:</strong> ${detection.suggestedEngines.join(', ')}</div>
                    <div><strong>å¤æ‚åº¦:</strong> <span class="complexity-indicator complexity-${detection.complexity}">${getComplexityText(detection.complexity)}</span></div>
                    <div><strong>é¢„ä¼°ç”Ÿæˆæ—¶é—´:</strong> ${detection.estimatedTime}ç§’</div>
                    <div><strong>æ£€æµ‹è€—æ—¶:</strong> ${detectionTime}ms</div>
                </div>
            `;
        }

        // æµ‹è¯•é…ç½®ç”Ÿæˆ
        function testConfigurationGeneration(detection) {
            if (!detection.primaryType) {
                document.getElementById('configResult').style.display = 'none';
                return;
            }

            try {
                const config = vizExtensions.createVisualizationConfig(
                    detection.primaryType,
                    detection.subtypes
                );

                const validation = vizExtensions.validateConfig(config);

                displayConfigResult(config, validation);
                testResults.performance.passedTests++;
            } catch (error) {
                displayConfigError(error.message);
            }
        }

        // æ˜¾ç¤ºé…ç½®ç»“æœ
        function displayConfigResult(config, validation) {
            const resultDiv = document.getElementById('configResult');
            resultDiv.style.display = 'block';

            resultDiv.innerHTML = `
                <h3>é…ç½®ç”Ÿæˆç»“æœ</h3>
                <div class="detection-result">
                    <div><strong>ç±»å‹:</strong> ${config.type}</div>
                    <div><strong>å¼•æ“:</strong> ${config.engine}</div>
                    <div><strong>å¤æ‚åº¦:</strong> ${config.complexity}</div>
                    <div><strong>å‚æ•°æ•°é‡:</strong> ${Object.keys(config.params).length}</div>
                    <div><strong>äº¤äº’åŠŸèƒ½:</strong> ${Object.keys(config.interactions).length}</div>
                    <div><strong>åŠ¨ç”»æ•ˆæœ:</strong> ${config.animations.enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}</div>
                    <div><strong>éªŒè¯çŠ¶æ€:</strong>
                        <span class="status-badge ${validation.valid ? 'pass' : 'fail'}">
                            ${validation.valid ? 'é€šè¿‡' : 'å¤±è´¥'}
                        </span>
                    </div>
                    ${validation.errors.length > 0 ? `
                        <div><strong>é”™è¯¯:</strong></div>
                        <ul>${validation.errors.map(e => `<li>${e}</li>`).join('')}</ul>
                    ` : ''}
                    ${validation.warnings.length > 0 ? `
                        <div><strong>è­¦å‘Š:</strong></div>
                        <ul>${validation.warnings.map(w => `<li>${w}</li>`).join('')}</ul>
                    ` : ''}
                </div>
            `;
        }

        // æ˜¾ç¤ºé…ç½®é”™è¯¯
        function displayConfigError(error) {
            const resultDiv = document.getElementById('configResult');
            resultDiv.style.display = 'block';

            resultDiv.innerHTML = `
                <h3>é…ç½®ç”Ÿæˆå¤±è´¥</h3>
                <div class="detection-result">
                    <div style="color: #ef4444;"><strong>é”™è¯¯:</strong> ${error}</div>
                </div>
            `;
        }

        // åŠ è½½ç¤ºä¾‹è¾“å…¥
        function loadSampleInputs() {
            const randomInput = sampleInputs[Math.floor(Math.random() * sampleInputs.length)];
            document.getElementById('testInput').value = randomInput;
            testTypeDetection();
        }

        // åŠ è½½æµ‹è¯•ç”¨ä¾‹
        function loadTestCases() {
            const container = document.getElementById('testCases');
            container.innerHTML = '';

            testCases.forEach((testCase, index) => {
                const caseDiv = document.createElement('div');
                caseDiv.className = 'test-case';
                caseDiv.innerHTML = `
                    <div class="test-case-header">
                        <strong>æµ‹è¯•ç”¨ä¾‹ ${index + 1}</strong>
                        <span class="status-badge" id="status-${index}">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-case-input">"${testCase.input}"</div>
                    <div>
                        <strong>æœŸæœ›:</strong> ${testCase.expectedType} (${testCase.expectedSubtypes.join(', ')})
                        <span style="margin-left: 1rem; color: var(--muted-foreground);">éš¾åº¦: ${testCase.difficulty}</span>
                    </div>
                    <div class="test-case-result" id="result-${index}">
                        <button class="test-button" onclick="runTestCase(${index})">è¿è¡Œæµ‹è¯•</button>
                    </div>
                `;
                container.appendChild(caseDiv);
            });
        }

        // è¿è¡Œå•ä¸ªæµ‹è¯•ç”¨ä¾‹
        function runTestCase(index) {
            const testCase = testCases[index];
            const resultDiv = document.getElementById(`result-${index}`);
            const statusDiv = document.getElementById(`status-${index}`);

            resultDiv.innerHTML = '<span style="color: var(--primary);">æµ‹è¯•ä¸­...</span>';

            const startTime = performance.now();
            const detection = vizExtensions.detectVisualizationType(testCase.input);
            const endTime = performance.now();

            const detectionTime = Math.round(endTime - startTime);
            testResults.performance.detectionTimes.push(detectionTime);

            // è¯„ä¼°æµ‹è¯•ç»“æœ
            const typeMatch = detection.primaryType === testCase.expectedType;
            const subtypeMatch = testCase.expectedSubtypes.every(st =>
                detection.subtypes.includes(st)
            );

            testResults.performance.totalTests++;
            if (typeMatch && subtypeMatch) {
                testResults.performance.passedTests++;
            }

            // æ›´æ–°çŠ¶æ€
            if (typeMatch && subtypeMatch) {
                statusDiv.className = 'status-badge pass';
                statusDiv.textContent = 'é€šè¿‡';
            } else if (typeMatch || subtypeMatch) {
                statusDiv.className = 'status-badge warning';
                statusDiv.textContent = 'éƒ¨åˆ†é€šè¿‡';
            } else {
                statusDiv.className = 'status-badge fail';
                statusDiv.textContent = 'å¤±è´¥';
            }

            // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
            resultDiv.innerHTML = `
                <div>
                    <div>æ£€æµ‹ç±»å‹: ${detection.primaryType || 'æœªæ£€æµ‹åˆ°'} ${typeMatch ? 'âœ…' : 'âŒ'}</div>
                    <div>æ£€æµ‹å­ç±»å‹: ${detection.subtypes.join(', ') || 'æ— '} ${subtypeMatch ? 'âœ…' : 'âŒ'}</div>
                    <div>ç½®ä¿¡åº¦: ${detection.confidence}</div>
                    <div>æ£€æµ‹æ—¶é—´: ${detectionTime}ms</div>
                </div>
            `;

            updatePerformanceMetrics();
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            document.getElementById('runAllTests').disabled = true;

            // é‡ç½®æ€§èƒ½æ•°æ®
            testResults.performance = {
                totalTests: 0,
                passedTests: 0,
                detectionTimes: []
            };

            // è¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
            for (let i = 0; i < testCases.length; i++) {
                runTestCase(i);
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            document.getElementById('runAllTests').disabled = false;
            updatePerformanceMetrics();
        }

        // æ›´æ–°æ€§èƒ½æŒ‡æ ‡
        function updatePerformanceMetrics() {
            const metrics = testResults.performance;

            // å‡†ç¡®ç‡
            const accuracy = metrics.totalTests > 0
                ? Math.round((metrics.passedTests / metrics.totalTests) * 100)
                : 0;
            document.getElementById('detectionAccuracy').textContent = accuracy + '%';

            // å¹³å‡æ£€æµ‹æ—¶é—´
            const avgTime = metrics.detectionTimes.length > 0
                ? Math.round(metrics.detectionTimes.reduce((a, b) => a + b, 0) / metrics.detectionTimes.length)
                : 0;
            document.getElementById('avgDetectionTime').textContent = avgTime;

            // æµ‹è¯•é€šè¿‡ç‡
            const passRate = metrics.totalTests > 0
                ? Math.round((metrics.passedTests / metrics.totalTests) * 100)
                : 0;
            document.getElementById('testPassRate').textContent = passRate + '%';
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('testInput').value = '';
            document.getElementById('detectionResult').style.display = 'none';
            document.getElementById('configResult').style.display = 'none';

            // é‡ç½®æµ‹è¯•ç”¨ä¾‹
            loadTestCases();

            // é‡ç½®æ€§èƒ½æŒ‡æ ‡
            testResults.performance = {
                totalTests: 0,
                passedTests: 0,
                detectionTimes: []
            };
            updatePerformanceMetrics();
        }

        // ç»‘å®šäº‹ä»¶
        document.getElementById('runAllTests').addEventListener('click', runAllTests);
        document.getElementById('testDetection').addEventListener('click', testTypeDetection);
        document.getElementById('testConfig').addEventListener('click', () => {
            const input = document.getElementById('testInput').value.trim();
            if (input) {
                const detection = vizExtensions.detectVisualizationType(input);
                testConfigurationGeneration(detection);
            } else {
                alert('è¯·å…ˆè¿›è¡Œç±»å‹æ£€æµ‹');
            }
        });
        document.getElementById('clearResults').addEventListener('click', clearResults);
    </script>
</body>
</html>