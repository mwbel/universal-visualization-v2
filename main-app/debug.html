<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‡ç‰©å¯è§†åŒ– - è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.success {
            background: #28a745;
        }
        .btn.warning {
            background: #ffc107;
            color: #212529;
        }
        .btn.danger {
            background: #dc3545;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        #console-output {
            background: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä¸‡ç‰©å¯è§†åŒ–è°ƒè¯•å·¥å…·</h1>

    <div class="debug-container">
        <h2>åº”ç”¨çŠ¶æ€æ£€æŸ¥</h2>
        <button class="btn" onclick="checkAppStatus()">æ£€æŸ¥åº”ç”¨çŠ¶æ€</button>
        <button class="btn success" onclick="testButtons()">æµ‹è¯•æŒ‰é’®åŠŸèƒ½</button>
        <button class="btn warning" onclick="testNavigation()">æµ‹è¯•å¯¼èˆªåŠŸèƒ½</button>
        <button class="btn danger" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        <div id="status-output"></div>
    </div>

    <div class="debug-container">
        <h2>æ§åˆ¶å°è¾“å‡º</h2>
        <div id="console-output"></div>
    </div>

    <div class="debug-container">
        <h2>å¿«é€Ÿæµ‹è¯•</h2>

        <div class="test-section">
            <h3>æ¨¡å¼åˆ‡æ¢æµ‹è¯•</h3>
            <button class="btn" onclick="testModeSwitch('text')">æµ‹è¯•æ–‡æœ¬æ¨¡å¼</button>
            <button class="btn" onclick="testModeSwitch('template')">æµ‹è¯•æ¨¡æ¿æ¨¡å¼</button>
            <button class="btn" onclick="testModeSwitch('concept')">æµ‹è¯•æ¦‚å¿µæ¨¡å¼</button>
        </div>

        <div class="test-section">
            <h3>å­æ¨¡å—å¯¼èˆªæµ‹è¯•</h3>
            <button class="btn" onclick="testSubmoduleNavigation('probability-stats')">æµ‹è¯•æ¦‚ç‡ç»Ÿè®¡</button>
            <button class="btn" onclick="testSubmoduleNavigation('linear-algebra')">æµ‹è¯•çº¿æ€§ä»£æ•°</button>
            <button class="btn" onclick="testSubmoduleNavigation('differential-geometry')">æµ‹è¯•å¾®åˆ†å‡ ä½•</button>
        </div>

        <div class="test-section">
            <h3>ç›´æ¥è®¿é—®æµ‹è¯•</h3>
            <button class="btn" onclick="window.open('/', '_blank')">æ‰“å¼€ä¸»é¡µ</button>
            <button class="btn" onclick="window.open('../GeneralVisualization/app/modules/probability_statistics/index.html', '_blank')">æ‰“å¼€æ¦‚ç‡ç»Ÿè®¡</button>
            <button class="btn" onclick="window.open('../GeneralVisualization/app/modules/linear_algebra/index.html', '_blank')">æ‰“å¼€çº¿æ€§ä»£æ•°</button>
        </div>
    </div>

    <script>
        // æ§åˆ¶å°è¾“å‡ºé‡å®šå‘
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const consoleOutput = document.getElementById('console-output');

        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#ffa726' : '#fff';
            const entry = document.createElement('div');
            entry.style.color = color;
            entry.textContent = `[${timestamp}] ${message}`;
            consoleOutput.appendChild(entry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };

        function showStatus(message, type = 'info') {
            const statusOutput = document.getElementById('status-output');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusOutput.appendChild(statusDiv);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 3000);
        }

        function checkAppStatus() {
            console.log('=== å¼€å§‹æ£€æŸ¥åº”ç”¨çŠ¶æ€ ===');

            // æ£€æŸ¥å…¨å±€appå¯¹è±¡
            if (typeof window.app !== 'undefined') {
                console.log('âœ… å…¨å±€appå¯¹è±¡å­˜åœ¨');
                showStatus('âœ… å…¨å±€appå¯¹è±¡å­˜åœ¨', 'success');

                // æ£€æŸ¥å…³é”®æ–¹æ³•
                const methods = ['switchMode', 'exploreSubmodule', 'openModuleWithFallback'];
                methods.forEach(method => {
                    if (typeof window.app[method] === 'function') {
                        console.log(`âœ… ${method} æ–¹æ³•å­˜åœ¨`);
                    } else {
                        console.log(`âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨`);
                        showStatus(`âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨`, 'error');
                    }
                });
            } else {
                console.log('âŒ å…¨å±€appå¯¹è±¡ä¸å­˜åœ¨');
                showStatus('âŒ å…¨å±€appå¯¹è±¡ä¸å­˜åœ¨ï¼Œåº”ç”¨å¯èƒ½æœªæ­£ç¡®åˆå§‹åŒ–', 'error');
            }

            // æ£€æŸ¥DOMå…ƒç´ 
            const modeBtns = document.querySelectorAll('.mode-btn');
            const subcategories = document.querySelectorAll('.subcategory');

            console.log(`ğŸ“‹ æ¨¡å¼æŒ‰é’®æ•°é‡: ${modeBtns.length}`);
            console.log(`ğŸ“‹ å­åˆ†ç±»å…ƒç´ æ•°é‡: ${subcategories.length}`);

            // æ£€æŸ¥ç»„ä»¶
            if (window.app && window.app.components) {
                console.log('ğŸ“¦ ç»„ä»¶çŠ¶æ€:', Object.keys(window.app.components));
            }
        }

        function testButtons() {
            console.log('=== å¼€å§‹æµ‹è¯•æŒ‰é’®åŠŸèƒ½ ===');

            const modeBtns = document.querySelectorAll('.mode-btn');
            console.log(`æ‰¾åˆ° ${modeBtns.length} ä¸ªæ¨¡å¼æŒ‰é’®`);

            if (modeBtns.length > 0) {
                modeBtns.forEach((btn, index) => {
                    console.log(`æŒ‰é’® ${index + 1}: ${btn.dataset.mode}`);
                    // æ¨¡æ‹Ÿç‚¹å‡»
                    btn.click();
                });
                showStatus(`âœ… æµ‹è¯•äº† ${modeBtns.length} ä¸ªæ¨¡å¼æŒ‰é’®`, 'success');
            } else {
                showStatus('âŒ æœªæ‰¾åˆ°æ¨¡å¼æŒ‰é’®', 'error');
            }
        }

        function testNavigation() {
            console.log('=== å¼€å§‹æµ‹è¯•å¯¼èˆªåŠŸèƒ½ ===');

            if (window.app && typeof window.app.exploreSubmodule === 'function') {
                const modules = ['probability-stats', 'linear-algebra', 'differential-geometry'];
                modules.forEach(module => {
                    console.log(`æµ‹è¯•å¯¼èˆªåˆ°: ${module}`);
                    // è¿™é‡Œä¸å®é™…å¯¼èˆªï¼Œåªæµ‹è¯•æ–¹æ³•è°ƒç”¨
                    console.log(`âœ… ${module} å¯¼èˆªæ–¹æ³•å¯ç”¨`);
                });
                showStatus('âœ… å¯¼èˆªåŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
            } else {
                showStatus('âŒ å¯¼èˆªåŠŸèƒ½ä¸å¯ç”¨', 'error');
            }
        }

        function testModeSwitch(mode) {
            console.log(`=== æµ‹è¯•æ¨¡å¼åˆ‡æ¢: ${mode} ===`);

            if (window.app && typeof window.app.switchMode === 'function') {
                try {
                    window.app.switchMode(mode);
                    showStatus(`âœ… æˆåŠŸåˆ‡æ¢åˆ° ${mode} æ¨¡å¼`, 'success');
                } catch (error) {
                    console.error('æ¨¡å¼åˆ‡æ¢å¤±è´¥:', error);
                    showStatus(`âŒ æ¨¡å¼åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                showStatus('âŒ switchMode æ–¹æ³•ä¸å¯ç”¨', 'error');
            }
        }

        function testSubmoduleNavigation(submodule) {
            console.log(`=== æµ‹è¯•å­æ¨¡å—å¯¼èˆª: ${submodule} ===`);

            if (window.app && typeof window.app.exploreSubmodule === 'function') {
                try {
                    window.app.exploreSubmodule(submodule);
                    showStatus(`âœ… æˆåŠŸå¯¼èˆªåˆ° ${submodule}`, 'success');
                } catch (error) {
                    console.error('å­æ¨¡å—å¯¼èˆªå¤±è´¥:', error);
                    showStatus(`âŒ å­æ¨¡å—å¯¼èˆªå¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                showStatus('âŒ exploreSubmodule æ–¹æ³•ä¸å¯ç”¨', 'error');
            }
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
            console.log('=== æ§åˆ¶å°å·²æ¸…ç©º ===');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            console.log('ğŸ”§ è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(checkAppStatus, 1000); // å»¶è¿Ÿ1ç§’æ£€æŸ¥ï¼Œç­‰å¾…ä¸»åº”ç”¨åˆå§‹åŒ–
        });

        // ç›‘å¬æ¥è‡ªä¸»é¡µé¢çš„æ¶ˆæ¯
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'debug') {
                console.log('æ”¶åˆ°è°ƒè¯•æ¶ˆæ¯:', event.data.message);
            }
        });
    </script>
</body>
</html>