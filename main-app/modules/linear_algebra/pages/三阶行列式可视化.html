<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰é˜¶è¡Œåˆ—å¼å¯è§†åŒ– - ä¸€å›¾èƒœåƒè¨€</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                ready: function () {
                    MathJax.startup.defaultReady();
                    console.log('MathJax is ready!');
                }
            }
        };
    </script>
    <script src="../frontend/global-mathjax.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 2px 0 15px rgba(0,0,0,0.1);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-title {
            font-size: 1.4em;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .nav-item {
            display: block;
            padding: 12px 15px;
            margin: 8px 0;
            color: #4a5568;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 500;
            border-left: 4px solid transparent;
        }

        .nav-item:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateX(5px);
            border-left-color: #667eea;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-left-color: #667eea;
        }

        .page-content {
            margin-left: 280px;
            flex: 1;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .theory-section, .visualization-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 1.5em;
            color: #4a5568;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .definition-box {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .formula {
            font-size: 1.1em;
            text-align: left;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            overflow: visible;
            display: block;
            word-wrap: break-word;
        }
        
        /* ä¾‹é¢˜å¡ç‰‡ä¸­æœ€åä¸€è¡Œâ€œç»“æœâ€æ˜ç¡®å·¦å¯¹é½ */
        .example-card .formula:last-of-type {
            text-align: left !important;
        }
        
        .formula mjx-container {
            max-width: 100% !important;
            overflow: visible !important;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9em;
        }

        .control-group input {
            padding: 6px 8px;
            border: 2px solid #e2e8f0;
            border-radius: 4px;
            font-size: 0.9em;
            transition: border-color 0.3s;
        }

        .control-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .result-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .result-display h3 {
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 1.8em;
            font-weight: bold;
            margin: 10px 0;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .geometric-meaning {
            background: #e6fffa;
            border: 2px solid #38b2ac;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .geometric-meaning h4 {
            color: #2c7a7b;
            margin-bottom: 10px;
        }

        .plot-container {
            height: 600px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            margin: 20px 0;
        }

        .calculation-steps {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .calculation-steps h4 {
            color: #4a5568;
            margin-bottom: 15px;
        }

        .step {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
            border-left: 4px solid #667eea;
            color: #333;
        }

        .step * {
            color: #333 !important;
        }

        .examples-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 30px;
        }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .example-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
            min-width: 0;        /* å¿…éœ€ï¼šé˜²æ­¢è¢«å†…å®¹æ’‘ç ´ */
            overflow: visible;   /* å…è®¸å†…å®¹æ­£å¸¸æ˜¾ç¤º */
        }

        .example-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        /* è®©"å…¬å¼æ‰€åœ¨å®¹å™¨"å’Œ MathJax å®¹å™¨ä¸è¶Šç•Œï¼Œå¿…è¦æ—¶æ¨ªå‘æ»šåŠ¨ */
        .example-card .formula {
            max-width: 100%;
            overflow-x: auto;       /* è¶…å®½æ—¶å‡ºç°æ¨ªå‘æ»šåŠ¨æ¡ */
            -webkit-overflow-scrolling: touch;
            padding-bottom: 4px;           /* ç»™æ»šåŠ¨æ¡ç•™ç‚¹ç©ºé—´ï¼ˆå¯é€‰ï¼‰ */
            scrollbar-gutter: stable both-edges; /* å¯é€‰ï¼šæ»šåŠ¨æ¡å¸¸é©»ä¸æŠ–åŠ¨ */
        }

        .example-card .formula mjx-container{
            display: inline-block !important;
            min-width: max-content;        /* å…³é”®ï¼šå†…å®¹å¤šå®½å°±å¤šå®½ */
            max-width: 100%;               /* ä½†å¤–å±‚ä»ä¼šé™åˆ¶å¹¶è§¦å‘æ»šåŠ¨ */
            overflow: visible;             /* ç”±å¤–å±‚æ§åˆ¶æ»šåŠ¨ï¼Œä¸åœ¨è¿™é‡Œè£å‰ª */
            text-align: left;              /* å¯é€‰ï¼šå·¦å¯¹é½ */
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .back-button:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .preset-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }

        .preset-btn:hover {
            background: #5a67d8;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .formula {
                font-size: 0.9em;
                padding: 10px;
            }
            
            .example-grid {
                grid-template-columns: 1fr;
            }
            
            .example-card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-title">çº¿æ€§ä»£æ•°æ¨¡å—</div>
        <a href="linear-algebra-module.html" class="nav-item">æ¨¡å—æ¦‚è§ˆ</a>
        <a href="äºŒé˜¶è¡Œåˆ—å¼å¯è§†åŒ–.html" class="nav-item">äºŒé˜¶è¡Œåˆ—å¼</a>
        <a href="ä¸‰é˜¶è¡Œåˆ—å¼å¯è§†åŒ–.html" class="nav-item active">ä¸‰é˜¶è¡Œåˆ—å¼</a>
        <a href="çŸ©é˜µè¿ç®—å¯è§†åŒ–.html" class="nav-item">çŸ©é˜µè¿ç®—</a>
        <a href="å‘é‡ç©ºé—´å¯è§†åŒ–.html" class="nav-item">å‘é‡ç©ºé—´</a>
        <a href="../index.html">è¿”å› â€œçº¿æ€§ä»£æ•°å¯è§†åŒ–ä¸–ç•Œâ€é¦–é¡µ</a>
<a href="../../../index.html" class="nav-item">è¿”å› â€œä¸‡ç‰©å¯è§†åŒ–â€é¦–é¡µ</a>
    </div>
    
    <div class="page-content">
        <div class="header">
            <h1>ä¸‰é˜¶è¡Œåˆ—å¼å¯è§†åŒ–</h1>
            <p>æ¢ç´¢ä¸‰é˜¶è¡Œåˆ—å¼çš„æ•°å­¦å®šä¹‰ä¸ä¸‰ç»´å‡ ä½•æ„ä¹‰</p>
        </div>

        <div class="main-content">
            <div class="theory-section">
                <h2 class="section-title">æ•°å­¦ç†è®º</h2>
                
                <div class="definition-box">
                    <h3>å®šä¹‰</h3>
                    <p>ä»¥æ•° \(a_{ij}(i,j = 1,2,3)\) ä¸ºå…ƒç´ çš„ä¸‰é˜¶è¡Œåˆ—å¼ä¸ºï¼š</p>
                    <div class="formula">
                        $$\begin{vmatrix} a_{11} & a_{12} & a_{13} \\ a_{21} & a_{22} & a_{23} \\ a_{31} & a_{32} & a_{33} \end{vmatrix}$$
                    </div>
                </div>

                <div class="preset-buttons">
                    <button class="preset-btn" onclick="setPreset('identity')">å•ä½çŸ©é˜µ</button>
                    <button class="preset-btn" onclick="setPreset('example1')">ä¾‹1</button>
                <button class="preset-btn" onclick="setPreset('example2')">ä¾‹2</button>
                    <button class="preset-btn" onclick="setPreset('zero')">é›¶è¡Œåˆ—å¼</button>
                </div>

                <div class="controls">
                    <div class="control-group">
                        <label for="a11">aâ‚â‚</label>
                        <input type="number" id="a11" value="1" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="a12">aâ‚â‚‚</label>
                        <input type="number" id="a12" value="2" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="a13">aâ‚â‚ƒ</label>
                        <input type="number" id="a13" value="-4" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="a21">aâ‚‚â‚</label>
                        <input type="number" id="a21" value="-2" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="a22">aâ‚‚â‚‚</label>
                        <input type="number" id="a22" value="2" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="a23">aâ‚‚â‚ƒ</label>
                        <input type="number" id="a23" value="1" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="a31">aâ‚ƒâ‚</label>
                        <input type="number" id="a31" value="3" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="a32">aâ‚ƒâ‚‚</label>
                        <input type="number" id="a32" value="-4" step="0.1">
                    </div>
                    <div class="control-group">
                        <label for="a33">aâ‚ƒâ‚ƒ</label>
                        <input type="number" id="a33" value="-2" step="0.1">
                    </div>
                </div>

                <div class="result-display">
                    <h3>è®¡ç®—ç»“æœ</h3>
                    <div class="result-value" id="determinant-result">-10</div>
                    <div>å¹³è¡Œå…­é¢ä½“ä½“ç§¯: <span id="volume-display">10</span></div>
                </div>

                <div class="calculation-steps">
                    <h4>è®¡ç®—æ­¥éª¤ï¼ˆå¯¹è§’çº¿æ³•ï¼‰</h4>
                    <div class="step" id="step1">
                        æ­£å¯¹è§’çº¿é¡¹ï¼š<span id="positive-terms"></span>
                    </div>
                    <div class="step" id="step2">
                        è´Ÿå¯¹è§’çº¿é¡¹ï¼š<span id="negative-terms"></span>
                    </div>
                    <div class="step" id="step3">
                        æœ€ç»ˆç»“æœï¼š<span id="final-calculation"></span>
                    </div>
                </div>

                <div class="geometric-meaning">
                    <h4>å‡ ä½•æ„ä¹‰</h4>
                    <p>ä¸‰é˜¶è¡Œåˆ—å¼çš„å€¼ç­‰äºç”±ä¸‰ä¸ªåˆ—å‘é‡å¼ æˆçš„<strong>å¹³è¡Œå…­é¢ä½“çš„æœ‰å‘ä½“ç§¯</strong>ï¼š</p>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li><strong> $$v_1 = (a_{11}, a_{21}, a_{31})$$</strong></li>
                        <li><strong>$$v_2 = (a_{12}, a_{22}, a_{32})$$</strong></li>
                        <li><strong>$$v_3= (a_{13}, a_{23}, a_{33})$$</strong></li>
                    </ul>
                    <p style="margin-top: 10px;">å½“è¡Œåˆ—å¼å€¼ä¸ºæ­£æ—¶ï¼Œä¸‰ä¸ªå‘é‡æ„æˆå³æ‰‹åæ ‡ç³»ï¼›ä¸ºè´Ÿæ—¶æ„æˆå·¦æ‰‹åæ ‡ç³»ï¼›ä¸ºé›¶æ—¶ä¸‰å‘é‡å…±é¢ã€‚</p>
                </div>
            </div>

            <div class="visualization-section">
                <h2 class="section-title">ä¸‰ç»´å¯è§†åŒ–</h2>
                <div id="plot" class="plot-container"></div>
                
                <div style="margin-top: 20px;">
                    <h4>å‘é‡ä¿¡æ¯</h4>
                    <p><strong>å‘é‡ $v_1$:</strong> (<span id="v1-display">$1, -2, 3$</span>)</p>
                    <p><strong>å‘é‡ $v_2$:</strong> (<span id="v2-display">$2, 2, -4$</span>)</p>
                    <p><strong>å‘é‡ $v_3$:</strong> (<span id="v3-display">$-4, 1, -2$</span>)</p>
                    <p><strong>è¡Œåˆ—å¼å€¼:</strong> <span id="det-display">-10</span></p>
                    <p><strong>ä½“ç§¯:</strong> <span id="abs-volume-display">10</span></p>
                </div>
            </div>
        </div>

        <div class="examples-section">
            <h2 class="section-title">å…¸å‹ä¾‹é¢˜ä¸åº”ç”¨</h2>
            <div class="example-grid">
                <div class="example-card">
                    <h4>â€¢ ä¾‹ 1ï¼šåŸºæœ¬è®¡ç®—</h4>
                    <div class="formula">
                        $$\begin{vmatrix} 1 & 2 & -4 \\ -2 & 2 & 1 \\ 3 & -4 & -2 \end{vmatrix} = -10$$
                    </div>
                    <p><strong>å¯¹è§’çº¿æ³•è®¡ç®—ï¼š</strong></p>
                    <div class="formula">$$\text{æ­£é¡¹ï¼š }1 \times 2 \times (-2) + 2 \times 1 \times 3 + (-4) \times (-2) \times (-4) = -4 + 6 - 32 = -30$$</div>
                    <div class="formula">$$\text{è´Ÿé¡¹ï¼š }(-4) \times 2 \times 3 + 2 \times (-2) \times (-2) + 1 \times 1 \times (-4) = -24 + 8 - 4 = -20$$</div>
                    <div class="formula">$$\text{ç»“æœï¼š }-30 - (-20) = -10$$</div>
                </div>
                
                <div class="example-card">
                    <h4>â€¢ å‡ ä½•åº”ç”¨ï¼šä½“ç§¯è®¡ç®—</h4>
                    <p>ä¸‰ä¸ªå‘é‡ $v_1=(1,0,0)$, $v_2=(0,2,0)$, $v_3=(0,0,3)$ æ„æˆçš„å¹³è¡Œå…­é¢ä½“ï¼š</p>
                    <div class="formula">
                        $$\begin{vmatrix} 1 & 0 & 0 \\ 0 & 2 & 0 \\ 0 & 0 & 3 \end{vmatrix} = 6$$
                    </div>
                    <p>ä½“ç§¯ä¸º 6 ä¸ªç«‹æ–¹å•ä½ï¼Œè¿™æ˜¯ä¸€ä¸ªé•¿æ–¹ä½“ã€‚</p>
                </div>
                
                <div class="example-card">
                    <h4>â€¢ çº¿æ€§æ–¹ç¨‹ç»„åº”ç”¨</h4>
                    <p>å¯¹äºä¸‰å…ƒçº¿æ€§æ–¹ç¨‹ç»„ï¼Œå½“ç³»æ•°è¡Œåˆ—å¼ä¸ä¸ºé›¶æ—¶ï¼Œæ–¹ç¨‹ç»„æœ‰å”¯ä¸€è§£ï¼š</p>
                    <div class="formula">
                        $$x_i = \frac{D_i}{D}, \quad i = 1,2,3$$
                    </div>
                    <p>å…¶ä¸­ $D$ æ˜¯ç³»æ•°è¡Œåˆ—å¼ï¼Œ$D_i$ æ˜¯å°†ç¬¬ $i$ åˆ—æ›¿æ¢ä¸ºå¸¸æ•°é¡¹å¾—åˆ°çš„è¡Œåˆ—å¼ã€‚</p>
                </div>
                
                <div class="example-card">
                    <h4>â€¢ å‘é‡å…±é¢åˆ¤å®š</h4>
                    <p>ä¸‰ä¸ªå‘é‡å…±é¢çš„å……è¦æ¡ä»¶æ˜¯å®ƒä»¬æ„æˆçš„è¡Œåˆ—å¼ä¸ºé›¶ï¼š</p>
                    <div class="formula">
                        $$\begin{vmatrix} a_1 & b_1 & c_1 \\ a_2 & b_2 & c_2 \\ a_3 & b_3 & c_3 \end{vmatrix} = 0$$
                    </div>
                    <p>è¿™æ„å‘³ç€ä¸‰ä¸ªå‘é‡çº¿æ€§ç›¸å…³ï¼Œæ— æ³•å¼ æˆä¸‰ç»´ç©ºé—´ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // MathJax configuration
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };

        // Ensure correct navigation state
        document.addEventListener('DOMContentLoaded', function() {
            // Remove active class from all nav items
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to current page nav item
            const currentPageNav = document.querySelector('a[href="ä¸‰é˜¶è¡Œåˆ—å¼å¯è§†åŒ–.html"]');
            if (currentPageNav) {
                currentPageNav.classList.add('active');
            }
            
            // æœ¬åœ°å…¬å¼ç¼©æ”¾è§£å†³æ–¹æ¡ˆ
            function fixFormulaScaling() {
                console.log('ğŸ”§ å¼€å§‹ä¿®å¤å…¬å¼ç¼©æ”¾...');
                
                // ç­‰å¾…MathJaxæ¸²æŸ“å®Œæˆ
                setTimeout(() => {
                    const formulas = document.querySelectorAll('.formula');
                    console.log(`æ‰¾åˆ° ${formulas.length} ä¸ªå…¬å¼å®¹å™¨`);
                    
                    formulas.forEach((formula, index) => {
                        const containers = formula.querySelectorAll('mjx-container');
                        containers.forEach((container, cIndex) => {
                            try {
                                // é‡ç½®æ ·å¼
                                container.style.transform = '';
                                container.style.transformOrigin = '';
                                
                                // è·å–å°ºå¯¸
                                const formulaWidth = formula.clientWidth;
                                const containerWidth = container.scrollWidth;
                                
                                console.log(`å…¬å¼ ${index}-${cIndex}: å®¹å™¨=${formulaWidth}px, å†…å®¹=${containerWidth}px`);
                                
                                if (containerWidth > formulaWidth && formulaWidth > 100) {
                                    const scale = Math.max(0.4, (formulaWidth - 20) / containerWidth);
                                    console.log(`åº”ç”¨ç¼©æ”¾: ${scale.toFixed(3)}`);
                                    
                                    container.style.transformOrigin = 'left center';
                                    container.style.transform = `scale(${scale})`;
                                    container.style.display = 'inline-block';
                                    
                                    // è°ƒæ•´çˆ¶å®¹å™¨
                                    formula.style.overflow = 'visible';
                                    formula.style.whiteSpace = 'nowrap';
                                }
                            } catch (error) {
                                console.warn(`ç¼©æ”¾å…¬å¼æ—¶å‡ºé”™:`, error);
                            }
                        });
                    });
                }, 200);
            }
            
            // å¼ºåˆ¶è§¦å‘å…¬å¼ç¼©æ”¾ï¼ˆç­‰å¾…MathJaxæ¸²æŸ“å®Œæˆï¼‰
            setTimeout(() => {
                if (window.MathJax && window.MathJax.typesetPromise) {
                    window.MathJax.typesetPromise().then(() => {
                        console.log('ğŸ”„ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹å¼ºåˆ¶ç¼©æ”¾å…¬å¼');
                        fixFormulaScaling();
                        
                        // ä¹Ÿè§¦å‘å…¨å±€ç¼©æ”¾ä½œä¸ºå¤‡ç”¨
                        const event = new Event('resize');
                        window.dispatchEvent(event);
                    });
                } else {
                    // å¦‚æœMathJaxè¿˜æ²¡å‡†å¤‡å¥½ï¼Œç›´æ¥å°è¯•ç¼©æ”¾
                    fixFormulaScaling();
                }
            }, 800);
        });

        // Get input elements
        const inputs = {
            a11: document.getElementById('a11'),
            a12: document.getElementById('a12'),
            a13: document.getElementById('a13'),
            a21: document.getElementById('a21'),
            a22: document.getElementById('a22'),
            a23: document.getElementById('a23'),
            a31: document.getElementById('a31'),
            a32: document.getElementById('a32'),
            a33: document.getElementById('a33')
        };

        // Add event listeners
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', updateVisualization);
        });

        function setPreset(type) {
            const presets = {
                identity: [1, 0, 0, 0, 1, 0, 0, 0, 1],
                example1: [1, 2, -4, -2, 2, 1, 3, -4, -2],
                example2: [2, -1, 3, 1, 4, -2, -1, 2, 1],
                zero: [1, 2, 3, 2, 4, 6, 1, 2, 3]
            };
            
            const values = presets[type];
            if (values) {
                const keys = Object.keys(inputs);
                values.forEach((value, index) => {
                    inputs[keys[index]].value = value;
                });
                updateVisualization();
            }
        }

        function calculateDeterminant3x3(matrix) {
            const [[a11, a12, a13], [a21, a22, a23], [a31, a32, a33]] = matrix;
            
            // å¯¹è§’çº¿æ³•
            const positive = a11*a22*a33 + a12*a23*a31 + a13*a21*a32;
            const negative = a13*a22*a31 + a12*a21*a33 + a11*a23*a32;
            
            return {
                determinant: positive - negative,
                positive: positive,
                negative: negative,
                positiveTerms: `${a11}Ã—${a22}Ã—${a33} + ${a12}Ã—${a23}Ã—${a31} + ${a13}Ã—${a21}Ã—${a32} = ${positive}`,
                negativeTerms: `${a13}Ã—${a22}Ã—${a31} + ${a12}Ã—${a21}Ã—${a33} + ${a11}Ã—${a23}Ã—${a32} = ${negative}`
            };
        }

        function updateVisualization() {
            // Get matrix values
            const matrix = [
                [parseFloat(inputs.a11.value) || 0, parseFloat(inputs.a12.value) || 0, parseFloat(inputs.a13.value) || 0],
                [parseFloat(inputs.a21.value) || 0, parseFloat(inputs.a22.value) || 0, parseFloat(inputs.a23.value) || 0],
                [parseFloat(inputs.a31.value) || 0, parseFloat(inputs.a32.value) || 0, parseFloat(inputs.a33.value) || 0]
            ];

            // Calculate determinant
            const result = calculateDeterminant3x3(matrix);
            const det = result.determinant;

            // Update display values
            document.getElementById('determinant-result').textContent = det.toFixed(2);
            document.getElementById('volume-display').textContent = Math.abs(det).toFixed(2);
            document.getElementById('det-display').innerHTML = `\\(${det.toFixed(2)}\\)`;
            document.getElementById('abs-volume-display').textContent = Math.abs(det).toFixed(2);
            
            // Update vector displays
            // å°†å‘é‡å†…å®¹æ”¹ä¸º LaTeX è¡Œå†…å…¬å¼ï¼Œä¾¿äºç»Ÿä¸€æ¸²æŸ“ä¸ç¼©æ”¾
            document.getElementById('v1-display').innerHTML = `\\(${matrix[0][0]}, ${matrix[1][0]}, ${matrix[2][0]}\\)`;
            document.getElementById('v2-display').innerHTML = `\\(${matrix[0][1]}, ${matrix[1][1]}, ${matrix[2][1]}\\)`;
            document.getElementById('v3-display').innerHTML = `\\(${matrix[0][2]}, ${matrix[1][2]}, ${matrix[2][2]}\\)`;

            // Update calculation steps
            // === Update calculation stepsï¼ˆ3Ã—3 å¯¹è§’çº¿æ³•ï¼‰ï¼šè´Ÿæ•°è‡ªåŠ¨åŠ æ‹¬å· ===
            const fmt = v => (Number(v) < 0 ? `(${v})` : `${v}`);

            // æ‹†å‡ºå…ƒç´ ï¼Œä¾¿äºä¹¦å†™
            const [a11, a12, a13] = matrix[0];
            const [a21, a22, a23] = matrix[1];
            const [a31, a32, a33] = matrix[2];  

            // æ­£å¯¹è§’çº¿ä¸‰é¡¹
            const posStr =
              `${fmt(a11)} Ã— ${fmt(a22)} Ã— ${fmt(a33)}`
            + ` + ${fmt(a12)} Ã— ${fmt(a23)} Ã— ${fmt(a31)}`
            + ` + ${fmt(a13)} Ã— ${fmt(a21)} Ã— ${fmt(a32)}`;

            // è´Ÿå¯¹è§’çº¿ä¸‰é¡¹
            const negStr =
              `${fmt(a13)} Ã— ${fmt(a22)} Ã— ${fmt(a31)}`
            + ` + ${fmt(a11)} Ã— ${fmt(a23)} Ã— ${fmt(a32)}`
            + ` + ${fmt(a12)} Ã— ${fmt(a21)} Ã— ${fmt(a33)}`;

            // å†™å…¥é¡µé¢ï¼ˆä½¿ç”¨ LaTeX ä¿ç•™ç¬¦å·ï¼Œå¦‚ (-4)ï¼‰
            document.getElementById('positive-terms').innerHTML = `\\( ${fmt(a11)} \\times ${fmt(a22)} \\times ${fmt(a33)} + ${fmt(a12)} \\times ${fmt(a23)} \\times ${fmt(a31)} + ${fmt(a13)} \\times ${fmt(a21)} \\times ${fmt(a32)} \\)`;
            document.getElementById('negative-terms').innerHTML = `\\( ${fmt(a13)} \\times ${fmt(a22)} \\times ${fmt(a31)} + ${fmt(a11)} \\times ${fmt(a23)} \\times ${fmt(a32)} + ${fmt(a12)} \\times ${fmt(a21)} \\times ${fmt(a33)} \\)`;
            document.getElementById('final-calculation').innerHTML = `\\( ${result.positive.toFixed(2)} - (${result.negative.toFixed(2)}) = ${det.toFixed(2)} \\)`;
            
            // å±€éƒ¨æ’ç‰ˆä¸è‡ªé€‚åº”ç¼©æ”¾ï¼ˆä¾èµ–å…¨å±€è„šæœ¬æä¾›çš„å‡½æ•°ï¼‰
            if (window.MathJax && window.MathJax.typesetPromise) {
              window.MathJax.typesetPromise([
                document.querySelector('.calculation-steps'),
                document.querySelector('.visualization-section')
              ]).then(() => {
                // ç¼©æ”¾ç”±å…¨å±€è„šæœ¬çš„ fitAllMath è´Ÿè´£ï¼›è‹¥ä¸å­˜åœ¨åˆ™å…œåº•åšä¸€æ¬¡å±€éƒ¨ç¼©æ”¾
                if (typeof fitAllMath === 'function') {
                  fitAllMath(document.querySelector('.calculation-steps'));
                  fitAllMath(document.querySelector('.visualization-section'));
                } else {
                  const scope = document.querySelector('.calculation-steps');
                  (scope?.querySelectorAll('mjx-container') || []).forEach(eq => {
                    const parent = eq.parentElement;
                    if (!parent) return;
                    const parentWidth = parent.clientWidth || 1;
                    const actualWidth = eq.scrollWidth || eq.getBoundingClientRect().width || 1;
                    const scale = Math.min(1, parentWidth / actualWidth);
                    eq.style.transformOrigin = 'left top';
                    eq.style.transform = (scale < 1) ? `scale(${scale})` : '';
                    parent.style.overflowX = parent.style.overflowX || 'auto';
                  });
                }
              }).catch(err => console.log('MathJax typeset error:', err.message));
            }

            // Update 3D plot
            updatePlot3D(matrix, det);
        }

        function updatePlot3D(matrix, det) {
            // Extract column vectors
            const v1 = [matrix[0][0], matrix[1][0], matrix[2][0]];
            const v2 = [matrix[0][1], matrix[1][1], matrix[2][1]];
            const v3 = [matrix[0][2], matrix[1][2], matrix[2][2]];

            // Create traces for vectors
            const traces = [
                // Vector v1
                {
                    x: [0, v1[0]],
                    y: [0, v1[1]],
                    z: [0, v1[2]],
                    mode: 'lines+markers',
                    line: { color: '#e53e3e', width: 6 },
                    marker: { size: 6 },
                    name: 'vâ‚',
                    type: 'scatter3d'
                },
                // Vector v2
                {
                    x: [0, v2[0]],
                    y: [0, v2[1]],
                    z: [0, v2[2]],
                    mode: 'lines+markers',
                    line: { color: '#3182ce', width: 6 },
                    marker: { size: 6 },
                    name: 'vâ‚‚',
                    type: 'scatter3d'
                },
                // Vector v3
                {
                    x: [0, v3[0]],
                    y: [0, v3[1]],
                    z: [0, v3[2]],
                    mode: 'lines+markers',
                    line: { color: '#38a169', width: 6 },
                    marker: { size: 6 },
                    name: 'vâ‚ƒ',
                    type: 'scatter3d'
                }
            ];

            // Add parallelepiped edges if determinant is not too large
            if (Math.abs(det) < 1000) {
                const vertices = [
                    [0, 0, 0],                                    // Origin
                    v1,                                           // v1
                    v2,                                           // v2
                    v3,                                           // v3
                    [v1[0] + v2[0], v1[1] + v2[1], v1[2] + v2[2]], // v1 + v2
                    [v1[0] + v3[0], v1[1] + v3[1], v1[2] + v3[2]], // v1 + v3
                    [v2[0] + v3[0], v2[1] + v3[1], v2[2] + v3[2]], // v2 + v3
                    [v1[0] + v2[0] + v3[0], v1[1] + v2[1] + v3[1], v1[2] + v2[2] + v3[2]] // v1 + v2 + v3
                ];

                // Define the 12 edges of the parallelepiped
                const edges = [
                    [0, 1], [0, 2], [0, 3],           // From origin
                    [1, 4], [1, 5],                   // From v1
                    [2, 4], [2, 6],                   // From v2
                    [3, 5], [3, 6],                   // From v3
                    [4, 7], [5, 7], [6, 7]            // To opposite vertex
                ];

                edges.forEach((edge, index) => {
                    const [start, end] = edge;
                    traces.push({
                        x: [vertices[start][0], vertices[end][0]],
                        y: [vertices[start][1], vertices[end][1]],
                        z: [vertices[start][2], vertices[end][2]],
                        mode: 'lines',
                        line: { 
                            color: det >= 0 ? 'rgba(72, 187, 120, 0.6)' : 'rgba(245, 101, 101, 0.6)', 
                            width: 3 
                        },
                        showlegend: false,
                        type: 'scatter3d',
                        hoverinfo: 'skip'
                    });
                });
            }

            // Add coordinate axes
            const axisLength = 5;
            traces.push(
                // X-axis
                {
                    x: [0, axisLength],
                    y: [0, 0],
                    z: [0, 0],
                    mode: 'lines',
                    line: { color: 'rgba(0,0,0,0.3)', width: 2 },
                    showlegend: false,
                    type: 'scatter3d',
                    hoverinfo: 'skip'
                },
                // Y-axis
                {
                    x: [0, 0],
                    y: [0, axisLength],
                    z: [0, 0],
                    mode: 'lines',
                    line: { color: 'rgba(0,0,0,0.3)', width: 2 },
                    showlegend: false,
                    type: 'scatter3d',
                    hoverinfo: 'skip'
                },
                // Z-axis
                {
                    x: [0, 0],
                    y: [0, 0],
                    z: [0, axisLength],
                    mode: 'lines',
                    line: { color: 'rgba(0,0,0,0.3)', width: 2 },
                    showlegend: false,
                    type: 'scatter3d',
                    hoverinfo: 'skip'
                }
            );

            const layout = {
                title: {
                    text: `ä¸‰é˜¶è¡Œåˆ—å¼çš„å‡ ä½•æ„ä¹‰ (det = ${det.toFixed(2)})`,
                    font: { size: 16 }
                },
                scene: {
                    xaxis: { title: 'X', range: [-6, 6] },
                    yaxis: { title: 'Y', range: [-6, 6] },
                    zaxis: { title: 'Z', range: [-6, 6] },
                    aspectmode: 'cube',
                    camera: {
                        eye: { x: 1.5, y: 1.5, z: 1.5 }
                    }
                },
                showlegend: true,
                legend: {
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(255, 255, 255, 0.8)',
                    bordercolor: '#4a5568',
                    borderwidth: 1
                },
                margin: { l: 0, r: 0, t: 50, b: 0 },
                plot_bgcolor: '#f8f9fa',
                paper_bgcolor: 'white'
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
            };

            Plotly.newPlot('plot', traces, layout, config);
        }

        function goBack() {
            window.location.href = '../index.html';
        }

        // Initialize visualization
        updateVisualization();
    </script>
</body>
</html>