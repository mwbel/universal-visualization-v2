<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å¯è§†åŒ–åŠŸèƒ½æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .demo-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .demo-header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .demo-header p {
            color: #666;
            font-size: 1.1em;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .mode-btn.active {
            background: #007bff;
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,123,255,0.3);
        }

        .input-container {
            margin-bottom: 20px;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #007bff;
        }

        .generate-btn {
            display: block;
            width: 200px;
            margin: 0 auto;
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .generate-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.4);
        }

        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results-section {
            margin-top: 30px;
            min-height: 200px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .recommendation-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .recommendation-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .recommendation-card.selected {
            border-color: #007bff;
            background: #f8f9ff;
        }

        .rec-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .rec-description {
            color: #666;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .rec-confidence {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .confidence-excellent {
            background: #d4edda;
            color: #155724;
        }

        .confidence-good {
            background: #cce5ff;
            color: #004085;
        }

        .confidence-fair {
            background: #fff3cd;
            color: #856404;
        }

        .visualization-output {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 400px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
        }

        .demo-instructions {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .demo-instructions h3 {
            margin-top: 0;
            color: #004085;
        }

        .demo-instructions ul {
            margin-bottom: 0;
        }

        .demo-instructions li {
            margin-bottom: 8px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-top: 20px;
            border-top: 1px solid #e0e0e0;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>ğŸš€ æ™ºèƒ½å¯è§†åŒ–åŠŸèƒ½æ¼”ç¤º</h1>
            <p>ä½“éªŒä¸‰ç§è¾“å…¥æ¨¡å¼çš„æ™ºèƒ½å¯è§†åŒ–ç”Ÿæˆ</p>
        </div>

        <div class="demo-instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li><strong>æ–‡æœ¬è¾“å…¥æ¨¡å¼</strong>ï¼šè¾“å…¥è‡ªç„¶è¯­è¨€æè¿°ï¼Œå¦‚"æ˜¾ç¤ºæ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œå‡å€¼0ï¼Œæ ‡å‡†å·®1"</li>
                <li><strong>æ¨¡æ¿é€‰æ‹©æ¨¡å¼</strong>ï¼šè¾“å…¥æ¨¡æ¿åç§°ï¼Œå¦‚"normal_distribution"</li>
                <li><strong>æ¦‚å¿µæœç´¢æ¨¡å¼</strong>ï¼šè¾“å…¥å…³é”®è¯ï¼Œå¦‚"æ¦‚ç‡åˆ†å¸ƒ"æˆ–"å‡½æ•°å›¾åƒ"</li>
            </ul>
        </div>

        <div class="input-section">
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="text">ğŸ“ æ–‡æœ¬è¾“å…¥</button>
                <button class="mode-btn" data-mode="template">ğŸ“‹ æ¨¡æ¿é€‰æ‹©</button>
                <button class="mode-btn" data-mode="concept">ğŸ” æ¦‚å¿µæœç´¢</button>
            </div>

            <div class="input-container">
                <input
                    type="text"
                    class="input-field"
                    id="userInput"
                    placeholder="è¯·è¾“å…¥æ‚¨çš„å¯è§†åŒ–éœ€æ±‚..."
                    value="æ˜¾ç¤ºæ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œå‡å€¼0ï¼Œæ ‡å‡†å·®1"
                >
            </div>

            <button class="generate-btn" id="generateBtn" onclick="generateVisualization()">
                ç”Ÿæˆå¯è§†åŒ–
            </button>
        </div>

        <div class="results-section" id="resultsSection">
            <!-- ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>

        <div class="status-bar">
            <span id="statusText">å°±ç»ª</span>
            <span id="performanceText"></span>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„JavaScriptåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- å¼•å…¥æˆ‘ä»¬çš„ç»„ä»¶ -->
    <script src="../components/IntelligentInputProcessor.js"></script>
    <script src="../components/TemplateMatchingSystem.js"></script>
    <script src="../components/VisualizationEngine.js"></script>
    <script src="../components/PageBuilder.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let currentMode = 'text';
        let inputProcessor;
        let templateMatcher;
        let visualizationEngine;
        let pageBuilder;

        // ç¤ºä¾‹æ¨¡æ¿æ•°æ®
        const sampleTemplates = [
            {
                id: 'normal_distribution',
                name: 'æ­£æ€åˆ†å¸ƒ',
                description: 'æ ‡å‡†æ­£æ€åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°',
                category: 'mathematics',
                categoryName: 'æ•°å­¦å¯è§†åŒ–',
                tags: ['æ¦‚ç‡', 'ç»Ÿè®¡', 'åˆ†å¸ƒ', 'é«˜æ–¯åˆ†å¸ƒ'],
                keywords: ['æ­£æ€', 'é«˜æ–¯', 'normal', 'gaussian', 'é’Ÿå½¢æ›²çº¿'],
                parameters: [
                    { name: 'mu', label: 'å‡å€¼', default: 0, min: -10, max: 10 },
                    { name: 'sigma', label: 'æ ‡å‡†å·®', default: 1, min: 0.1, max: 5 }
                ]
            },
            {
                id: 'quadratic_function',
                name: 'äºŒæ¬¡å‡½æ•°',
                description: 'äºŒæ¬¡å‡½æ•° y = axÂ² + bx + c çš„å›¾åƒ',
                category: 'mathematics',
                categoryName: 'æ•°å­¦å¯è§†åŒ–',
                tags: ['å‡½æ•°', 'ä»£æ•°', 'æŠ›ç‰©çº¿'],
                keywords: ['äºŒæ¬¡', 'æŠ›ç‰©çº¿', 'quadratic', 'å¤šé¡¹å¼'],
                parameters: [
                    { name: 'a', label: 'äºŒæ¬¡é¡¹ç³»æ•°', default: 1, min: -5, max: 5 },
                    { name: 'b', label: 'ä¸€æ¬¡é¡¹ç³»æ•°', default: 2, min: -10, max: 10 },
                    { name: 'c', label: 'å¸¸æ•°é¡¹', default: 1, min: -10, max: 10 }
                ]
            },
            {
                id: 'simple_harmonic_motion',
                name: 'ç®€è°æŒ¯åŠ¨',
                description: 'ç®€è°æŒ¯åŠ¨çš„ä½ç§»æ—¶é—´å›¾åƒ',
                category: 'physics',
                categoryName: 'ç‰©ç†å­¦å¯è§†åŒ–',
                tags: ['æŒ¯åŠ¨', 'ç®€è°è¿åŠ¨', 'å‘¨æœŸ'],
                keywords: ['ç®€è°', 'æŒ¯åŠ¨', 'å¼¹ç°§', 'SHM'],
                parameters: [
                    { name: 'amplitude', label: 'æŒ¯å¹…', default: 1, min: 0.1, max: 5 },
                    { name: 'frequency', label: 'é¢‘ç‡', default: 1, min: 0.1, max: 5 },
                    { name: 'phase', label: 'ç›¸ä½', default: 0, min: -3.14, max: 3.14 }
                ]
            }
        ];

        // ç¤ºä¾‹æ¦‚å¿µæ•°æ®
        const sampleConcepts = [
            {
                id: 'normal_distribution',
                name: 'æ­£æ€åˆ†å¸ƒ',
                description: 'æœ€é‡è¦çš„è¿ç»­æ¦‚ç‡åˆ†å¸ƒ',
                category: 'math',
                tags: ['æ¦‚ç‡åˆ†å¸ƒ', 'è¿ç»­åˆ†å¸ƒ', 'é«˜æ–¯åˆ†å¸ƒ']
            },
            {
                id: 'harmonic_motion',
                name: 'ç®€è°è¿åŠ¨',
                description: 'å‘¨æœŸæ€§æŒ¯åŠ¨çš„åŸºæœ¬å½¢å¼',
                category: 'physics',
                tags: ['æŒ¯åŠ¨', 'å‘¨æœŸè¿åŠ¨', 'å¼¹ç°§æŒ¯å­']
            },
            {
                id: 'parabolic_function',
                name: 'æŠ›ç‰©çº¿å‡½æ•°',
                description: 'äºŒæ¬¡å‡½æ•°çš„å›¾åƒè¡¨ç°å½¢å¼',
                category: 'math',
                tags: ['äºŒæ¬¡å‡½æ•°', 'æŠ›ç‰©çº¿', 'å‡½æ•°å›¾åƒ']
            }
        ];

        // åˆå§‹åŒ–åº”ç”¨
        async function initializeApp() {
            try {
                updateStatus('æ­£åœ¨åˆå§‹åŒ–æ™ºèƒ½å¯è§†åŒ–ç³»ç»Ÿ...');

                // è®¾ç½®å…¨å±€æ¨¡æ¿æ•°æ®
                window.templates = sampleTemplates;
                window.concepts = sampleConcepts;

                // åˆå§‹åŒ–ç»„ä»¶
                templateMatcher = new TemplateMatchingSystem(sampleTemplates);
                inputProcessor = new IntelligentInputProcessor();
                visualizationEngine = new VisualizationEngine();
                pageBuilder = new PageBuilder();

                updateStatus('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨');

                // è®¾ç½®ç¤ºä¾‹
                document.getElementById('userInput').value = 'æ˜¾ç¤ºæ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œå‡å€¼0ï¼Œæ ‡å‡†å·®1';

            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                updateStatus('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                showError('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // æ¨¡å¼åˆ‡æ¢
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentMode = this.dataset.mode;
                updateInputPlaceholder();
            });
        });

        // æ›´æ–°è¾“å…¥æç¤º
        function updateInputPlaceholder() {
            const input = document.getElementById('userInput');
            const placeholders = {
                'text': 'è¯·è¾“å…¥æ‚¨çš„å¯è§†åŒ–éœ€æ±‚ï¼Œå¦‚"æ˜¾ç¤ºæ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œå‡å€¼0ï¼Œæ ‡å‡†å·®1"',
                'template': 'è¯·è¾“å…¥æ¨¡æ¿åç§°ï¼Œå¦‚"normal_distribution"',
                'concept': 'è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼Œå¦‚"æ¦‚ç‡åˆ†å¸ƒ"æˆ–"å‡½æ•°å›¾åƒ"'
            };
            input.placeholder = placeholders[currentMode];
        }

        // ç”Ÿæˆå¯è§†åŒ–
        async function generateVisualization() {
            const userInput = document.getElementById('userInput').value.trim();
            const resultsSection = document.getElementById('resultsSection');
            const generateBtn = document.getElementById('generateBtn');

            if (!userInput) {
                showError('è¯·è¾“å…¥æ‚¨çš„éœ€æ±‚');
                return;
            }

            try {
                // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                generateBtn.disabled = true;
                generateBtn.textContent = 'ç”Ÿæˆä¸­...';
                resultsSection.innerHTML = '<div class="loading">æ­£åœ¨æ™ºèƒ½åˆ†ææ‚¨çš„éœ€æ±‚...</div>';
                updateStatus('æ­£åœ¨å¤„ç†è¾“å…¥...');

                const startTime = Date.now();

                // æ ¹æ®æ¨¡å¼å¤„ç†è¾“å…¥
                let result;
                switch (currentMode) {
                    case 'text':
                        result = await inputProcessor.processInput(userInput, { mode: 'text' });
                        break;
                    case 'template':
                        result = await inputProcessor.processInput(userInput, { mode: 'template' });
                        break;
                    case 'concept':
                        result = await inputProcessor.processInput(userInput, { mode: 'concept' });
                        break;
                }

                updateStatus('æ­£åœ¨ç”Ÿæˆæ¨è...');
                displayRecommendations(result);

                const processingTime = Date.now() - startTime;
                updatePerformance(`å¤„ç†æ—¶é—´: ${processingTime}ms`);

            } catch (error) {
                console.error('ç”Ÿæˆå¤±è´¥:', error);
                showError('ç”Ÿæˆå¤±è´¥: ' + error.message);
                updateStatus('ç”Ÿæˆå¤±è´¥');
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'ç”Ÿæˆå¯è§†åŒ–';
            }
        }

        // æ˜¾ç¤ºæ¨èç»“æœ
        function displayRecommendations(result) {
            const resultsSection = document.getElementById('resultsSection');

            let recommendations = [];

            if (result.mode === 'text' && result.recommendations) {
                recommendations = result.recommendations;
            } else if (result.mode === 'template' && result.templates) {
                recommendations = result.templates.map(t => ({
                    template: t.template,
                    confidence: 'excellent',
                    recommendation: `æ¨¡æ¿åŒ¹é…: ${t.template.name}`
                }));
            } else if (result.mode === 'concept' && result.concepts) {
                recommendations = result.concepts.slice(0, 5).map(c => ({
                    template: c,
                    confidence: 'good',
                    recommendation: `æ¦‚å¿µåŒ¹é…: ${c.name}`
                }));
            }

            if (recommendations.length === 0) {
                resultsSection.innerHTML = `
                    <div class="error-message">
                        æœªèƒ½æ‰¾åˆ°åˆé€‚çš„å¯è§†åŒ–æ¨¡æ¿ï¼Œè¯·å°è¯•è°ƒæ•´æ‚¨çš„æè¿°ã€‚
                    </div>
                `;
                return;
            }

            // æ˜¾ç¤ºæ¨èå¡ç‰‡
            const recommendationsHtml = recommendations.map((rec, index) => {
                const template = rec.template;
                const confidenceClass = `confidence-${rec.confidence || 'good'}`;

                return `
                    <div class="recommendation-card" onclick="selectRecommendation(${index})" data-index="${index}">
                        <div class="rec-title">${template.name || template.id}</div>
                        <div class="rec-description">${template.description || 'æ— æè¿°'}</div>
                        <span class="rec-confidence ${confidenceClass}">${rec.recommendation}</span>
                    </div>
                `;
            }).join('');

            resultsSection.innerHTML = `
                <h3>ğŸ¯ æ¨èçš„å¯è§†åŒ–æ–¹æ¡ˆ</h3>
                <div class="recommendations">
                    ${recommendationsHtml}
                </div>
                <div class="visualization-output" id="visualizationOutput">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        è¯·é€‰æ‹©ä¸€ä¸ªæ¨èæ–¹æ¡ˆæ¥ç”Ÿæˆå¯è§†åŒ–
                    </p>
                </div>
            `;

            // å­˜å‚¨æ¨èç»“æœä¾›åç»­ä½¿ç”¨
            window.currentRecommendations = recommendations;
        }

        // é€‰æ‹©æ¨èæ–¹æ¡ˆ
        async function selectRecommendation(index) {
            const recommendations = window.currentRecommendations;
            if (!recommendations || !recommendations[index]) return;

            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.recommendation-card').forEach((card, i) => {
                if (i === index) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });

            const selected = recommendations[index];
            const template = selected.template;

            try {
                updateStatus('æ­£åœ¨ç”Ÿæˆå¯è§†åŒ–...');
                const vizOutput = document.getElementById('visualizationOutput');
                vizOutput.innerHTML = '<div class="loading">æ­£åœ¨ç”Ÿæˆå¯è§†åŒ–...</div>';

                // åˆ›å»ºå¯è§†åŒ–é…ç½®
                const vizConfig = {
                    type: 'chart',
                    category: template.category || 'mathematics',
                    template: template,
                    parameters: template.parameters || [],
                    width: 800,
                    height: 400,
                    title: template.name,
                    description: template.description
                };

                // ç”Ÿæˆå¯è§†åŒ–
                const visualization = await visualizationEngine.generate(vizConfig);

                // æ˜¾ç¤ºç»“æœ
                displayVisualization(visualization, template);

                updateStatus('å¯è§†åŒ–ç”Ÿæˆå®Œæˆ');

            } catch (error) {
                console.error('å¯è§†åŒ–ç”Ÿæˆå¤±è´¥:', error);
                document.getElementById('visualizationOutput').innerHTML = `
                    <div class="error-message">
                        å¯è§†åŒ–ç”Ÿæˆå¤±è´¥: ${error.message}
                    </div>
                `;
                updateStatus('å¯è§†åŒ–ç”Ÿæˆå¤±è´¥');
            }
        }

        // æ˜¾ç¤ºå¯è§†åŒ–ç»“æœ
        function displayVisualization(visualization, template) {
            const vizOutput = document.getElementById('visualizationOutput');

            // åˆ›å»ºæ§åˆ¶é¢æ¿
            const controlsHtml = createControlsHtml(template.parameters || []);

            vizOutput.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h4>${template.name}</h4>
                    <p style="color: #666; margin: 10px 0;">${template.description}</p>
                </div>
                ${controlsHtml}
                <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #e0e0e0;">
                    <canvas id="generatedChart" width="800" height="400"></canvas>
                </div>
            `;

            // æ¸²æŸ“å›¾è¡¨
            setTimeout(() => {
                renderChart(template);
            }, 100);
        }

        // åˆ›å»ºæ§åˆ¶é¢æ¿HTML
        function createControlsHtml(parameters) {
            if (!parameters || parameters.length === 0) return '';

            return `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h5 style="margin-top: 0;">å‚æ•°è°ƒæ•´</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        ${parameters.map(param => `
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 500;">
                                    ${param.label} (${param.name})
                                </label>
                                <input type="range"
                                    id="param_${param.name}"
                                    min="${param.min}"
                                    max="${param.max}"
                                    step="${param.step || 0.1}"
                                    value="${param.default}"
                                    oninput="updateParameter('${param.name}', this.value)"
                                    style="width: 100%;">
                                <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                                    <span>${param.min}</span>
                                    <span id="value_${param.name}">${param.default}</span>
                                    <span>${param.max}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="regenerateVisualization()" style="margin-top: 10px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        é‡æ–°ç”Ÿæˆ
                    </button>
                </div>
            `;
        }

        // æ¸²æŸ“å›¾è¡¨
        function renderChart(template) {
            const canvas = document.getElementById('generatedChart');
            if (!canvas || !window.Chart) return;

            const ctx = canvas.getContext('2d');

            // æ ¹æ®æ¨¡æ¿ç±»å‹ç”Ÿæˆä¸åŒçš„å›¾è¡¨
            let chartConfig;

            switch (template.id) {
                case 'normal_distribution':
                    chartConfig = createNormalDistributionChart();
                    break;
                case 'quadratic_function':
                    chartConfig = createQuadraticFunctionChart();
                    break;
                case 'simple_harmonic_motion':
                    chartConfig = createHarmonicMotionChart();
                    break;
                default:
                    chartConfig = createDefaultChart();
            }

            // é”€æ¯ä¹‹å‰çš„å›¾è¡¨
            if (window.currentChart) {
                window.currentChart.destroy();
            }

            // åˆ›å»ºæ–°å›¾è¡¨
            window.currentChart = new Chart(ctx, chartConfig);
        }

        // åˆ›å»ºæ­£æ€åˆ†å¸ƒå›¾è¡¨
        function createNormalDistributionChart() {
            const mu = parseFloat(document.getElementById('param_mu')?.value || 0);
            const sigma = parseFloat(document.getElementById('param_sigma')?.value || 1);

            const data = [];
            const labels = [];
            for (let x = -4 * sigma; x <= 4 * sigma; x += sigma / 10) {
                const y = (1 / (sigma * Math.sqrt(2 * Math.PI))) *
                         Math.exp(-0.5 * Math.pow((x - mu) / sigma, 2));
                labels.push(x.toFixed(2));
                data.push(y);
            }

            return {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `æ­£æ€åˆ†å¸ƒ (Î¼=${mu}, Ïƒ=${sigma})`,
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'æ­£æ€åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'æ¦‚ç‡å¯†åº¦'
                            }
                        }
                    }
                }
            };
        }

        // åˆ›å»ºäºŒæ¬¡å‡½æ•°å›¾è¡¨
        function createQuadraticFunctionChart() {
            const a = parseFloat(document.getElementById('param_a')?.value || 1);
            const b = parseFloat(document.getElementById('param_b')?.value || 2);
            const c = parseFloat(document.getElementById('param_c')?.value || 1);

            const data = [];
            const labels = [];
            for (let x = -10; x <= 10; x += 0.5) {
                const y = a * x * x + b * x + c;
                labels.push(x.toFixed(1));
                data.push(y);
            }

            return {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `y = ${a}xÂ² + ${b}x + ${c}`,
                        data: data,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'äºŒæ¬¡å‡½æ•°å›¾åƒ'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'y'
                            }
                        }
                    }
                }
            };
        }

        // åˆ›å»ºç®€è°è¿åŠ¨å›¾è¡¨
        function createHarmonicMotionChart() {
            const amplitude = parseFloat(document.getElementById('param_amplitude')?.value || 1);
            const frequency = parseFloat(document.getElementById('param_frequency')?.value || 1);
            const phase = parseFloat(document.getElementById('param_phase')?.value || 0);

            const data = [];
            const labels = [];
            for (let t = 0; t <= 10; t += 0.1) {
                const y = amplitude * Math.sin(2 * Math.PI * frequency * t + phase);
                labels.push(t.toFixed(1));
                data.push(y);
            }

            return {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `ç®€è°æŒ¯åŠ¨ (A=${amplitude}, f=${frequency}Hz, Ï†=${phase.toFixed(2)})`,
                        data: data,
                        borderColor: 'rgb(54, 162, 235)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç®€è°æŒ¯åŠ¨ä½ç§»-æ—¶é—´å›¾åƒ'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ—¶é—´ (s)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ä½ç§»'
                            }
                        }
                    }
                }
            };
        }

        // åˆ›å»ºé»˜è®¤å›¾è¡¨
        function createDefaultChart() {
            return {
                type: 'line',
                data: {
                    labels: ['1', '2', '3', '4', '5'],
                    datasets: [{
                        label: 'ç¤ºä¾‹æ•°æ®',
                        data: [12, 19, 3, 5, 2],
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç¤ºä¾‹å›¾è¡¨'
                        }
                    }
                }
            };
        }

        // æ›´æ–°å‚æ•°æ˜¾ç¤º
        function updateParameter(paramName, value) {
            const valueDisplay = document.getElementById(`value_${paramName}`);
            if (valueDisplay) {
                valueDisplay.textContent = parseFloat(value).toFixed(2);
            }
        }

        // é‡æ–°ç”Ÿæˆå¯è§†åŒ–
        function regenerateVisualization() {
            const selectedCard = document.querySelector('.recommendation-card.selected');
            if (selectedCard) {
                const index = parseInt(selectedCard.dataset.index);
                selectRecommendation(index);
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.innerHTML = `
                <div class="error-message">
                    <strong>é”™è¯¯:</strong> ${message}
                </div>
            `;
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(text) {
            document.getElementById('statusText').textContent = text;
        }

        // æ›´æ–°æ€§èƒ½ä¿¡æ¯
        function updatePerformance(text) {
            document.getElementById('performanceText').textContent = text;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeApp);

        // æ·»åŠ é”®ç›˜å¿«æ·é”®
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                generateVisualization();
            }
        });
    </script>
</body>
</html>