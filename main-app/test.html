<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯ç»„ä»¶æµ‹è¯•</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
</head>
<body>
    <div class="container">
        <h1>å‰ç«¯ç»„ä»¶åŠŸèƒ½æµ‹è¯•</h1>

        <!-- æµ‹è¯•æ™ºèƒ½è¾“å…¥æ¡† -->
        <section style="margin: 20px 0; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
            <h2>SmartInput ç»„ä»¶æµ‹è¯•</h2>
            <textarea id="testInput" class="smart-input" placeholder="è¾“å…¥æµ‹è¯•å†…å®¹..." rows="3"></textarea>
            <div class="input-footer">
                <span class="char-count">0 / 100</span>
                <button class="generate-btn" id="testGenerateBtn" disabled>ç”Ÿæˆæµ‹è¯•</button>
            </div>
            <div id="testSuggestions" class="suggestions-container" style="display: none;">
                <div class="suggestions-header">
                    <span class="suggestions-title">ğŸ’¡ æ™ºèƒ½å»ºè®®</span>
                    <button class="close-suggestions" onclick="hideTestSuggestions()">Ã—</button>
                </div>
                <div class="suggestions-list" id="testSuggestionsList">
                </div>
            </div>
        </section>

        <!-- æµ‹è¯•APIå®¢æˆ·ç«¯ -->
        <section style="margin: 20px 0; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
            <h2>ApiClient ç»„ä»¶æµ‹è¯•</h2>
            <button class="btn" onclick="testAPI()">æµ‹è¯•APIè¿æ¥</button>
            <button class="btn" onclick="testAPIClient()">æµ‹è¯•APIå®¢æˆ·ç«¯</button>
            <div id="apiResults" style="margin-top: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 4px;">
                <pre id="apiOutput">ç­‰å¾…æµ‹è¯•ç»“æœ...</pre>
            </div>
        </section>

        <!-- æµ‹è¯•æ¨¡æ¿é€‰æ‹©å™¨ -->
        <section style="margin: 20px 0; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
            <h2>TemplateSelector ç»„ä»¶æµ‹è¯•</h2>
            <input type="text" id="testTemplateSearch" class="template-search-input" placeholder="æœç´¢æ¨¡æ¿...">
            <div id="testTemplateCategories" style="margin-top: 10px;">
                <!-- æ¨¡æ¿å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
        </section>

        <!-- æµ‹è¯•çŠ¶æ€ç®¡ç† -->
        <section style="margin: 20px 0; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
            <h2>StateManager ç»„ä»¶æµ‹è¯•</h2>
            <button class="btn" onclick="testStateUpdate()">æ›´æ–°çŠ¶æ€</button>
            <button class="btn" onclick="testStateGet()">è·å–çŠ¶æ€</button>
            <div id="stateResults" style="margin-top: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 4px;">
                <pre id="stateOutput">ç­‰å¾…æµ‹è¯•ç»“æœ...</pre>
            </div>
        </section>

        <!-- æµ‹è¯•åŠ è½½çŠ¶æ€ -->
        <section style="margin: 20px 0; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
            <h2>LoadingStates ç»„ä»¶æµ‹è¯•</h2>
            <button class="btn" onclick="testLoading()">æ˜¾ç¤ºåŠ è½½çŠ¶æ€</button>
            <button class="btn" onclick="testLoadingProgress()">æµ‹è¯•è¿›åº¦æ›´æ–°</button>
            <button class="btn" onclick="hideTestLoading()">éšè—åŠ è½½çŠ¶æ€</button>
        </section>
    </div>

    <!-- åŠ è½½é®ç½© -->
    <div class="loading-overlay" id="testLoadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">æµ‹è¯•åŠ è½½...</div>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="testProgressFill"></div>
                </div>
                <span class="progress-text" id="testProgressText">0%</span>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="components/StateManager.js"></script>
    <script src="components/ApiClient.js"></script>
    <script src="components/SmartInput.js"></script>
    <script src="components/TemplateSelector.js"></script>
    <script src="components/LoadingStates.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let smartInput, apiClient, templateSelector, stateManager, loadingStates;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å¼€å§‹åˆå§‹åŒ–ç»„ä»¶...');

            try {
                // åˆå§‹åŒ–çŠ¶æ€ç®¡ç†å™¨
                stateManager = new StateManager();
                console.log('StateManager åˆå§‹åŒ–æˆåŠŸ');

                // åˆå§‹åŒ–APIå®¢æˆ·ç«¯
                apiClient = new ApiClient({
                    baseURL: '/api',
                    enableLogging: true
                });
                console.log('ApiClient åˆå§‹åŒ–æˆåŠŸ');

                // åˆå§‹åŒ–æ™ºèƒ½è¾“å…¥æ¡†
                smartInput = new SmartInput({
                    inputSelector: '#testInput',
                    suggestionsContainer: '#testSuggestions',
                    suggestionsList: '#testSuggestionsList',
                    charCountSelector: '.char-count',
                    generateBtnSelector: '#testGenerateBtn',
                    maxChars: 100
                });
                console.log('SmartInput åˆå§‹åŒ–æˆåŠŸ');

                // ç»‘å®šæ™ºèƒ½è¾“å…¥æ¡†äº‹ä»¶
                smartInput.on('generate', function(event) {
                    console.log('ç”Ÿæˆäº‹ä»¶è§¦å‘:', event.detail);
                    document.getElementById('apiOutput').textContent =
                        'ç”Ÿæˆè¯·æ±‚: ' + JSON.stringify(event.detail, null, 2);
                });

                // åˆå§‹åŒ–æ¨¡æ¿é€‰æ‹©å™¨
                templateSelector = new TemplateSelector({
                    templateDataPath: './data/templates.json',
                    categoriesContainer: '#testTemplateCategories',
                    searchInput: '#testTemplateSearch'
                });
                console.log('TemplateSelector åˆå§‹åŒ–æˆåŠŸ');

                // ç»‘å®šæ¨¡æ¿é€‰æ‹©å™¨äº‹ä»¶
                templateSelector.on('templates-loaded', function(event) {
                    console.log('æ¨¡æ¿åŠ è½½å®Œæˆ:', event.detail);
                });

                templateSelector.on('template-applied', function(event) {
                    console.log('æ¨¡æ¿åº”ç”¨:', event.detail);
                    document.getElementById('testInput').value = event.detail.promptText;
                });

                // åˆå§‹åŒ–åŠ è½½çŠ¶æ€ç»„ä»¶
                loadingStates = new LoadingStates({
                    overlaySelector: '#testLoadingOverlay',
                    progressFillSelector: '#testProgressFill',
                    progressTextSelector: '#testProgressText'
                });
                console.log('LoadingStates åˆå§‹åŒ–æˆåŠŸ');

                console.log('æ‰€æœ‰ç»„ä»¶åˆå§‹åŒ–å®Œæˆï¼');

            } catch (error) {
                console.error('ç»„ä»¶åˆå§‹åŒ–å¤±è´¥:', error);
                document.getElementById('apiOutput').textContent =
                    'åˆå§‹åŒ–é”™è¯¯: ' + error.message;
            }
        });

        // æµ‹è¯•å‡½æ•°
        function hideTestSuggestions() {
            document.getElementById('testSuggestions').style.display = 'none';
        }

        function testAPI() {
            fetch('/health')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('apiOutput').textContent =
                        'APIå¥åº·æ£€æŸ¥ç»“æœ: ' + JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById('apiOutput').textContent =
                        'APIè¿æ¥å¤±è´¥: ' + error.message;
                });
        }

        function testAPIClient() {
            apiClient.healthCheck()
                .then(result => {
                    document.getElementById('apiOutput').textContent =
                        'ApiClientå¥åº·æ£€æŸ¥ç»“æœ: ' + JSON.stringify(result, null, 2);
                })
                .catch(error => {
                    document.getElementById('apiOutput').textContent =
                        'ApiClientè¿æ¥å¤±è´¥: ' + error.message;
                });
        }

        function testStateUpdate() {
            stateManager.setState('test.value', 'Hello World');
            stateManager.setState('ui.theme', 'light');
            document.getElementById('stateOutput').textContent =
                'çŠ¶æ€æ›´æ–°å®Œæˆ: ' + JSON.stringify(stateManager.getState(), null, 2);
        }

        function testStateGet() {
            const state = stateManager.getState();
            document.getElementById('stateOutput').textContent =
                'å½“å‰çŠ¶æ€: ' + JSON.stringify(state, null, 2);
        }

        function testLoading() {
            loadingStates.show('æµ‹è¯•åŠ è½½ä¸­...', 0, {
                estimatedDuration: 5000,
                animation: 'rotate'
            });

            setTimeout(() => {
                loadingStates.updateProgress(50, 'æ­£åœ¨è¿›è¡Œä¸­...');
            }, 2000);

            setTimeout(() => {
                loadingStates.updateProgress(100, 'å®Œæˆï¼');
            }, 4000);
        }

        function testLoadingProgress() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                loadingStates.updateProgress(progress, `è¿›åº¦: ${progress}%`);

                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 500);
        }

        function hideTestLoading() {
            loadingStates.hide();
        }

        // ç›‘å¬é”™è¯¯
        window.addEventListener('error', function(event) {
            console.error('å…¨å±€é”™è¯¯:', event.error);
            document.getElementById('apiOutput').textContent =
                'å…¨å±€é”™è¯¯: ' + event.error.message;
        });
    </script>
</body>
</html>