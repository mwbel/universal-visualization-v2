<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŒ…å¡é¡¿å¼€ - å¢å¼ºäº¤äº’å­¦ä¹ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .demo-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            width: 95%;
            max-width: 1400px;
            height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #7C3AED 0%, #9333EA 100%);
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-stats {
            display: flex;
            gap: 16px;
            font-size: 13px;
            opacity: 0.9;
        }

        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .chat-panel {
            flex: 1;
            border-right: 1px solid #e8e8e8;
            display: flex;
            flex-direction: column;
            background: #fafafa;
            min-width: 350px;
        }

        .chat-header {
            padding: 12px 16px;
            border-bottom: 1px solid #e8e8e8;
            background: white;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .subject-selector {
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 12px;
        }

        .messages-container {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .message {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
            font-size: 14px;
        }

        .message.user .message-avatar {
            background: #7C3AED;
        }

        .message.ai .message-avatar {
            background: #10B981;
        }

        .message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 70%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 13px;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: #7C3AED;
            color: white;
            margin-left: auto;
        }

        .input-area {
            padding: 16px;
            border-top: 1px solid #e8e8e8;
            background: white;
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            resize: none;
            min-height: 40px;
            max-height: 100px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .input-field:focus {
            outline: none;
            border-color: #7C3AED;
        }

        .send-button {
            background: #7C3AED;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .send-button:hover {
            background: #6d28d9;
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* å¢å¼ºçš„å¯è§†åŒ–é¢æ¿ */
        .enhanced-viz-panel {
            width: 600px;
            display: flex;
            flex-direction: column;
            background: white;
            position: relative;
            min-width: 400px;
        }

        .viz-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #fafafa;
            border-bottom: 1px solid #e8e8e8;
            min-height: 48px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .toolbar-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toolbar-button {
            padding: 6px 10px;
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .toolbar-button:hover {
            background: #7C3AED;
            color: white;
            border-color: #7C3AED;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
        }

        .zoom-level {
            font-size: 12px;
            color: #666;
            min-width: 32px;
            text-align: center;
            font-weight: 500;
        }

        .template-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            background: rgba(124, 58, 237, 0.1);
            border-radius: 6px;
        }

        .template-name {
            font-size: 12px;
            font-weight: 500;
            color: #7C3AED;
        }

        .parameter-controls {
            border-bottom: 1px solid #e8e8e8;
            background: #fafafa;
            padding: 12px;
            max-height: 180px;
            overflow-y: auto;
        }

        .parameter-controls.collapsed {
            max-height: 0;
            padding: 0;
            overflow: hidden;
        }

        .parameter-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .parameter-header h4 {
            margin: 0;
            font-size: 13px;
            font-weight: 600;
            color: #262626;
        }

        .parameter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }

        .parameter-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .parameter-label {
            font-size: 11px;
            font-weight: 500;
            color: #666;
        }

        .parameter-input {
            padding: 6px 8px;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            font-size: 12px;
            transition: border-color 0.3s;
        }

        .parameter-input:focus {
            outline: none;
            border-color: #7C3AED;
        }

        .viz-content {
            flex: 1;
            position: relative;
            overflow: auto;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }

        .visualization-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            width: 100%;
            height: 100%;
            transition: transform 0.3s ease;
        }

        .viz-placeholder {
            text-align: center;
            color: #8c8c8c;
        }

        .viz-placeholder svg {
            width: 80px;
            height: 80px;
            margin-bottom: 12px;
            opacity: 0.3;
        }

        /* æ¨¡æ¿é€‰æ‹©å™¨ */
        .template-selector {
            position: absolute;
            top: 60px;
            right: 16px;
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 8px;
            min-width: 200px;
            z-index: 1000;
            display: none;
        }

        .template-selector.show {
            display: block;
        }

        .template-option {
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 12px;
        }

        .template-option:hover {
            background: #f0f0f0;
        }

        .template-option.selected {
            background: rgba(124, 58, 237, 0.1);
            color: #7C3AED;
            font-weight: 500;
        }

        /* åŠ¨ç”» */
        .visualization-wrapper {
            transition: transform 0.3s ease;
        }

        .loading-overlay {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: #666;
            font-size: 13px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #7C3AED;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .enhanced-viz-panel {
                width: 500px;
                min-width: 350px;
            }
        }

        @media (max-width: 768px) {
            .demo-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }

            .main-content {
                flex-direction: column;
            }

            .chat-panel {
                border-right: none;
                border-bottom: 1px solid #e8e8e8;
                min-width: unset;
                height: 40vh;
            }

            .enhanced-viz-panel {
                width: 100%;
                height: 60vh;
                min-width: unset;
            }

            .parameter-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 16px;
            }

            .header-stats {
                display: none;
            }

            .viz-toolbar {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .toolbar-section {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="header">
            <h1>
                <span>ğŸ’¡</span>
                èŒ…å¡é¡¿å¼€ - å¢å¼ºäº¤äº’å­¦ä¹ 
            </h1>
            <div class="header-stats">
                <span>ğŸ’¬ å¯¹è¯: <span id="messageCount">1</span></span>
                <span>ğŸ“ å­¦ç§‘: <span id="currentSubject">æ•°å­¦</span></span>
                <span>ğŸ“Š æ¨¡æ¿: <span id="currentTemplate">å‡½æ•°å›¾åƒ</span></span>
                <span>â±ï¸ <span id="sessionTime">00:00</span></span>
            </div>
        </div>

        <div class="main-content">
            <div class="chat-panel">
                <div class="chat-header">
                    ğŸ’¬ æ™ºèƒ½å¯¹è¯
                    <div class="subject-selector">æ•°å­¦</div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="message ai">
                        <div class="message-avatar">ğŸ¤–</div>
                        <div class="message-content">
                            ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æ•°å­¦å­¦ä¹ åŠ©æ‰‹ã€‚ç°åœ¨ä½ å¯ä»¥ä½“éªŒå¢å¼ºç‰ˆçš„å¯è§†åŒ–åŠŸèƒ½ï¼š<br><br>
                            ğŸ¯ <strong>å­¦ç§‘æ¨¡æ¿é€‰æ‹©</strong>ï¼šæ ¹æ®å­¦ç§‘é€‰æ‹©ä¸“ç”¨æ¨¡æ¿<br>
                            ğŸ”§ <strong>å‚æ•°å®æ—¶è°ƒèŠ‚</strong>ï¼šåŠ¨æ€è°ƒæ•´å¯è§†åŒ–å‚æ•°<br>
                            ğŸ” <strong>ç¼©æ”¾æ§åˆ¶</strong>ï¼šè‡ªç”±ç¼©æ”¾æŸ¥çœ‹ç»†èŠ‚<br>
                            ğŸ’¾ <strong>é…ç½®ä¿å­˜</strong>ï¼šå¯¼å‡ºå’Œé‡ç”¨å¯è§†åŒ–é…ç½®<br><br>
                            è¯·å‘Šè¯‰æˆ‘ä½ æƒ³å­¦ä¹ ä»€ä¹ˆå†…å®¹ï¼Ÿ
                        </div>
                    </div>
                </div>

                <div class="input-area">
                    <div class="input-container">
                        <textarea
                            class="input-field"
                            placeholder="è¯·è¾“å…¥ä½ çš„æ•°å­¦é—®é¢˜..."
                            id="messageInput"
                            rows="1"
                        ></textarea>
                        <button class="send-button" onclick="sendMessage()">å‘é€</button>
                    </div>
                </div>
            </div>

            <!-- å¢å¼ºç‰ˆå¯è§†åŒ–é¢æ¿ -->
            <div class="enhanced-viz-panel">
                <!-- å·¥å…·æ  -->
                <div class="viz-toolbar">
                    <div class="toolbar-section">
                        <button class="toolbar-button" onclick="toggleTemplateSelector()">
                            ğŸ¯ æ¨¡æ¿
                        </button>
                        <div class="template-info">
                            <span class="template-name" id="templateName">å‡½æ•°å›¾åƒ</span>
                        </div>
                    </div>

                    <div class="toolbar-section">
                        <div class="zoom-controls">
                            <button class="toolbar-button" onclick="zoomOut()" id="zoomOutBtn">â–</button>
                            <span class="zoom-level" id="zoomLevel">100%</span>
                            <button class="toolbar-button" onclick="zoomIn()" id="zoomInBtn">â•</button>
                            <button class="toolbar-button" onclick="resetZoom()">100%</button>
                        </div>
                    </div>

                    <div class="toolbar-section">
                        <button class="toolbar-button" onclick="toggleParameters()">
                            ğŸ”§ å‚æ•°
                        </button>
                        <button class="toolbar-button" onclick="resetAll()">
                            ğŸ”„ é‡ç½®
                        </button>
                        <button class="toolbar-button" onclick="reloadVisualization()">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </div>
                </div>

                <!-- å‚æ•°æ§åˆ¶é¢æ¿ -->
                <div class="parameter-controls" id="parameterControls">
                    <div class="parameter-header">
                        <h4>ğŸ“Š å‚æ•°æ§åˆ¶</h4>
                        <button class="toolbar-button" onclick="toggleParameters()">æ”¶èµ·</button>
                    </div>
                    <div class="parameter-grid" id="parameterGrid">
                        <!-- åŠ¨æ€ç”Ÿæˆå‚æ•°æ§ä»¶ -->
                    </div>
                </div>

                <!-- å¯è§†åŒ–å†…å®¹åŒºåŸŸ -->
                <div class="viz-content">
                    <div class="loading-overlay" id="loadingOverlay">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨ç”Ÿæˆå¯è§†åŒ–...</p>
                    </div>
                    <div class="visualization-wrapper" id="visualizationWrapper">
                        <div class="viz-placeholder">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                            </svg>
                            <p>ç­‰å¾…å¯è§†åŒ–å†…å®¹</p>
                            <p style="font-size: 11px; margin-top: 8px;">é€‰æ‹©æ¨¡æ¿å¹¶è°ƒæ•´å‚æ•°</p>
                        </div>
                    </div>
                </div>

                <!-- æ¨¡æ¿é€‰æ‹©å™¨ -->
                <div class="template-selector" id="templateSelector">
                    <div class="template-option selected" data-template="function">
                        ğŸ“ˆ å‡½æ•°å›¾åƒ
                    </div>
                    <div class="template-option" data-template="geometry">
                        ğŸ“ å‡ ä½•å›¾å½¢
                    </div>
                    <div class="template-option" data-template="sequence">
                        ğŸ”¢ æ•°åˆ—åŠ¨ç”»
                    </div>
                    <div class="template-option" data-template="physics">
                        âš›ï¸ ç‰©ç†è¿åŠ¨
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let messageCount = 1;
        let sessionStartTime = Date.now();
        let isLoading = false;
        let currentTemplate = 'function';
        let currentConfig = {
            zoom: 100,
            showGrid: true,
            showAxes: true,
            animation: true
        };

        // å­¦ç§‘æ¨¡æ¿é…ç½®
        const templates = {
            function: {
                name: 'å‡½æ•°å›¾åƒ',
                description: 'æ•°å­¦å‡½æ•°çš„å¯è§†åŒ–å±•ç¤º',
                parameters: [
                    { id: 'xMin', label: 'Xæœ€å°å€¼', type: 'number', min: -50, max: -1, default: -10 },
                    { id: 'xMax', label: 'Xæœ€å¤§å€¼', type: 'number', min: 1, max: 50, default: 10 },
                    { id: 'yMin', label: 'Yæœ€å°å€¼', type: 'number', min: -50, max: -1, default: -10 },
                    { id: 'yMax', label: 'Yæœ€å¤§å€¼', type: 'number', min: 1, max: 50, default: 10 },
                    { id: 'lineWidth', label: 'çº¿æ¡å®½åº¦', type: 'number', min: 1, max: 5, default: 2 }
                ],
                render: function(config) {
                    const { xMin, xMax, yMin, yMax, lineWidth } = config;
                    return `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <!-- åæ ‡è½´ -->
                            ${currentConfig.showGrid ? `
                                <!-- ç½‘æ ¼çº¿ -->
                                ${Array.from({length: 11}, (_, i) => {
                                    const y = 20 + (i * 260 / 10);
                                    const x = 40 + (i * 320 / 10);
                                    return `<line x1="40" y1="${y}" x2="360" y2="${y}" stroke="#f0f0f0" stroke-width="1"/>
                                           <line x1="${x}" y1="20" x2="${x}" y2="280" stroke="#f0f0f0" stroke-width="1"/>`;
                                }).join('')}
                            ` : ''}
                            <line x1="40" y1="${yMin < 0 ? 260 : 280}" x2="360" y2="${yMin < 0 ? 260 : 280}" stroke="#666" stroke-width="2"/>
                            <line x1="${xMin < 0 ? 200 : 40}" y1="20" x2="${xMin < 0 ? 200 : 40}" y2="280" stroke="#666" stroke-width="2"/>

                            <!-- äºŒæ¬¡å‡½æ•° y = xÂ² -->
                            <path d="M 40 260 Q 200 40, 360 260" stroke="#7C3AED" stroke-width="${lineWidth}" fill="none"/>

                            <!-- ä¸€æ¬¡å‡½æ•° y = 2x + 1 -->
                            <line x1="40" y1="200" x2="360" y2="80" stroke="#DC2626" stroke-width="${lineWidth}"/>

                            <!-- æ ‡ç­¾ -->
                            <text x="370" y="265" font-size="12" fill="#666">x</text>
                            <text x="185" y="35" font-size="12" fill="#666">y</text>
                            <text x="300" y="30" font-size="12" fill="#7C3AED">y = xÂ²</text>
                            <text x="280" y="70" font-size="12" fill="#DC2626">y = 2x + 1</text>
                        </svg>
                    `;
                }
            },
            geometry: {
                name: 'å‡ ä½•å›¾å½¢',
                description: 'äº¤äº’å¼å‡ ä½•å›¾å½¢ç»˜åˆ¶',
                parameters: [
                    { id: 'gridSize', label: 'ç½‘æ ¼å¤§å°', type: 'number', min: 10, max: 50, default: 20 },
                    { id: 'lineWidth', label: 'çº¿æ¡å®½åº¦', type: 'number', min: 1, max: 5, default: 2 },
                    { id: 'showAngles', label: 'æ˜¾ç¤ºè§’åº¦', type: 'checkbox', default: true },
                    { id: 'fillShapes', label: 'å¡«å……å›¾å½¢', type: 'checkbox', default: true }
                ],
                render: function(config) {
                    const { gridSize, lineWidth, showAngles, fillShapes } = config;
                    return `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <!-- ç½‘æ ¼ -->
                            ${Array.from({length: 20}, (_, i) => {
                                const pos = 20 + (i * gridSize / 2);
                                return `<line x1="${pos}" y1="20" x2="${pos}" y2="280" stroke="#f0f0f0" stroke-width="1"/>
                                       <line x1="20" y1="${pos}" x2="380" y2="${pos}" stroke="#f0f0f0" stroke-width="1"/>`;
                            }).join('')}

                            <!-- åæ ‡è½´ -->
                            <line x1="200" y1="20" x2="200" y2="280" stroke="#666" stroke-width="2"/>
                            <line x1="20" y1="150" x2="380" y2="150" stroke="#666" stroke-width="2"/>

                            <!-- ä¸‰è§’å½¢ -->
                            <polygon points="100,200 300,200 200,80"
                                     fill="${fillShapes ? 'rgba(124, 58, 237, 0.2)' : 'none'}"
                                     stroke="#7C3AED" stroke-width="${lineWidth}"/>

                            <!-- åœ†å½¢ -->
                            <circle cx="200" cy="150" r="60"
                                    fill="${fillShapes ? 'rgba(16, 185, 129, 0.1)' : 'none'}"
                                    stroke="#10B981" stroke-width="${lineWidth}"/>

                            ${showAngles ? `
                                <!-- è§’åº¦æ ‡è®° -->
                                <path d="M 120 190 A 20 20 0 0 1 130 180" fill="none" stroke="#DC2626" stroke-width="2"/>
                                <text x="125" y="195" font-size="10" fill="#DC2626">45Â°</text>
                            ` : ''}

                            <!-- æ ‡ç­¾ -->
                            <text x="370" y="155" font-size="12" fill="#666">x</text>
                            <text x="185" y="35" font-size="12" fill="#666">y</text>
                        </svg>
                    `;
                }
            },
            sequence: {
                name: 'æ•°åˆ—åŠ¨ç”»',
                description: 'ç­‰å·®ç­‰æ¯”æ•°åˆ—çš„åŠ¨æ€æ¼”ç¤º',
                parameters: [
                    { id: 'firstTerm', label: 'é¦–é¡¹ aâ‚', type: 'number', min: -20, max: 20, default: 2 },
                    { id: 'difference', label: 'å…¬å·® d', type: 'number', min: -10, max: 10, default: 3 },
                    { id: 'numTerms', label: 'é¡¹æ•° n', type: 'number', min: 3, max: 15, default: 8 },
                    { id: 'animationSpeed', label: 'åŠ¨ç”»é€Ÿåº¦', type: 'number', min: 500, max: 3000, default: 1000 }
                ],
                render: function(config) {
                    const { firstTerm, difference, numTerms } = config;
                    let terms = [];
                    for (let i = 0; i < numTerms; i++) {
                        terms.push(firstTerm + i * difference);
                    }
                    const maxValue = Math.max(...terms);
                    const scale = 120 / Math.max(Math.abs(maxValue), Math.abs(Math.min(...terms)));

                    return `
                        <div style="width: 100%; max-width: 350px; text-align: center;">
                            <div style="display: flex; align-items: end; height: 150px; gap: 8px; justify-content: center;">
                                ${terms.map((term, index) => `
                                    <div style="flex: 0 0 auto; background: #7C3AED; height: ${Math.abs(term) * scale}px;
                                                min-height: 20px; display: flex; align-items: center; justify-content: center;
                                                color: white; font-size: 11px; border-radius: 4px; margin: 0 2px;
                                                ${term < 0 ? 'transform: translateY(' + (Math.abs(term) * scale) + 'px)' : ''}">
                                        ${term}
                                    </div>
                                `).join('')}
                            </div>
                            <p style="margin-top: 16px; color: #333; font-weight: 500;">ç­‰å·®æ•°åˆ—: ${terms.join(', ')}</p>
                            <p style="font-size: 12px; color: #666;">é¦–é¡¹ aâ‚ = ${firstTerm}, å…¬å·® d = ${difference}</p>
                        </div>
                    `;
                }
            },
            physics: {
                name: 'ç‰©ç†è¿åŠ¨',
                description: 'è¿åŠ¨å­¦å’ŒåŠ¨åŠ›å­¦çš„å¯è§†åŒ–',
                parameters: [
                    { id: 'gravity', label: 'é‡åŠ›åŠ é€Ÿåº¦', type: 'number', min: 1, max: 20, default: 9.8 },
                    { id: 'initialVelocity', label: 'åˆé€Ÿåº¦', type: 'number', min: 0, max: 50, default: 10 },
                    { id: 'time', label: 'æ—¶é—´', type: 'number', min: 0, max: 10, default: 2 }
                ],
                render: function(config) {
                    const { gravity, initialVelocity, time } = config;
                    const displacement = initialVelocity * time - 0.5 * gravity * time * time;
                    const maxHeight = (initialVelocity * initialVelocity) / (2 * gravity);

                    return `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <!-- åœ°é¢ -->
                            <line x1="20" y1="250" x2="380" y2="250" stroke="#666" stroke-width="2"/>

                            <!-- è½¨è¿¹çº¿ -->
                            <path d="M 50 250 Q 200 ${250 - maxHeight * 5}, 350 250"
                                  stroke="#DC2626" stroke-width="2" fill="none" stroke-dasharray="5,5"/>

                            <!-- ç‰©ä½“ -->
                            <circle cx="${50 + time * 150}" cy="${250 - displacement * 5}" r="8" fill="#7C3AED"/>

                            <!-- é€Ÿåº¦å‘é‡ -->
                            <line x1="${50 + time * 150}" y1="${250 - displacement * 5}"
                                  x2="${50 + time * 150 + 20}" y1="${250 - displacement * 5 - (initialVelocity - gravity * time) * 3}"
                                  stroke="#10B981" stroke-width="2" marker-end="url(#arrowhead)"/>

                            <!-- ç®­å¤´æ ‡è®° -->
                            <defs>
                                <marker id="arrowhead" markerWidth="10" markerHeight="7"
                                        refX="9" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#10B981"/>
                                </marker>
                            </defs>

                            <!-- æ ‡ç­¾ -->
                            <text x="25" y="270" font-size="12" fill="#666">t = ${time}s</text>
                            <text x="25" y="30" font-size="12" fill="#666">h = ${Math.abs(displacement).toFixed(1)}m</text>
                            <text x="25" y="50" font-size="12" fill="#666">v = ${(initialVelocity - gravity * time).toFixed(1)}m/s</text>
                        </svg>
                    `;
                }
            }
        };

        // AIå“åº”æ•°æ®
        const aiResponses = {
            'å‡½æ•°': {
                message: 'æˆ‘ä¸ºä½ å‡†å¤‡äº†å¢å¼ºç‰ˆçš„å‡½æ•°å›¾åƒå¯è§†åŒ–ï¼ä½ å¯ä»¥ï¼š\n\nğŸ¯ **é€‰æ‹©ä¸åŒæ¨¡æ¿**ï¼šå‡½æ•°ã€å‡ ä½•ã€æ•°åˆ—ã€ç‰©ç†\nğŸ”§ **å®æ—¶è°ƒæ•´å‚æ•°**ï¼šåæ ‡èŒƒå›´ã€çº¿æ¡å®½åº¦ç­‰\nğŸ” **è‡ªç”±ç¼©æ”¾æŸ¥çœ‹**ï¼šæ”¾å¤§æŸ¥çœ‹ç»†èŠ‚æˆ–ç¼©å°çœ‹å…¨è²Œ\nğŸ’¾ **ä¿å­˜é…ç½®**ï¼šå¯¼å‡ºå½“å‰å¯è§†åŒ–è®¾ç½®\n\nè¯•è¯•è°ƒæ•´å³è¾¹çš„å‚æ•°çœ‹çœ‹æ•ˆæœï¼',
                template: 'function',
                config: { xMin: -10, xMax: 10, yMin: -10, yMax: 10, lineWidth: 2 }
            },
            'å‡ ä½•': {
                message: 'å‡ ä½•å›¾å½¢å¯è§†åŒ–å·²å‡†å¤‡å°±ç»ªï¼å¢å¼ºåŠŸèƒ½åŒ…æ‹¬ï¼š\n\nğŸ“ **äº¤äº’å¼å‡ ä½•ç”»æ¿**ï¼šç»˜åˆ¶ç‚¹ã€çº¿ã€åœ†ã€ä¸‰è§’å½¢\nğŸ”§ **å‚æ•°æ§åˆ¶**ï¼šç½‘æ ¼å¤§å°ã€çº¿æ¡å®½åº¦ã€æ˜¾ç¤ºè®¾ç½®\nğŸ“ **æµ‹é‡å·¥å…·**ï¼šè§’åº¦ã€é•¿åº¦ã€é¢ç§¯è®¡ç®—\nğŸ¨ **è§†è§‰è‡ªå®šä¹‰**ï¼šé¢œè‰²ã€å¡«å……ã€é€æ˜åº¦è°ƒèŠ‚\n\nä½ å¯ä»¥åœ¨å³ä¾§é¢æ¿è°ƒæ•´å„ç§å‚æ•°ï¼',
                template: 'geometry',
                config: { gridSize: 20, lineWidth: 2, showAngles: true, fillShapes: true }
            },
            'æ•°åˆ—': {
                message: 'æ•°åˆ—åŠ¨ç”»æ¼”ç¤ºå·²åŠ è½½ï¼å¢å¼ºç‰¹æ€§ï¼š\n\nğŸ“Š **åŠ¨æ€æ•°åˆ—å±•ç¤º**ï¼šç­‰å·®ã€ç­‰æ¯”æ•°åˆ—çš„æ¡å½¢å›¾\nğŸ”§ **å‚æ•°è°ƒèŠ‚**ï¼šé¦–é¡¹ã€å…¬å·®/å…¬æ¯”ã€é¡¹æ•°æ§åˆ¶\nâ±ï¸ **åŠ¨ç”»é€Ÿåº¦**ï¼šè°ƒæ•´æ¼”ç¤ºèŠ‚å¥\nğŸ“ˆ **ç»Ÿè®¡ä¿¡æ¯**ï¼šå’Œå€¼ã€å¹³å‡å€¼ã€è¶‹åŠ¿åˆ†æ\n\nè¯•è¯•æ”¹å˜é¦–é¡¹å’Œå…¬å·®çœ‹çœ‹å˜åŒ–ï¼',
                template: 'sequence',
                config: { firstTerm: 2, difference: 3, numTerms: 8, animationSpeed: 1000 }
            }
        };

        // ä¸»è¦åŠŸèƒ½å‡½æ•°
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message || isLoading) return;

            addMessage('user', message);
            input.value = '';
            showLoading();

            setTimeout(() => {
                hideLoading();
                const response = getAIResponse(message);
                addMessage('ai', response.message);

                if (response.template) {
                    switchTemplate(response.template);
                    updateConfig(response.config || {});
                }
            }, 1000 + Math.random() * 2000);
        }

        function getAIResponse(message) {
            const lowerMessage = message.toLowerCase();

            if (lowerMessage.includes('å‡½æ•°') || lowerMessage.includes('å›¾åƒ')) {
                return aiResponses['å‡½æ•°'];
            } else if (lowerMessage.includes('å‡ ä½•') || lowerMessage.includes('ä¸‰è§’å½¢') || lowerMessage.includes('åœ†')) {
                return aiResponses['å‡ ä½•'];
            } else if (lowerMessage.includes('æ•°åˆ—') || lowerMessage.includes('ç­‰å·®') || lowerMessage.includes('ç­‰æ¯”')) {
                return aiResponses['æ•°åˆ—'];
            } else {
                return {
                    message: `æˆ‘ä¸ºä½ å‡†å¤‡äº†å¤šä¸ªå¯è§†åŒ–æ¨¡æ¿ï¼\n\nğŸ¯ **å‡½æ•°å›¾åƒ**ï¼šæ•°å­¦å‡½æ•°çš„å¯è§†åŒ–å±•ç¤º\nğŸ“ **å‡ ä½•å›¾å½¢**ï¼šäº¤äº’å¼å‡ ä½•ç»˜åˆ¶å·¥å…·\nğŸ”¢ **æ•°åˆ—åŠ¨ç”»**ï¼šç­‰å·®ç­‰æ¯”æ•°åˆ—åŠ¨æ€æ¼”ç¤º\nâš›ï¸ **ç‰©ç†è¿åŠ¨**ï¼šè¿åŠ¨å­¦å’ŒåŠ¨åŠ›å­¦å¯è§†åŒ–\n\nç‚¹å‡»å³ä¸Šè§’çš„"æ¨¡æ¿"æŒ‰é’®é€‰æ‹©ï¼Œæˆ–ç›´æ¥å‘Šè¯‰æˆ‘ä½ æƒ³çœ‹ä»€ä¹ˆç±»å‹ï¼`,
                    template: 'function',
                    config: { xMin: -10, xMax: 10, yMin: -10, yMax: 10, lineWidth: 2 }
                };
            }
        }

        function addMessage(type, content) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;

            const avatar = type === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">${content}</div>
            `;

            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;

            messageCount++;
            document.getElementById('messageCount').textContent = messageCount;
        }

        function showLoading() {
            isLoading = true;
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            isLoading = false;
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        // æ¨¡æ¿é€‰æ‹©
        function toggleTemplateSelector() {
            const selector = document.getElementById('templateSelector');
            selector.classList.toggle('show');
        }

        function switchTemplate(templateId) {
            currentTemplate = templateId;
            const template = templates[templateId];

            // æ›´æ–°UI
            document.getElementById('currentTemplate').textContent = template.name;
            document.getElementById('templateName').textContent = template.name;

            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.template-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.template === templateId) {
                    option.classList.add('selected');
                }
            });

            // ç”Ÿæˆå‚æ•°æ§ä»¶
            generateParameterControls(template);

            // æ›´æ–°å¯è§†åŒ–
            updateVisualization();

            // å…³é—­é€‰æ‹©å™¨
            document.getElementById('templateSelector').classList.remove('show');

            addMessage('ai', `å·²åˆ‡æ¢åˆ° **${template.name}** æ¨¡æ¿ï¼\n\n${template.description}\n\nä½ å¯ä»¥ä½¿ç”¨å³ä¾§çš„å‚æ•°æ§åˆ¶é¢æ¿æ¥è°ƒæ•´å¯è§†åŒ–æ•ˆæœã€‚`);
        }

        function generateParameterControls(template) {
            const grid = document.getElementById('parameterGrid');
            grid.innerHTML = '';

            template.parameters.forEach(param => {
                const item = document.createElement('div');
                item.className = 'parameter-item';

                let input;
                if (param.type === 'number') {
                    input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'parameter-input';
                    input.value = currentConfig[param.id] || param.default;
                    input.min = param.min;
                    input.max = param.max;
                    input.addEventListener('input', (e) => updateParameter(param.id, parseFloat(e.target.value)));
                } else if (param.type === 'checkbox') {
                    input = document.createElement('input');
                    input.type = 'checkbox';
                    input.className = 'parameter-input';
                    input.checked = currentConfig[param.id] !== undefined ? currentConfig[param.id] : param.default;
                    input.addEventListener('change', (e) => updateParameter(param.id, e.target.checked));
                }

                item.innerHTML = `
                    <label class="parameter-label">${param.label}</label>
                `;
                item.appendChild(input);

                grid.appendChild(item);
            });
        }

        function updateParameter(paramId, value) {
            currentConfig[paramId] = value;
            updateVisualization();
        }

        function updateVisualization() {
            const wrapper = document.getElementById('visualizationWrapper');
            const template = templates[currentTemplate];

            if (template) {
                wrapper.innerHTML = template.render(currentConfig);

                // åº”ç”¨ç¼©æ”¾
                const zoom = currentConfig.zoom || 100;
                wrapper.style.transform = `scale(${zoom / 100})`;
            }
        }

        // å‚æ•°æ§åˆ¶
        function toggleParameters() {
            const controls = document.getElementById('parameterControls');
            controls.classList.toggle('collapsed');
        }

        function resetAll() {
            const template = templates[currentTemplate];
            if (template) {
                // é‡ç½®åˆ°é»˜è®¤é…ç½®
                template.parameters.forEach(param => {
                    currentConfig[param.id] = param.default;
                });
                currentConfig.zoom = 100;

                // æ›´æ–°UI
                document.getElementById('zoomLevel').textContent = '100%';
                generateParameterControls(template);
                updateVisualization();
            }
        }

        // ç¼©æ”¾æ§åˆ¶
        function zoomIn() {
            currentConfig.zoom = Math.min(200, currentConfig.zoom + 10);
            document.getElementById('zoomLevel').textContent = currentConfig.zoom + '%';
            updateVisualization();
        }

        function zoomOut() {
            currentConfig.zoom = Math.max(50, currentConfig.zoom - 10);
            document.getElementById('zoomLevel').textContent = currentConfig.zoom + '%';
            updateVisualization();
        }

        function resetZoom() {
            currentConfig.zoom = 100;
            document.getElementById('zoomLevel').textContent = '100%';
            updateVisualization();
        }

        // å…¶ä»–åŠŸèƒ½
        function reloadVisualization() {
            showLoading();
            setTimeout(() => {
                hideLoading();
                updateVisualization();
            }, 500);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ¨¡æ¿
            switchTemplate('function');

            // ç»‘å®šæ¨¡æ¿é€‰æ‹©äº‹ä»¶
            document.querySelectorAll('.template-option').forEach(option => {
                option.addEventListener('click', () => {
                    switchTemplate(option.dataset.template);
                });
            });

            // æ›´æ–°ä¼šè¯æ—¶é—´
            setInterval(() => {
                const elapsed = Date.now() - sessionStartTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('sessionTime').textContent =
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);

            // é”®ç›˜å¿«æ·é”®
            document.getElementById('messageInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
            document.getElementById('messageInput').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 100) + 'px';
            });

            // åˆå§‹èšç„¦
            document.getElementById('messageInput').focus();
        });

        // å¿«æ·é—®é¢˜æŒ‰é’®ï¼ˆåœ¨HTMLä¸­æ·»åŠ ï¼‰
        function quickQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }
    </script>
</body>
</html>