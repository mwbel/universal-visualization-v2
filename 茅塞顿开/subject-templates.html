<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŒ…å¡é¡¿å¼€ - å­¦ç§‘æ¨¡æ¿å­¦ä¹ </title>
    <script src="./api-client.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .demo-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            width: 90%;
            max-width: 1200px;
            height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #7C3AED 0%, #9333EA 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subject-selector {
            display: flex;
            gap: 8px;
        }

        .subject-button {
            padding: 8px 16px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .subject-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .subject-button.active {
            background: rgba(255, 255, 255, 0.9);
            color: #7C3AED;
        }

        .subject-button.math.active { color: #3B82F6; }
        .subject-button.physics.active { color: #10B981; }
        .subject-button.chemistry.active { color: #F59E0B; }
        .subject-button.biology.active { color: #8B5CF6; }

        .header-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
            opacity: 0.9;
        }

        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .chat-panel {
            flex: 1;
            border-right: 1px solid #e8e8e8;
            display: flex;
            flex-direction: column;
            background: #fafafa;
        }

        .chat-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e8e8e8;
            background: white;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .subject-indicator {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }

        .subject-indicator.math { background: #DBEAFE; color: #3B82F6; }
        .subject-indicator.physics { background: #D1FAE5; color: #10B981; }
        .subject-indicator.chemistry { background: #FED7AA; color: #F59E0B; }
        .subject-indicator.biology { background: #EDE9FE; color: #8B5CF6; }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .message {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #7C3AED;
        }

        .message.ai .message-avatar {
            background: #10B981;
        }

        .message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 70%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            line-height: 1.5;
        }

        .message.user .message-content {
            background: #7C3AED;
            color: white;
            margin-left: auto;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .quick-action {
            padding: 4px 8px;
            background: rgba(124, 58, 237, 0.1);
            color: #7C3AED;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(124, 58, 237, 0.2);
        }

        .quick-action:hover {
            background: rgba(124, 58, 237, 0.2);
        }

        .input-area {
            padding: 20px;
            border-top: 1px solid #e8e8e8;
            background: white;
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .input-field {
            flex: 1;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #7C3AED;
        }

        .send-button {
            background: #7C3AED;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .send-button:hover {
            background: #6d28d9;
        }

        .send-button:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        .visualization-panel {
            width: 400px;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .viz-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e8e8e8;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .viz-content {
            flex: 1;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }

        .viz-placeholder {
            text-align: center;
            color: #8c8c8c;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .viz-placeholder svg {
            width: 80px;
            height: 80px;
            color: #d1d5db;
            margin-bottom: 16px;
        }

        .loading-dots {
            display: flex;
            gap: 4px;
            align-items: center;
            justify-content: center;
        }

        .loading-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #7C3AED;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        .viz-controls {
            padding: 16px 20px;
            border-top: 1px solid #e8e8e8;
            background: #fafafa;
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .control-item:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-size: 14px;
            color: #666;
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background: #d1d5db;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #7C3AED;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        /* å­¦ç§‘ç‰¹å®šçš„å¯è§†åŒ–æ ·å¼ */
        .math-viz { color: #3B82F6; }
        .physics-viz { color: #10B981; }
        .chemistry-viz { color: #F59E0B; }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .demo-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }

            .main-content {
                flex-direction: column;
            }

            .chat-panel {
                border-right: none;
                border-bottom: 1px solid #e8e8e8;
            }

            .visualization-panel {
                width: 100%;
                height: 300px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header-stats {
                display: none;
            }

            .subject-selector {
                flex-wrap: wrap;
                gap: 4px;
            }

            .subject-button {
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        .loading-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .loading-progress {
            margin-top: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .visualization-wrapper {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .visualization-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .viz-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .subject-tag, .grade-tag, .type-tag {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .grade-tag {
            background: #28a745;
        }

        .type-tag {
            background: #17a2b8;
        }

        .viz-actions {
            display: flex;
            gap: 10px;
        }

        .new-page-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .new-page-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .visualization-content {
            padding: 20px;
        }

        .visualization-frame {
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .visualization-footer {
            background: #f8f9fa;
            padding: 15px;
            border-top: 1px solid #e9ecef;
            font-size: 14px;
        }

        .visualization-footer div {
            margin-bottom: 8px;
        }

        .visualization-footer strong {
            color: #495057;
        }

        .concepts, .interactive {
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="header">
            <h1>
                <span>ğŸ’¡</span>
                <span>èŒ…å¡é¡¿å¼€</span>
            </h1>
            <div class="subject-selector">
                <button class="subject-button math active" data-subject="math">ğŸ“ æ•°å­¦</button>
                <button class="subject-button physics" data-subject="physics">âš¡ ç‰©ç†</button>
                <button class="subject-button chemistry" data-subject="chemistry">âš—ï¸ åŒ–å­¦</button>
                <button class="subject-button biology" data-subject="biology">ğŸ§¬ ç”Ÿç‰©</button>
            </div>
            <div class="header-stats">
                <div>æ¶ˆæ¯: <span id="messageCount">0</span></div>
                <div>å­¦ç§‘: <span id="currentSubject">æ•°å­¦</span></div>
                <div>æ—¶é—´: <span id="sessionTime">00:00</span></div>
            </div>
        </div>

        <div class="main-content">
            <div class="chat-panel">
                <div class="chat-header">
                    ğŸ’¬ æ™ºèƒ½å¯¹è¯
                    <div class="subject-indicator math" id="subjectIndicator">æ•°å­¦</div>
                </div>
                <div class="messages-container" id="messagesContainer">
                    <div class="message ai">
                        <div class="message-avatar">ğŸ¤–</div>
                        <div class="message-content">
                            ä½ å¥½ï¼æˆ‘æ˜¯"èŒ…å¡é¡¿å¼€"AIåŠ©æ•™ã€‚è¯·é€‰æ‹©å­¦ç§‘åå¼€å§‹å­¦ä¹ ï¼Œæˆ‘å¯ä»¥ä¸ºä½ ç”Ÿæˆç›¸åº”çš„å¯è§†åŒ–å›¾è¡¨æ¥å¸®åŠ©ç†è§£çŸ¥è¯†ç‚¹ã€‚
                            <div class="quick-actions" id="quickActions">
                                <div class="quick-action">å‡½æ•°å›¾åƒ</div>
                                <div class="quick-action">å‡ ä½•å›¾å½¢</div>
                                <div class="quick-action">æ•°åˆ—åŠ¨ç”»</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="input-area">
                    <div class="input-container">
                        <textarea
                            class="input-field"
                            id="messageInput"
                            placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
                            rows="1"
                        ></textarea>
                        <button class="send-button" id="sendButton" onclick="sendMessage()">å‘é€</button>
                    </div>
                </div>
            </div>

            <div class="visualization-panel">
                <div class="viz-header">
                    ğŸ“Š å¯è§†åŒ–
                    <span id="vizTitle" style="font-size: 12px; color: #8c8c8c;">ç­‰å¾…å†…å®¹...</span>
                </div>
                <div class="viz-content">
                    <div class="viz-placeholder" id="vizPlaceholder">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <p>é€‰æ‹©å­¦ç§‘å¹¶æå‡ºé—®é¢˜</p>
                        <p style="font-size: 12px; margin-top: 8px;">æˆ‘å°†ä¸ºä½ ç”Ÿæˆç›¸åº”çš„å¯è§†åŒ–å†…å®¹</p>
                    </div>
                </div>
                <div class="viz-controls">
                    <div class="control-item">
                        <span class="control-label">æ˜¾ç¤ºç½‘æ ¼</span>
                        <div class="toggle-switch active" id="gridToggle" onclick="toggleControl('grid')"></div>
                    </div>
                    <div class="control-item">
                        <span class="control-label">åŠ¨ç”»æ•ˆæœ</span>
                        <div class="toggle-switch active" id="animationToggle" onclick="toggleControl('animation')"></div>
                    </div>
                    <div class="control-item">
                        <span class="control-label">äº¤äº’æ¨¡å¼</span>
                        <div class="toggle-switch active" id="interactiveToggle" onclick="toggleControl('interactive')"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let messageCount = 0;
        let sessionStartTime = Date.now();
        let isLoading = false;
        let currentSubject = 'math';

        // å­¦ç§‘æ¨¡æ¿é…ç½®
        const subjectTemplates = {
            math: {
                name: 'æ•°å­¦',
                quickActions: ['å‡½æ•°å›¾åƒ', 'å‡ ä½•å›¾å½¢', 'æ•°åˆ—åŠ¨ç”»', 'ä¸‰è§’å‡½æ•°', 'æ¦‚ç‡ç»Ÿè®¡'],
                templates: {
                    'å‡½æ•°': {
                        message: 'å‡½æ•°æ˜¯æ•°å­¦ä¸­çš„æ ¸å¿ƒæ¦‚å¿µã€‚è®©æˆ‘ä¸ºä½ å±•ç¤ºä¸åŒç±»å‹çš„å‡½æ•°å›¾åƒã€‚',
                        visualization: 'function_graph',
                        title: 'å‡½æ•°å›¾åƒæ¼”ç¤º'
                    },
                    'å‡ ä½•': {
                        message: 'å‡ ä½•å›¾å½¢å¸®åŠ©æˆ‘ä»¬ç†è§£ç©ºé—´å…³ç³»ã€‚è®©æˆ‘ç»˜åˆ¶ä¸€äº›åŸºæœ¬çš„å‡ ä½•å›¾å½¢ã€‚',
                        visualization: 'geometry_shapes',
                        title: 'å‡ ä½•å›¾å½¢å±•ç¤º'
                    },
                    'æ•°åˆ—': {
                        message: 'æ•°åˆ—æ˜¯æŒ‰ç…§ä¸€å®šè§„å¾‹æ’åˆ—çš„æ•°å­—ã€‚è®©æˆ‘ä¸ºä½ å±•ç¤ºä¸€ä¸ªç­‰å·®æ•°åˆ—ã€‚',
                        visualization: 'sequence_animation',
                        title: 'æ•°åˆ—åŠ¨ç”»æ¼”ç¤º'
                    },
                    'ä¸‰è§’': {
                        message: 'ä¸‰è§’å‡½æ•°æè¿°äº†è§’åº¦å’Œè¾¹é•¿çš„å…³ç³»ã€‚è®©æˆ‘ç»˜åˆ¶æ­£å¼¦å’Œä½™å¼¦å‡½æ•°å›¾åƒã€‚',
                        visualization: 'trigonometry',
                        title: 'ä¸‰è§’å‡½æ•°å›¾åƒ'
                    }
                }
            },
            physics: {
                name: 'ç‰©ç†',
                quickActions: ['å—åŠ›åˆ†æ', 'ç”µè·¯å›¾', 'æ³¢åŠ¨å›¾', 'è¿åŠ¨è½¨è¿¹', 'èƒ½é‡è½¬æ¢'],
                templates: {
                    'åŠ›': {
                        message: 'åŠ›å­¦åˆ†ææ˜¯ç‰©ç†å­¦çš„åŸºç¡€ã€‚è®©æˆ‘ä¸ºä½ å±•ç¤ºä¸€ä¸ªç‰©ä½“çš„å—åŠ›åˆ†æå›¾ã€‚',
                        visualization: 'force_diagram',
                        title: 'å—åŠ›åˆ†æå›¾'
                    },
                    'ç”µè·¯': {
                        message: 'ç”µè·¯å›¾å±•ç¤ºäº†ç”µæµçš„è·¯å¾„ã€‚è®©æˆ‘ç»˜åˆ¶ä¸€ä¸ªç®€å•çš„ç”µè·¯å›¾ã€‚',
                        visualization: 'circuit_diagram',
                        title: 'ç”µè·¯å›¾æ¼”ç¤º'
                    },
                    'æ³¢': {
                        message: 'æ³¢åŠ¨ç°è±¡åœ¨ç‰©ç†å­¦ä¸­å¾ˆå¸¸è§ã€‚è®©æˆ‘ä¸ºä½ å±•ç¤ºæœºæ¢°æ³¢çš„ä¼ æ’­ã€‚',
                        visualization: 'wave_animation',
                        title: 'æ³¢åŠ¨åŠ¨ç”»æ¼”ç¤º'
                    },
                    'è¿åŠ¨': {
                        message: 'è¿åŠ¨è½¨è¿¹æè¿°ç‰©ä½“çš„è¿åŠ¨è·¯å¾„ã€‚è®©æˆ‘å±•ç¤ºæŠ›ç‰©çº¿è¿åŠ¨ã€‚',
                        visualization: 'motion_trajectory',
                        title: 'è¿åŠ¨è½¨è¿¹åˆ†æ'
                    }
                }
            },
            chemistry: {
                name: 'åŒ–å­¦',
                quickActions: ['åˆ†å­ç»“æ„', 'åŒ–å­¦æ–¹ç¨‹', 'å…ƒç´ å‘¨æœŸ', 'ååº”è¿‡ç¨‹', 'åŒ–å­¦é”®'],
                templates: {
                    'åˆ†å­': {
                        message: 'åˆ†å­ç»“æ„å±•ç¤ºäº†åŸå­çš„ç©ºé—´æ’åˆ—ã€‚è®©æˆ‘ç»˜åˆ¶æ°´åˆ†å­çš„ç»“æ„ã€‚',
                        visualization: 'molecule_structure',
                        title: 'åˆ†å­ç»“æ„æ¼”ç¤º'
                    },
                    'ååº”': {
                        message: 'åŒ–å­¦ååº”å±•ç¤ºäº†ç‰©è´¨çš„å˜åŒ–è¿‡ç¨‹ã€‚è®©æˆ‘æ¼”ç¤ºä¸€ä¸ªç®€å•çš„åŒ–å­¦ååº”ã€‚',
                        visualization: 'chemical_reaction',
                        title: 'åŒ–å­¦ååº”æ¼”ç¤º'
                    },
                    'å…ƒç´ ': {
                        message: 'å…ƒç´ å‘¨æœŸè¡¨æ˜¯åŒ–å­¦çš„åŸºç¡€å·¥å…·ã€‚è®©æˆ‘å±•ç¤ºä¸€äº›ä¸»è¦å…ƒç´ ã€‚',
                        visualization: 'periodic_table',
                        title: 'å…ƒç´ å‘¨æœŸè¡¨'
                    },
                    'åŒ–å­¦é”®': {
                        message: 'åŒ–å­¦é”®è¿æ¥åŸå­å½¢æˆåˆ†å­ã€‚è®©æˆ‘å±•ç¤ºä¸åŒç±»å‹çš„åŒ–å­¦é”®ã€‚',
                        visualization: 'chemical_bonds',
                        title: 'åŒ–å­¦é”®ç¤ºæ„å›¾'
                    }
                }
            },
            biology: {
                name: 'ç”Ÿç‰©',
                quickActions: ['ç»†èƒç»“æ„', 'DNAåŒèºæ—‹', 'å…‰åˆä½œç”¨', 'é£Ÿç‰©é“¾', 'é—ä¼ è§„å¾‹'],
                templates: {
                    'ç»†èƒ': {
                        message: 'ç»†èƒæ˜¯ç”Ÿå‘½çš„åŸºæœ¬å•ä½ã€‚è®©æˆ‘ä¸ºä½ å±•ç¤ºåŠ¨ç‰©ç»†èƒçš„åŸºæœ¬ç»“æ„ã€‚',
                        visualization: 'cell_structure',
                        title: 'ç»†èƒç»“æ„æ¼”ç¤º'
                    },
                    'dna': {
                        message: 'DNAåŒèºæ—‹ç»“æ„æ˜¯é—ä¼ ä¿¡æ¯çš„è½½ä½“ã€‚è®©æˆ‘å±•ç¤ºDNAçš„ç»“æ„ç‰¹ç‚¹ã€‚',
                        visualization: 'dna_structure',
                        title: 'DNAåŒèºæ—‹ç»“æ„'
                    },
                    'å…‰åˆ': {
                        message: 'å…‰åˆä½œç”¨æ˜¯æ¤ç‰©å°†å…‰èƒ½è½¬åŒ–ä¸ºåŒ–å­¦èƒ½çš„è¿‡ç¨‹ã€‚è®©æˆ‘ä¸ºä½ å±•ç¤ºå…‰åˆä½œç”¨çš„æœºç†ã€‚',
                        visualization: 'photosynthesis',
                        title: 'å…‰åˆä½œç”¨è¿‡ç¨‹'
                    },
                    'é£Ÿç‰©é“¾': {
                        message: 'é£Ÿç‰©é“¾å±•ç¤ºäº†ç”Ÿæ€ç³»ç»Ÿä¸­èƒ½é‡çš„æµåŠ¨ã€‚è®©æˆ‘ç»˜åˆ¶ä¸€ä¸ªç®€å•çš„é£Ÿç‰©é“¾ã€‚',
                        visualization: 'food_chain',
                        title: 'ç”Ÿæ€é£Ÿç‰©é“¾'
                    },
                    'é—ä¼ ': {
                        message: 'é—ä¼ è§„å¾‹å†³å®šäº†æ€§çŠ¶çš„ä¼ é€’ã€‚å­Ÿå¾·å°”çš„é—ä¼ å®šå¾‹æ˜¯é—ä¼ å­¦çš„åŸºç¡€ã€‚',
                        visualization: 'genetics',
                        title: 'é—ä¼ è§„å¾‹æ¼”ç¤º'
                    }
                }
            }
        };

        // å¯è§†åŒ–æ¸²æŸ“å‡½æ•°
        function renderVisualization(type, subject) {
            const placeholder = document.getElementById('vizPlaceholder');
            const showGrid = document.getElementById('gridToggle').classList.contains('active');

            switch(type) {
                case 'function_graph':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            ${showGrid ? '<defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="#f0f0f0" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(#grid)" />' : ''}
                            <line x1="40" y1="260" x2="360" y2="260" stroke="#666" stroke-width="2"/>
                            <line x1="40" y1="260" x2="40" y2="40" stroke="#666" stroke-width="2"/>
                            <path d="M 40 260 Q 200 40, 360 260" stroke="#3B82F6" stroke-width="3" fill="none"/>
                            <line x1="40" y1="200" x2="360" y2="80" stroke="#DC2626" stroke-width="3"/>
                            <text x="370" y="265" font-size="12" fill="#666">x</text>
                            <text x="25" y="35" font-size="12" fill="#666">y</text>
                            <text x="300" y="30" font-size="12" fill="#3B82F6">y = xÂ²</text>
                            <text x="280" y="70" font-size="12" fill="#DC2626">y = 2x + 1</text>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">å‡½æ•°å›¾åƒå¯¹æ¯”</p>
                        <p style="font-size: 12px; color: #666;">è“è‰²ï¼šäºŒæ¬¡å‡½æ•° | çº¢è‰²ï¼šä¸€æ¬¡å‡½æ•°</p>
                    `;
                    break;

                case 'geometry_shapes':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            ${showGrid ? '<rect width="100%" height="100%" fill="url(#grid)" />' : ''}
                            <!-- ä¸‰è§’å½¢ -->
                            <path d="M 100 80 L 180 80 L 140 140 Z" stroke="#3B82F6" stroke-width="2" fill="#DBEAFE"/>
                            <text x="140" y="170" font-size="12" text-anchor="middle" fill="#3B82F6">ä¸‰è§’å½¢</text>

                            <!-- åœ†å½¢ -->
                            <circle cx="280" cy="110" r="40" stroke="#3B82F6" stroke-width="2" fill="#DBEAFE"/>
                            <text x="280" y="170" font-size="12" text-anchor="middle" fill="#3B82F6">åœ†å½¢</text>

                            <!-- çŸ©å½¢ -->
                            <rect x="80" y="200" width="80" height="50" stroke="#3B82F6" stroke-width="2" fill="#DBEAFE"/>
                            <text x="120" y="270" font-size="12" text-anchor="middle" fill="#3B82F6">çŸ©å½¢</text>

                            <!-- æ­£æ–¹å½¢ -->
                            <rect x="220" y="200" width="50" height="50" stroke="#3B82F6" stroke-width="2" fill="#DBEAFE"/>
                            <text x="245" y="270" font-size="12" text-anchor="middle" fill="#3B82F6">æ­£æ–¹å½¢</text>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">åŸºæœ¬å‡ ä½•å›¾å½¢</p>
                        <p style="font-size: 12px; color: #666;">åŒ…å«ä¸‰è§’å½¢ã€åœ†å½¢ã€çŸ©å½¢ã€æ­£æ–¹å½¢</p>
                    `;
                    break;

                case 'sequence_animation':
                    placeholder.innerHTML = `
                        <div style="width: 100%; max-width: 350px;">
                            <div style="display: flex; align-items: end; height: 150px; gap: 8px;">
                                <div style="flex: 1; background: #3B82F6; height: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; border-radius: 4px; animation: pulse 1s infinite;">2</div>
                                <div style="flex: 1; background: #3B82F6; height: 40px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; border-radius: 4px; animation: pulse 1s infinite 0.2s;">5</div>
                                <div style="flex: 1; background: #3B82F6; height: 60px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; border-radius: 4px; animation: pulse 1s infinite 0.4s;">8</div>
                                <div style="flex: 1; background: #3B82F6; height: 80px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; border-radius: 4px; animation: pulse 1s infinite 0.6s;">11</div>
                                <div style="flex: 1; background: #3B82F6; height: 100px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; border-radius: 4px; animation: pulse 1s infinite 0.8s;">14</div>
                            </div>
                            <p style="margin-top: 16px; color: #333;">ç­‰å·®æ•°åˆ—ï¼š2, 5, 8, 11, 14...</p>
                            <p style="font-size: 12px; color: #666;">é¦–é¡¹ aâ‚ = 2ï¼Œå…¬å·® d = 3</p>
                        </div>
                        <style>
                        @keyframes pulse {
                            0%, 100% { transform: scale(1); opacity: 1; }
                            50% { transform: scale(1.05); opacity: 0.8; }
                        }
                        </style>
                    `;
                    break;

                case 'trigonometry':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            ${showGrid ? '<rect width="100%" height="100%" fill="url(#grid)" />' : ''}
                            <line x1="40" y1="150" x2="360" y2="150" stroke="#666" stroke-width="2"/>
                            <line x1="200" y1="40" x2="200" y2="260" stroke="#666" stroke-width="2"/>
                            <path d="M 40 150 Q 120 50, 200 150 T 360 150" stroke="#DC2626" stroke-width="3" fill="none"/>
                            <path d="M 40 90 Q 200 210, 360 90" stroke="#2563EB" stroke-width="3" fill="none"/>
                            <text x="370" y="155" font-size="12" fill="#666">x</text>
                            <text x="185" y="35" font-size="12" fill="#666">y</text>
                            <text x="280" y="70" font-size="12" fill="#DC2626">sin(x)</text>
                            <text x="280" y="120" font-size="12" fill="#2563EB">cos(x)</text>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">ä¸‰è§’å‡½æ•°å›¾åƒ</p>
                        <p style="font-size: 12px; color: #666;">çº¢è‰²ï¼šsin(x) | è“è‰²ï¼šcos(x)</p>
                    `;
                    break;

                case 'force_diagram':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <rect x="180" y="140" width="40" height="40" fill="#F59E0B" stroke="#D97706" stroke-width="2"/>
                            <!-- é‡åŠ› -->
                            <line x1="200" y1="180" x2="200" y2="230" stroke="#DC2626" stroke-width="3" marker-end="url(#arrow-red)"/>
                            <text x="210" y="210" font-size="12" fill="#DC2626">é‡åŠ›</text>
                            <!-- æ”¯æŒåŠ› -->
                            <line x1="200" y1="140" x2="200" y2="90" stroke="#10B981" stroke-width="3" marker-end="url(#arrow-green)"/>
                            <text x="210" y="115" font-size="12" fill="#10B981">æ”¯æŒåŠ›</text>
                            <!-- æ‘©æ“¦åŠ› -->
                            <line x1="180" y1="160" x2="130" y2="160" stroke="#3B82F6" stroke-width="3" marker-end="url(#arrow-blue)"/>
                            <text x="100" y="155" font-size="12" fill="#3B82F6">æ‘©æ“¦åŠ›</text>
                            <!-- åœ°é¢ -->
                            <line x1="40" y1="230" x2="360" y2="230" stroke="#666" stroke-width="2"/>
                            <defs>
                                <marker id="arrow-red" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#DC2626"/></marker>
                                <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#10B981"/></marker>
                                <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#3B82F6"/></marker>
                            </defs>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">ç‰©ä½“å—åŠ›åˆ†æå›¾</p>
                        <p style="font-size: 12px; color: #666">çº¢è‰²ï¼šé‡åŠ› | ç»¿è‰²ï¼šæ”¯æŒåŠ› | è“è‰²ï¼šæ‘©æ“¦åŠ›</p>
                    `;
                    break;

                case 'circuit_diagram':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <!-- ç”µæº -->
                            <line x1="80" y1="100" x2="80" y2="140" stroke="#666" stroke-width="2"/>
                            <line x1="80" y1="160" x2="80" y2="200" stroke="#666" stroke-width="2"/>
                            <line x1="70" y1="140" x2="90" y2="140" stroke="#666" stroke-width="2"/>
                            <line x1="70" y1="160" x2="90" y2="160" stroke="#666" stroke-width="2"/>
                            <text x="50" y="155" font-size="12" fill="#666">ç”µæº</text>

                            <!-- å¯¼çº¿ -->
                            <line x1="80" y1="100" x2="200" y2="100" stroke="#666" stroke-width="2"/>
                            <line x1="200" y1="100" x2="200" y2="130" stroke="#666" stroke-width="2"/>
                            <line x1="200" y1="170" x2="200" y2="200" stroke="#666" stroke-width="2"/>
                            <line x1="200" y1="200" x2="80" y2="200" stroke="#666" stroke-width="2"/>

                            <!-- ç¯æ³¡ -->
                            <circle cx="200" cy="150" r="20" stroke="#666" stroke-width="2" fill="none"/>
                            <line x1="195" y1="135" x2="205" y2="165" stroke="#666" stroke-width="1"/>
                            <line x1="195" y1="145" x2="205" y2="175" stroke="#666" stroke-width="1"/>
                            <text x="230" y="155" font-size="12" fill="#666">ç¯æ³¡</text>

                            <!-- ç”µæµæ–¹å‘ -->
                            <path d="M 140 95 L 150 100 L 140 105" stroke="#10B981" stroke-width="2" fill="none" marker-end="url(#arrow-green)"/>
                            <text x="125" y="90" font-size="12" fill="#10B981">ç”µæµ</text>

                            <defs>
                                <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#10B981"/></marker>
                            </defs>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">ç®€å•ç”µè·¯å›¾</p>
                        <p style="font-size: 12px; color: #666">åŒ…å«ç”µæºã€å¯¼çº¿ã€ç¯æ³¡å’Œç”µæµæ–¹å‘</p>
                    `;
                    break;

                case 'molecule_structure':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <!-- æ°´åˆ†å­ H2O -->
                            <g transform="translate(200, 150)">
                                <!-- æ°§åŸå­ -->
                                <circle cx="0" cy="0" r="30" fill="#EF4444" stroke="#DC2626" stroke-width="2"/>
                                <text x="0" y="5" text-anchor="middle" font-size="16" fill="white" font-weight="bold">O</text>

                                <!-- æ°¢åŸå­1 -->
                                <circle cx="-40" cy="-30" r="20" fill="#F59E0B" stroke="#D97706" stroke-width="2"/>
                                <text x="-40" y="-25" text-anchor="middle" font-size="14" fill="white" font-weight="bold">H</text>

                                <!-- æ°¢åŸå­2 -->
                                <circle cx="40" cy="-30" r="20" fill="#F59E0B" stroke="#D97706" stroke-width="2"/>
                                <text x="40" y="-25" text-anchor="middle" font-size="14" fill="white" font-weight="bold">H</text>

                                <!-- åŒ–å­¦é”® -->
                                <line x1="-20" y1="-15" x2="-25" y2="-10" stroke="#666" stroke-width="3"/>
                                <line x1="20" y1="-15" x2="25" y2="-10" stroke="#666" stroke-width="3"/>

                                <text x="0" y="60" text-anchor="middle" font-size="14" fill="#666">Hâ‚‚O (æ°´åˆ†å­)</text>
                            </g>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">æ°´åˆ†å­ç»“æ„</p>
                        <p style="font-size: 12px; color: #666">çº¢è‰²ï¼šæ°§åŸå­ | æ©™è‰²ï¼šæ°¢åŸå­ | ç°è‰²ï¼šå…±ä»·é”®</p>
                    `;
                    break;

                case 'chemical_reaction':
                    placeholder.innerHTML = `
                        <div style="width: 100%; max-width: 350px; text-align: center;">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px;">
                                <!-- ååº”ç‰© -->
                                <div style="text-align: center;">
                                    <div style="background: #DBEAFE; border: 2px solid #3B82F6; border-radius: 8px; padding: 10px;">
                                        <div style="font-size: 20px; margin-bottom: 5px;">2Hâ‚‚</div>
                                        <div style="font-size: 12px; color: #3B82F6;">æ°¢æ°”</div>
                                    </div>
                                </div>

                                <!-- åŠ å· -->
                                <div style="font-size: 24px; color: #666;">+</div>

                                <!-- ååº”ç‰©2 -->
                                <div style="text-align: center;">
                                    <div style="background: #DCFCE7; border: 2px solid #10B981; border-radius: 8px; padding: 10px;">
                                        <div style="font-size: 20px; margin-bottom: 5px;">Oâ‚‚</div>
                                        <div style="font-size: 12px; color: #10B981;">æ°§æ°”</div>
                                    </div>
                                </div>

                                <!-- ç®­å¤´ -->
                                <div style="font-size: 24px; color: #666;">â†’</div>

                                <!-- ç”Ÿæˆç‰© -->
                                <div style="text-align: center;">
                                    <div style="background: #FEF3C7; border: 2px solid #F59E0B; border-radius: 8px; padding: 10px;">
                                        <div style="font-size: 20px; margin-bottom: 5px;">2Hâ‚‚O</div>
                                        <div style="font-size: 12px; color: #F59E0B;">æ°´</div>
                                    </div>
                                </div>
                            </div>
                            <p style="margin-top: 16px; color: #333;">åŒ–å­¦ååº”ï¼šæ°¢æ°” + æ°§æ°” â†’ æ°´</p>
                            <p style="font-size: 12px; color: #666">è¿™æ˜¯ä¸€ä¸ªæ”¾çƒ­ååº”ï¼Œé‡Šæ”¾å¤§é‡èƒ½é‡</p>
                        </div>
                    `;
                    break;

                case 'cell_structure':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <!-- ç»†èƒè†œ -->
                            <ellipse cx="200" cy="150" rx="160" ry="120" fill="#EDE9FE" stroke="#8B5CF6" stroke-width="3"/>

                            <!-- ç»†èƒæ ¸ -->
                            <ellipse cx="200" cy="150" rx="60" ry="50" fill="#DDD6FE" stroke="#8B5CF6" stroke-width="2"/>
                            <text x="200" y="155" text-anchor="middle" font-size="12" fill="#8B5CF6">ç»†èƒæ ¸</text>

                            <!-- çº¿ç²’ä½“ -->
                            <ellipse cx="120" cy="100" rx="30" ry="15" fill="#FCA5A5" stroke="#EF4444" stroke-width="2" transform="rotate(-30 120 100)"/>
                            <ellipse cx="280" cy="100" rx="30" ry="15" fill="#FCA5A5" stroke="#EF4444" stroke-width="2" transform="rotate(30 280 100)"/>
                            <text x="120" y="85" font-size="10" fill="#EF4444">çº¿ç²’ä½“</text>

                            <!-- å†…è´¨ç½‘ -->
                            <path d="M 140 180 Q 200 170, 260 180" stroke="#10B981" stroke-width="2" fill="none"/>
                            <path d="M 130 190 Q 200 180, 270 190" stroke="#10B981" stroke-width="2" fill="none"/>
                            <text x="200" y="195" text-anchor="middle" font-size="10" fill="#10B981">å†…è´¨ç½‘</text>

                            <!-- æ ¸ç³–ä½“ -->
                            <circle cx="150" cy="130" r="4" fill="#3B82F6"/>
                            <circle cx="160" cy="125" r="4" fill="#3B82F6"/>
                            <circle cx="250" cy="130" r="4" fill="#3B82F6"/>
                            <circle cx="240" cy="125" r="4" fill="#3B82F6"/>
                            <text x="200" y="145" text-anchor="middle" font-size="10" fill="#3B82F6">æ ¸ç³–ä½“</text>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">åŠ¨ç‰©ç»†èƒç»“æ„</p>
                        <p style="font-size: 12px; color: #666">ç´«è‰²ï¼šç»†èƒæ ¸å’Œç»†èƒè†œ | çº¢è‰²ï¼šçº¿ç²’ä½“ | ç»¿è‰²ï¼šå†…è´¨ç½‘ | è“è‰²ï¼šæ ¸ç³–ä½“</p>
                    `;
                    break;

                case 'dna_structure':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <!-- DNAåŒèºæ—‹ç»“æ„ -->
                            <defs>
                                <linearGradient id="dnaGradient1" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#3B82F6;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="dnaGradient2" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                                </linearGradient>
                            </defs>

                            <!-- ç¬¬ä¸€æ¡é“¾ -->
                            <path d="M 100 50 Q 150 80, 200 50 T 300 50" stroke="url(#dnaGradient1)" stroke-width="4" fill="none"/>

                            <!-- ç¬¬äºŒæ¡é“¾ -->
                            <path d="M 100 250 Q 150 220, 200 250 T 300 250" stroke="url(#dnaGradient2)" stroke-width="4" fill="none"/>

                            <!-- ç¢±åŸºå¯¹ -->
                            <line x1="100" y1="50" x2="100" y2="250" stroke="#666" stroke-width="2"/>
                            <line x1="130" y1="65" x2="130" y2="235" stroke="#666" stroke-width="2"/>
                            <line x1="160" y1="75" x2="160" y2="225" stroke="#666" stroke-width="2"/>
                            <line x1="190" y1="70" x2="190" y2="230" stroke="#666" stroke-width="2"/>
                            <line x1="220" y1="60" x2="220" y2="240" stroke="#666" stroke-width="2"/>
                            <line x1="250" y1="55" x2="250" y2="245" stroke="#666" stroke-width="2"/>
                            <line x1="280" y1="50" x2="280" y2="250" stroke="#666" stroke-width="2"/>
                            <line x1="300" y1="50" x2="300" y2="250" stroke="#666" stroke-width="2"/>

                            <!-- ç¢±åŸºæ ‡è®° -->
                            <text x="200" y="40" text-anchor="middle" font-size="14" font-weight="bold" fill="#8B5CF6">DNAåŒèºæ—‹ç»“æ„</text>
                            <text x="100" y="40" text-anchor="middle" font-size="10" fill="#8B5CF6">A-T</text>
                            <text x="200" y="40" text-anchor="middle" font-size="10" fill="#8B5CF6">G-C</text>
                            <text x="300" y="40" text-anchor="middle" font-size="10" fill="#8B5CF6">A-T</text>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">DNAåŒèºæ—‹ç»“æ„</p>
                        <p style="font-size: 12px; color: #666">è“ç´«è‰²ï¼šç£·é…¸-è„±æ°§æ ¸ç³–éª¨æ¶ | ç°è‰²ï¼šç¢±åŸºå¯¹ | A-Tï¼šè…ºå˜Œå‘¤-èƒ¸è…ºå˜§å•¶ | G-Cï¼šé¸Ÿå˜Œå‘¤-èƒå˜§å•¶</p>
                    `;
                    break;

                case 'photosynthesis':
                    placeholder.innerHTML = `
                        <div style="width: 100%; max-width: 350px; text-align: center;">
                            <!-- å¤ªé˜³å…‰ -->
                            <div style="font-size: 24px; margin-bottom: 10px;">â˜€ï¸ å¤ªé˜³å…‰</div>

                            <!-- æ¤ç‰©å¶å­ -->
                            <div style="background: #10B981; border-radius: 50%; width: 100px; height: 60px; margin: 20px auto; position: relative; padding: 10px;">
                                <div style="background: #059669; border-radius: 50%; width: 80px; height: 40px; margin: 10px auto;">
                                    <div style="background: #D1FAE5; border-radius: 4px; width: 60px; height: 20px; margin: 10px auto;">
                                        <div style="background: #6EE7B7; border-radius: 50%; width: 10px; height: 10px; position: absolute; top: 15px; left: 35px;"></div>
                                        <div style="background: #6EE7B7; border-radius: 50%; width: 8px; height: 8px; position: absolute; top: 18px; left: 45px;"></div>
                                        <div style="background: #6EE7B7; border-radius: 50%; width: 6px; height: 6px; position: absolute; top: 20px; left: 25px;"></div>
                                    </div>
                                </div>
                                <div style="position: absolute; top: -10px; left: -5px; background: #8B5CF6; width: 110px; height: 80px; border-radius: 55px; opacity: 0.3;"></div>
                            </div>

                            <!-- åŒ–å­¦æ–¹ç¨‹å¼ -->
                            <div style="background: #F3F4F6; border-radius: 8px; padding: 15px; margin: 10px 0;">
                                <div style="font-size: 14px; color: #333; line-height: 1.5;">
                                    6COâ‚‚ + 6Hâ‚‚O + å…‰èƒ½
                                </div>
                                <div style="font-size: 16px; margin: 5px 0;">â†“</div>
                                <div style="font-size: 14px; color: #333; line-height: 1.5;">
                                    Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚
                                </div>
                            </div>

                            <!-- äº§ç‰© -->
                            <div style="display: flex; justify-content: center; gap: 20px; margin-top: 10px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px;">ğŸ</div>
                                    <div style="font-size: 12px; color: #666;">è‘¡è„ç³–</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 24px;">ğŸ’¨</div>
                                    <div style="font-size: 12px; color: #666;">æ°§æ°”</div>
                                </div>
                            </div>
                        </div>
                        <p style="margin-top: 16px; color: #333;">å…‰åˆä½œç”¨è¿‡ç¨‹</p>
                        <p style="font-size: 12px; color: #666">æ¤ç‰©åˆ©ç”¨å…‰èƒ½å°†äºŒæ°§åŒ–ç¢³å’Œæ°´è½¬åŒ–ä¸ºè‘¡è„ç³–å’Œæ°§æ°”</p>
                    `;
                    break;

                case 'food_chain':
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 400 300" style="width: 100%; max-width: 350px;">
                            <!-- å¤ªé˜³ -->
                            <circle cx="200" cy="40" r="20" fill="#FCD34D" stroke="#F59E0B" stroke-width="2"/>
                            <text x="200" y="45" text-anchor="middle" font-size="12" fill="#92400E">â˜€ï¸</text>

                            <!-- ç”Ÿäº§è€… -->
                            <rect x="170" y="70" width="60" height="30" fill="#10B981" stroke="#059669" stroke-width="2" rx="5"/>
                            <text x="200" y="90" text-anchor="middle" font-size="10" fill="white">ğŸŒ± æ¤ç‰©</text>

                            <!-- åˆçº§æ¶ˆè´¹è€… -->
                            <ellipse cx="120" cy="140" rx="35" ry="20" fill="#3B82F6" stroke="#1E40AF" stroke-width="2"/>
                            <text x="120" y="145" text-anchor="middle" font-size="10" fill="white">ğŸ° å…”å­</text>

                            <ellipse cx="280" cy="140" rx="35" ry="20" fill="#3B82F6" stroke="#1E40AF" stroke-width="2"/>
                            <text x="280" y="145" text-anchor="middle" font-size="10" fill="white">ğŸ¦Œ é¹¿</text>

                            <!-- æ¬¡çº§æ¶ˆè´¹è€… -->
                            <ellipse cx="200" cy="200" rx="40" ry="25" fill="#EF4444" stroke="#991B1B" stroke-width="2"/>
                            <text x="200" y="205" text-anchor="middle" font-size="10" fill="white">ğŸ¦Š ç‹ç‹¸</text>

                            <!-- é¡¶çº§æ¶ˆè´¹è€… -->
                            <ellipse cx="200" cy="260" rx="30" ry="18" fill="#7C3AED" stroke="#4C1D95" stroke-width="2"/>
                            <text x="200" y="265" text-anchor="middle" font-size="10" fill="white">ğŸ¦… é¹°</text>

                            <!-- èƒ½é‡æµåŠ¨ç®­å¤´ -->
                            <defs>
                                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                    <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
                                </marker>
                            </defs>

                            <line x1="200" y1="60" x2="200" y2="70" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                            <line x1="180" y1="100" x2="140" y2="120" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                            <line x1="220" y1="100" x2="260" y2="120" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                            <line x1="140" y1="160" x2="180" y2="180" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                            <line x1="260" y1="160" x2="220" y2="180" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                            <line x1="200" y1="225" x2="200" y2="242" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">é™†åœ°é£Ÿç‰©é“¾</p>
                        <p style="font-size: 12px; color: #666">å¤ªé˜³ â†’ æ¤ç‰© â†’ é£Ÿè‰åŠ¨ç‰© â†’ é£Ÿè‚‰åŠ¨ç‰© â†’ é¡¶çº§æ•é£Ÿè€…</p>
                    `;
                    break;

                case 'genetics':
                    placeholder.innerHTML = `
                        <div style="width: 100%; max-width: 350px; text-align: center;">
                            <!-- äº²ä»£ -->
                            <div style="margin-bottom: 20px;">
                                <div style="font-weight: bold; color: #8B5CF6; margin-bottom: 10px;">äº²ä»£ (P)</div>
                                <div style="display: flex; justify-content: center; gap: 20px;">
                                    <div style="background: #EDE9FE; border: 2px solid #8B5CF6; border-radius: 8px; padding: 15px; width: 60px;">
                                        <div style="font-size: 24px; margin-bottom: 5px;">ğŸ”´</div>
                                        <div style="font-size: 12px;">æ˜¾æ€§ (AA)</div>
                                    </div>
                                    <div style="font-size: 24px; align-self: center;">Ã—</div>
                                    <div style="background: #FECACA; border: 2px solid #EF4444; border-radius: 8px; padding: 15px; width: 60px;">
                                        <div style="font-size: 24px; margin-bottom: 5px;">âšª</div>
                                        <div style="font-size: 12px;">éšæ€§ (aa)</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ç®­å¤´ -->
                            <div style="font-size: 20px; margin: 10px 0;">â†“</div>
                            <div style="font-weight: bold; color: #8B5CF6; margin-bottom: 10px;">å­ä¸€ä»£ (Fâ‚)</div>

                            <!-- é…å­ -->
                            <div style="background: #F3F4F6; border-radius: 8px; padding: 10px; margin-bottom: 15px;">
                                <div style="font-size: 12px; color: #666;">é…å­: A, a</div>
                            </div>

                            <!-- åä»£ -->
                            <div style="display: flex; justify-content: center; gap: 15px;">
                                <div style="background: #EDE9FE; border: 2px solid #8B5CF6; border-radius: 8px; padding: 15px; width: 60px;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">ğŸ”´</div>
                                    <div style="font-size: 12px;">Aa<br>50%</div>
                                </div>
                                <div style="background: #EDE9FE; border: 2px solid #8B5CF6; border-radius: 8px; padding: 15px; width: 60px;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">ğŸ”´</div>
                                    <div style="font-size: 12px;">Aa<br>50%</div>
                                </div>
                            </div>

                            <!-- ç»“æœ -->
                            <div style="background: #DBEAFE; border-radius: 8px; padding: 10px; margin-top: 15px;">
                                <div style="font-size: 14px; color: #333;">
                                    <strong>å­Ÿå¾·å°”åˆ†ç¦»å®šå¾‹ï¼š</strong><br>
                                    åä»£è¡¨å‹æ¯” = 1 : 0<br>
                                    åŸºå› å‹æ¯” = 1 : 1
                                </div>
                            </div>
                        </div>
                        <p style="margin-top: 16px; color: #333;">é—ä¼ è§„å¾‹æ¼”ç¤º</p>
                        <p style="font-size: 12px; color: #666">çº¢è‰²ï¼šæ˜¾æ€§æ€§çŠ¶ | ç™½è‰²ï¼šéšæ€§æ€§çŠ¶ | å±•ç¤ºå­Ÿå¾·å°”åˆ†ç¦»å®šå¾‹</p>
                    `;
                    break;

                default:
                    placeholder.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 80px; height: 80px; color: #d1d5db;">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <p style="margin-top: 16px; color: #333;">å­¦ç§‘æ¨¡æ¿å¯è§†åŒ–</p>
                        <p style="font-size: 12px; color: #666;">é€‰æ‹©å­¦ç§‘å¹¶æå‡ºé—®é¢˜æŸ¥çœ‹ç›¸å…³å†…å®¹</p>
                    `;
            }
        }

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            if (isLoading) return;

            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message) return;

            // æ¸…ç©ºè¾“å…¥æ¡†
            input.value = '';
            input.style.height = 'auto';

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage(message, 'user');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();

            try {
                // åˆå§‹åŒ–APIå®¢æˆ·ç«¯
                const api = new HighSchoolAPI('http://localhost:9999');

                // è°ƒç”¨çœŸå®API
                const result = await api.generateVisualization(message, {
                    subject: currentSubject,
                    gradeLevel: 'high_school',
                    interactionMode: 'visualization',
                    loadingMessage: `æ­£åœ¨ä¸ºæ‚¨çš„${getSubjectName(currentSubject)}é—®é¢˜ç”Ÿæˆå¯è§†åŒ–...`
                });

                hideLoading();

                if (result.success) {
                    // æ·»åŠ AIå“åº”æ¶ˆæ¯
                    const aiMessage = result.message || `å·²ä¸ºæ‚¨ç”Ÿæˆ${getSubjectName(currentSubject)}å¯è§†åŒ–å†…å®¹`;
                    addMessage(aiMessage, 'ai');

                    // æ˜¾ç¤ºå¯è§†åŒ–å†…å®¹
                    displayRealVisualization(result.visualization);
                    document.getElementById('vizTitle').textContent = result.visualization.title;
                } else {
                    // å¤„ç†é”™è¯¯
                    addMessage('æŠ±æ­‰ï¼Œç”Ÿæˆå¯è§†åŒ–æ—¶é‡åˆ°äº†é—®é¢˜ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'ai');
                    hideLoading();
                }

            } catch (error) {
                hideLoading();
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                addMessage('è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚é”™è¯¯ï¼š' + error.message, 'ai');
            }
        }

        // è·å–å­¦ç§‘ä¸­æ–‡åç§°
        function getSubjectName(subject) {
            const subjectNames = {
                'mathematics': 'æ•°å­¦',
                'physics': 'ç‰©ç†',
                'chemistry': 'åŒ–å­¦',
                'biology': 'ç”Ÿç‰©',
                'astronomy': 'å¤©æ–‡'
            };
            return subjectNames[subject] || subject;
        }

        // æ˜¾ç¤ºçœŸå®APIè¿”å›çš„å¯è§†åŒ–å†…å®¹
        function displayRealVisualization(visualization) {
            const vizContainer = document.getElementById('visualization');
            const metadata = visualization;

            // æ¸…ç©ºå®¹å™¨
            vizContainer.innerHTML = '';

            // åˆ›å»ºå¯è§†åŒ–åŒ…è£…å™¨
            const wrapper = document.createElement('div');
            wrapper.className = 'visualization-wrapper';

            // åˆ›å»ºå¤´éƒ¨ä¿¡æ¯
            const header = document.createElement('div');
            header.className = 'visualization-header';
            header.innerHTML = `
                <div class="viz-meta">
                    <span class="subject-tag">${getSubjectName(metadata.subject)}</span>
                    <span class="grade-tag">é«˜ä¸­</span>
                    <span class="type-tag">${metadata.type}</span>
                </div>
                <div class="viz-actions">
                    <button class="new-page-btn" onclick="openVisualizationInNewPage()">
                        ğŸ”— åœ¨æ–°é¡µé¢æ‰“å¼€
                    </button>
                </div>
            `;

            // åˆ›å»ºå†…å®¹åŒºåŸŸ
            const content = document.createElement('div');
            content.className = 'visualization-content';

            // åˆ›å»ºiframeæ¥æ˜¾ç¤ºHTMLå†…å®¹
            const iframe = document.createElement('iframe');
            iframe.srcdoc = metadata.html_content;
            iframe.className = 'visualization-frame';
            iframe.sandbox = 'allow-scripts allow-same-origin';
            iframe.style.width = '100%';
            iframe.style.height = '400px';
            iframe.style.border = 'none';
            iframe.style.borderRadius = '8px';
            iframe.style.opacity = '0';
            iframe.style.transition = 'opacity 0.5s ease';

            iframe.onload = function() {
                this.style.opacity = '1';
            };

            // åˆ›å»ºåº•éƒ¨ä¿¡æ¯
            const footer = document.createElement('div');
            footer.className = 'visualization-footer';
            footer.innerHTML = `
                <div class="concepts">
                    <strong>ç›¸å…³æ¦‚å¿µ:</strong> ${metadata.concepts ? metadata.concepts.join(', ') : 'æ— '}
                </div>
                <div class="interactive">
                    <strong>äº¤äº’åŠŸèƒ½:</strong> ${metadata.interactive_elements ? metadata.interactive_elements.join(', ') : 'åŸºæœ¬æ˜¾ç¤º'}
                </div>
            `;

            // ç»„è£…é¡µé¢
            content.appendChild(iframe);
            wrapper.appendChild(header);
            wrapper.appendChild(content);
            wrapper.appendChild(footer);
            vizContainer.appendChild(wrapper);

            // å­˜å‚¨å½“å‰å¯è§†åŒ–æ•°æ®ä¾›æ–°é¡µé¢ä½¿ç”¨
            window.currentVisualizationData = {
                title: metadata.title,
                html_content: metadata.html_content,
                subject: metadata.subject,
                concepts: metadata.concepts,
                interactive_elements: metadata.interactive_elements
            };
        }

        // åœ¨æ–°é¡µé¢æ‰“å¼€å¯è§†åŒ–
        function openVisualizationInNewPage() {
            if (!window.currentVisualizationData) {
                alert('æ²¡æœ‰å¯æ‰“å¼€çš„å¯è§†åŒ–å†…å®¹');
                return;
            }

            const data = window.currentVisualizationData;
            const newWindow = window.open('', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');

            newWindow.document.write(`
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${data.title} - èŒ…å¡é¡¿å¼€</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #7C3AED 0%, #9333EA 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
        }
        .meta {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .tag {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
        }
        .content {
            padding: 20px;
        }
        .info {
            background: #f8f9fa;
            padding: 15px;
            margin: 20px;
            border-radius: 8px;
            border-left: 4px solid #7C3AED;
        }
        .visualization-frame {
            width: 100%;
            border: none;
            border-radius: 8px;
            min-height: 500px;
        }
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(124, 58, 237, 0.9);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
            z-index: 1000;
        }
        .back-btn:hover {
            background: rgba(124, 58, 237, 1);
        }
    </style>
</head>
<body>
    <a href="javascript:window.close();" class="back-btn">â† å…³é—­é¡µé¢</a>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ${data.title}</h1>
            <div class="meta">
                <span class="tag">å­¦ç§‘: ${getSubjectName(data.subject)}</span>
                <span class="tag">é«˜ä¸­</span>
                <span class="tag">èŒ…å¡é¡¿å¼€</span>
            </div>
        </div>
        <div class="content">
            <div class="info">
                <strong>ç›¸å…³æ¦‚å¿µ:</strong> ${data.concepts ? data.concepts.join(', ') : 'æ— '}<br>
                <strong>äº¤äº’åŠŸèƒ½:</strong> ${data.interactive_elements ? data.interactive_elements.join(', ') : 'åŸºæœ¬æ˜¾ç¤º'}
            </div>
            <iframe srcdoc="${data.html_content.replace(/"/g, '&quot;')}" class="visualization-frame" sandbox="allow-scripts allow-same-origin"></iframe>
        </div>
    </div>
    <script>
        function getSubjectName(subject) {
            const subjectNames = {
                'mathematics': 'æ•°å­¦',
                'physics': 'ç‰©ç†',
                'chemistry': 'åŒ–å­¦',
                'biology': 'ç”Ÿç‰©',
                'astronomy': 'å¤©æ–‡'
            };
            return subjectNames[subject] || subject;
        }
    </script>
</body>
</html>
            `);
            newWindow.document.close();
        }

        // æ·»åŠ æ¶ˆæ¯
        function addMessage(content, sender) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;

            const avatar = sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';

            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">${content}</div>
            `;

            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;

            messageCount++;
            document.getElementById('messageCount').textContent = messageCount;
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            isLoading = true;
            const container = document.getElementById('messagesContainer');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai loading-message';
            loadingDiv.innerHTML = `
                <div class="message-avatar">ğŸ¤–</div>
                <div class="message-content">
                    <div class="loading-text">æ­£åœ¨è¿æ¥æœåŠ¡å™¨...</div>
                    <div class="loading-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(loadingDiv);
            container.scrollTop = container.scrollHeight;
            animateProgress();
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            isLoading = false;
            const loadingMessage = document.querySelector('.loading-message');
            if (loadingMessage) {
                loadingMessage.remove();
            }
        }

        // åŠ¨ç”»è¿›åº¦æ¡
        function animateProgress() {
            let progress = 0;
            const progressBar = document.getElementById('progress-fill');
            if (progressBar) {
                const interval = setInterval(() => {
                    if (!isLoading) {
                        clearInterval(interval);
                        progressBar.style.width = '100%';
                        return;
                    }
                    progress += Math.random() * 10;
                    progress = Math.min(progress, 95);
                    progressBar.style.width = progress + '%';
                }, 200);
            }
        }

        // è·å–AIå“åº”
        function getAIResponse(message, subject) {
            const lowerMessage = message.toLowerCase();
            const templates = subjectTemplates[subject].templates;

            for (const [key, response] of Object.entries(templates)) {
                if (lowerMessage.includes(key.toLowerCase())) {
                    return response;
                }
            }

            return {
                message: `æˆ‘ç†è§£äº†ä½ çš„é—®é¢˜ã€‚åœ¨${subjectTemplates[subject].name}å­¦ç§‘ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚è®©æˆ‘ä¸ºä½ å±•ç¤ºç›¸å…³çš„å¯è§†åŒ–å†…å®¹ã€‚`,
                visualization: 'default',
                title: `${subjectTemplates[subject].name}æ¦‚å¿µå›¾è§£`
            };
        }

        // åˆ‡æ¢å­¦ç§‘
        function switchSubject(subject) {
            if (subject === currentSubject) return;

            currentSubject = subject;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.subject-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-subject="${subject}"]`).classList.add('active');

            // æ›´æ–°æŒ‡ç¤ºå™¨
            const indicator = document.getElementById('subjectIndicator');
            indicator.textContent = subjectTemplates[subject].name;
            indicator.className = `subject-indicator ${subject}`;

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('currentSubject').textContent = subjectTemplates[subject].name;

            // æ›´æ–°å¿«é€Ÿæ“ä½œ
            updateQuickActions(subject);

            // æ¸…ç©ºå¯¹è¯å†å²ï¼ˆé™¤äº†æ¬¢è¿æ¶ˆæ¯ï¼‰
            const container = document.getElementById('messagesContainer');
            const welcomeMessage = container.firstElementChild;
            container.innerHTML = '';
            container.appendChild(welcomeMessage);

            // é‡ç½®å¯è§†åŒ–
            document.getElementById('vizPlaceholder').innerHTML = `
                <svg viewBox="0 0 24 24" fill="currentColor" style="width: 80px; height: 80px; color: #d1d5db;">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                <p>é€‰æ‹©${subjectTemplates[subject].name}å­¦ç§‘å¹¶æå‡ºé—®é¢˜</p>
                <p style="font-size: 12px; margin-top: 8px;">æˆ‘å°†ä¸ºä½ ç”Ÿæˆç›¸åº”çš„å¯è§†åŒ–å†…å®¹</p>
            `;
            document.getElementById('vizTitle').textContent = 'ç­‰å¾…å†…å®¹...';

            // æ›´æ–°å¿«é€Ÿæ“ä½œæ–‡æœ¬
            const quickActionsContainer = document.getElementById('quickActions');
            quickActionsContainer.innerHTML = subjectTemplates[subject].quickActions
                .map(action => `<div class="quick-action">${action}</div>`)
                .join('');
        }

        // æ›´æ–°å¿«é€Ÿæ“ä½œ
        function updateQuickActions(subject) {
            const quickActionsContainer = document.getElementById('quickActions');
            quickActionsContainer.innerHTML = subjectTemplates[subject].quickActions
                .map(action => `<div class="quick-action">${action}</div>`)
                .join('');

            // ä¸ºå¿«é€Ÿæ“ä½œæ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.quick-action').forEach(action => {
                action.addEventListener('click', function() {
                    document.getElementById('messageInput').value = this.textContent;
                    sendMessage();
                });
            });
        }

        // æ§åˆ¶å¼€å…³
        function toggleControl(controlName) {
            const toggle = document.getElementById(controlName + 'Toggle');
            toggle.classList.toggle('active');

            // é‡æ–°æ¸²æŸ“å½“å‰å¯è§†åŒ–ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            const vizTitle = document.getElementById('vizTitle').textContent;
            if (vizTitle !== 'ç­‰å¾…å†…å®¹...') {
                // è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦é‡æ–°æ¸²æŸ“å½“å‰çš„å¯è§†åŒ–
            }
        }

        // æ›´æ–°ä¼šè¯æ—¶é—´
        function updateSessionTime() {
            const elapsed = Date.now() - sessionStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('sessionTime').textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('messageInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        document.getElementById('messageInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // å­¦ç§‘æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.subject-button').forEach(button => {
            button.addEventListener('click', function() {
                switchSubject(this.dataset.subject);
            });
        });

        // å¿«é€Ÿæ“ä½œç‚¹å‡»äº‹ä»¶ï¼ˆåˆå§‹è®¾ç½®ï¼‰
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('quick-action')) {
                document.getElementById('messageInput').value = e.target.textContent;
                sendMessage();
            }
        });

        // æ›´æ–°ä¼šè¯æ—¶é—´
        setInterval(updateSessionTime, 1000);

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            document.getElementById('messageInput').focus();
            updateQuickActions('math');
        });
    </script>
</body>
</html>