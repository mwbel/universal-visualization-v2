<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹¬ç«‹å¯è§†åŒ–æµ‹è¯•</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>
<body>
    <h1>ç‹¬ç«‹å¯è§†åŒ–æµ‹è¯•</h1>
    <button onclick="loadDirectly()">ç›´æ¥åŠ è½½æ­£æ€åˆ†å¸ƒ</button>
    <button onclick="loadFromAPI()">ä»APIåŠ è½½</button>
    <div id="container"></div>

    <script>
        function loadDirectly() {
            console.log('ç›´æ¥åŠ è½½å®Œæ•´çš„æ­£æ€åˆ†å¸ƒHTML');

            const completeHTML = `
            <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;">
                <div style="max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center;">
                        <h1>ğŸ“Š æ­£æ€åˆ†å¸ƒå¯è§†åŒ–</h1>
                        <p>æ­£æ€åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°çš„äº¤äº’å¼å±•ç¤º</p>
                    </div>
                    <div style="padding: 30px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                            <div style="display: flex; flex-direction: column;">
                                <label for="mu" style="font-weight: 600; margin-bottom: 5px; color: #333;">å‡å€¼ (Î¼)</label>
                                <input type="range" id="mu" min="-10" max="10" step="0.1" value="0" style="padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                <div style="font-size: 14px; color: #666; margin-top: 5px;">Î¼ = <span id="muValue">0.0</span></div>
                            </div>
                            <div style="display: flex; flex-direction: column;">
                                <label for="sigma" style="font-weight: 600; margin-bottom: 5px; color: #333;">æ ‡å‡†å·® (Ïƒ)</label>
                                <input type="range" id="sigma" min="0.1" max="5" step="0.1" value="1" style="padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                                <div style="font-size: 14px; color: #666; margin-top: 5px;">Ïƒ = <span id="sigmaValue">1.0</span></div>
                            </div>
                        </div>
                        <div id="plot" style="width: 100%; height: 500px; border-radius: 10px; overflow: hidden;"></div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; border-left: 4px solid #667eea;">
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="meanStat">0.00</div>
                                <div style="color: #666; margin-top: 5px;">å‡å€¼ E[X]</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; border-left: 4px solid #667eea;">
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="stdStat">1.00</div>
                                <div style="color: #666; margin-top: 5px;">æ ‡å‡†å·® Ïƒ</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; border-left: 4px solid #667eea;">
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="varStat">1.00</div>
                                <div style="color: #666; margin-top: 5px;">æ–¹å·® Var(X)</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; border-left: 4px solid #667eea;">
                                <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="medianStat">0.00</div>
                                <div style="color: #666; margin-top: 5px;">ä¸­ä½æ•°</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;

            document.getElementById('container').innerHTML = completeHTML;

            // æ‰§è¡Œæ­£æ€åˆ†å¸ƒçš„JavaScriptä»£ç 
            initializeNormalDistribution();
        }

        function initializeNormalDistribution() {
            // æ­£æ€åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°
            function normalPDF(x, mu, sigma) {
                const coefficient = 1 / (sigma * Math.sqrt(2 * Math.PI));
                const exponent = -Math.pow((x - mu), 2) / (2 * Math.pow(sigma, 2));
                return coefficient * Math.exp(exponent);
            }

            // ç”Ÿæˆæ­£æ€åˆ†å¸ƒæ•°æ®ï¼ˆå›ºå®šèŒƒå›´ï¼‰
            function generateNormalData(mu, sigma) {
                const x = [];
                const y = [];
                // å›ºå®š x è½´èŒƒå›´ä¸º [-15, 15]
                for (let xVal = -15; xVal <= 15; xVal += 0.01) {
                    x.push(xVal);
                    y.push(normalPDF(xVal, mu, sigma));
                }
                return { x, y };
            }

            // æ›´æ–°å›¾è¡¨
            function updatePlot() {
                const mu = parseFloat(document.getElementById('mu').value);
                const sigma = parseFloat(document.getElementById('sigma').value);

                const data = generateNormalData(mu, sigma);

                const trace = {
                    x: data.x,
                    y: data.y,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'æ¦‚ç‡å¯†åº¦å‡½æ•°',
                    line: {
                        color: '#667eea',
                        width: 3
                    },
                    fill: 'tozeroy',
                    fillcolor: 'rgba(102, 126, 234, 0.1)'
                };

                const layout = {
                    title: {
                        text: `æ­£æ€åˆ†å¸ƒ N(${mu.toFixed(1)}, ${sigma.toFixed(1)}Â²)`,
                        font: {
                            size: 20,
                            color: '#333'
                        }
                    },
                    xaxis: {
                        title: 'å€¼ (x)',
                        showgrid: true,
                        gridcolor: '#e9ecef',
                        range: [-15, 15],
                        autorange: false
                    },
                    yaxis: {
                        title: 'æ¦‚ç‡å¯†åº¦ f(x)',
                        showgrid: true,
                        gridcolor: '#e9ecef',
                        range: [0, 0.45],
                        autorange: false
                    },
                    plot_bgcolor: '#ffffff',
                    paper_bgcolor: '#ffffff',
                    hovermode: 'x',
                    margin: { t: 50, r: 30, b: 60, l: 70 }
                };

                const config = {
                    responsive: true,
                    displayModeBar: true,
                    displaylogo: false,
                    modeBarButtonsToRemove: ['pan2d', 'select2d', 'lasso2d', 'autoScale2d']
                };

                Plotly.newPlot('plot', [trace], layout, config);

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                document.getElementById('muValue').textContent = mu.toFixed(1);
                document.getElementById('sigmaValue').textContent = sigma.toFixed(1);
                document.getElementById('meanStat').textContent = mu.toFixed(2);
                document.getElementById('stdStat').textContent = sigma.toFixed(2);
                document.getElementById('varStat').textContent = (sigma * sigma).toFixed(2);
                document.getElementById('medianStat').textContent = mu.toFixed(2);
            }

            // äº‹ä»¶ç›‘å¬
            document.getElementById('mu').addEventListener('input', updatePlot);
            document.getElementById('sigma').addEventListener('input', updatePlot);

            // åˆå§‹åŒ–å›¾è¡¨
            updatePlot();

            console.log('æ­£æ€åˆ†å¸ƒåˆå§‹åŒ–å®Œæˆ');
        }

        async function loadFromAPI() {
            console.log('ä»APIåŠ è½½');
            try {
                const response = await fetch('http://localhost:8000/resolve_or_generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: 'æ­£æ€åˆ†å¸ƒ å‡å€¼0 æ ‡å‡†å·®1',
                        vizType: 'auto',
                        complexity: 'ä¸­ç­‰',
                        params: {}
                    })
                });

                const result = await response.json();
                console.log('APIå“åº”:', result);

                if (result.success && result.htmlContent) {
                    document.getElementById('container').innerHTML = result.htmlContent;
                    console.log('APIå†…å®¹å·²åŠ è½½');

                    // é‡æ–°æ‰§è¡Œè„šæœ¬
                    setTimeout(() => {
                        const scripts = document.querySelectorAll('#container script');
                        scripts.forEach((script, index) => {
                            console.log(`é‡æ–°æ‰§è¡Œè„šæœ¬ ${index + 1}`);
                            const newScript = document.createElement('script');
                            newScript.textContent = script.textContent;
                            script.parentNode.replaceChild(newScript, script);
                        });
                    }, 100);
                }
            } catch (error) {
                console.error('APIåŠ è½½å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼ŒPlotlyç‰ˆæœ¬:', Plotly.version);
        });
    </script>
</body>
</html>